function [Rx,Ry,Rz,Rux,Ruy,Ruz,ux,uy,uz]=solver3(dt,dx,dy,dz,nt,nx,ny,nz,huge_model,sx,sy,sz,rt,srcx,srcy,srcz,rx,ry,rz,lp,C,Eta,rho,lpn,Rc,tol,scalex,scaley,scalez)
switch huge_model
    case 0
        %% initialization
        tic;
        format shortg;
        % number of sources
        Ns=size(srcx,2);
        Nr=size(rx,2);
        
        AA=sparse(1:nx*scalex*ny*scaley*3*2,1:nx*scalex*ny*scaley*3*2,ones(nx*scalex*ny*scaley*3*2,1),nx*scalex*ny*scaley*3*2,nx*scalex*ny*scaley*3*2);
        B=zeros(nx*scalex*ny*scaley*3*2,1);
        
        ux=zeros(nx*scalex,ny*scaley,nz*scalez,nt);
        uy=ux;
        uz=ux;
        
        Ux=zeros(nx*scalex,ny*scaley,nz*scalez);
        Uy=Ux;
        Uz=Ux;
        
        Rx=zeros(nt,Nr);
        Ry=Rx;
        Rz=Rx;
        
        Rux=zeros(nx*scalex,ny*scaley,nz*scalez,length(rt));
        Ruy=Rux;
        Ruz=Rux;
        
        w=zeros(3,3,nx*scalex,ny*scaley,nz*scalez);
        u2=zeros(nx*scalex*ny*scaley*3*2,1);
        %% PML
        % expand
        vmax0=sqrt(reshape(C(3,3,:,:,:),[nx,ny,nz])./rho);
        vmax=imresize3(vmax0,[nx*scalex,ny*scaley,nz*scalez],'nearest');
        
        beta01=vmax*(lpn+1)*log(1/Rc)/2/lp/dx;
        beta02=vmax*(lpn+1)*log(1/Rc)/2/lp/dy;
        beta03=vmax*(lpn+1)*log(1/Rc)/2/lp/dz;
        %%
        beta1=zeros(nx*scalex,ny*scaley,nz*scalez);
        t=beta1;
        t(2:lp+1,:,:)=repmat(reshape((abs((1:lp)-lp-1)/lp).^lpn,[lp,1,1]),[1,ny*scaley,nz*scalez]);
        t(nx*scalex-lp:nx*scalex-1,:,:)=repmat(reshape(((abs(nx*scalex-lp-(nx*scalex-lp+1:nx*scalex)))/lp).^lpn,[lp,1,1]),[1,ny*scaley,nz*scalez]);
        beta1=beta01.*t;
        
        beta2=zeros(nx*scalex,ny*scaley,nz*scalez);
        t=beta2;
        t(:,2:lp+1,:)=repmat(reshape((abs((1:lp)-lp-1)/lp).^lpn,[1,lp,1]),[nx*scalex,1,nz*scalez]);
        t(:,ny*scaley-lp:ny*scaley-1,:)=repmat(reshape(((abs(nx*scalex-lp-(nx*scalex-lp+1:nx*scalex)))/lp).^lpn,[1,lp,1]),[nx*scalex,1,nz*scalez]);
        beta2=beta02.*t;
        
        beta3=zeros(nx*scalex,ny*scaley,nz*scalez);
        t=beta3;
        t(:,:,2:lp+1)=repmat(reshape((abs((1:lp)-lp-1)/lp).^lpn,[1,1,lp]),[nx*scalex,ny*scalex,1]);
        t(:,:,nz*scalez-lp:nz*scalez-1)=repmat(reshape(((abs(nz*scalez-lp-(nz*scalez-lp+1:nz*scalez)))/lp).^lpn,[1,1,lp]),[nx*scalex,ny*scaley,1]);
        beta3=beta03.*t;
        
        beta1(1,:,:)=beta1(2,:,:);
        beta1(end,:,:)=beta1(end-1,:,:);
        
        beta2(:,1,:)=beta2(:,2,:);
        beta2(:,end,:)=beta2(:,end-1,:);
        
        beta3(:,:,1)=beta3(:,:,2);
        beta3(:,:,end)=beta3(:,:,end-1);
        
        % free surface
        beta3(:,:,1:lp+1)=0;
        beta2(lp+2:nx-lp-1,lp+2:ny-lp-1,1:lp+1)=0;
        beta1(lp+2:nx-lp-1,lp+2:ny-lp-1,1:lp+1)=0;
        
        a=beta1+beta2+beta3;
        b=beta1.*beta2+beta2.*beta3+beta3.*beta1;
        c=beta1.*beta2.*beta3;
        a2=zeros(size(a));
        c2=zeros(size(c));
        % a and b are pending confirmed
        a2(a~=0)=1;
        c2(c~=0)=1;
        %% parameters for PML
        hatc=zeros(3,3,3,3,nx,ny,nz);
        hatctwo=hatc;
        hateta=hatc;
        hatetatwo=hatc;
        for i=1:3
            for j=1:3
                for k=1:3
                    for l=1:3
                        % modification ends here
                        I=vn(i,j,k,l);
                        hatc(i,j,k,l,:,:,:)=reshape(a2.*reshape(C(I(1),I(2),:,:,:),[nx,ny,nz]),[1,1,1,1,nx,ny,nz]);
                        hatctwo(i,j,k,l,:,:,:)=reshape(c2./eval(['beta' (num2str(l))]).*reshape(C(I(1),I(2),:,:,:),[nx,ny,nz]),[1,1,1,1,nx,ny,nz]);
                        hateta(i,j,k,l,:,:,:)=reshape((a2-eval(['beta' (num2str(j))])-eval(['beta' (num2str(l))])).*reshape(Eta(I(1),I(2),:,:,:),[nx,ny,nz]),[1,1,1,1,nx,ny,nz]);
                        hatetatwo(i,j,k,l,:,:,:)=reshape(c2./eval(['beta' (num2str(l))]).*reshape(Eta(I(1),I(2),:,:,:),[nx,ny,nz]),[1,1,1,1,nx,ny,nz]);
                    end
                end
            end
        end
        hatctwo(isnan(hatctwo))=0;
        hatctwo(isinf(hatctwo))=0;
        hatetatwo(isnan(hatetatwo))=0;
        hatetatwo(isinf(hatetatwo))=0;
        %% free surface
        k=1;
        for i=2:nx*scalex-1
            for j=2:ny*scaley-1
               [i2,j2,k2]=rd(i,j,k);
                %% first eq
                Id=id(nx*scalex,ny*scaley,nz*scalez,1,i,j,k,1,i,j-1,k);
                AA(Id(1),Id(2))=(-C(5,6,i2,j2,k2)/(2*dy)-Eta(5,6,i2,j2,k2)/(2*dt*dy));
                
                Id=id(nx,ny,nz,1,i,j,k,1,i-1,j,k);
                AA(Id(1),Id(2))=(-C(1,5,i2,j2,k2)/(2*dx)-Eta(1,5,i2,j2,k2)/(2*dt*dx));
                
                Id=id(nx,ny,nz,1,i,j,k,1,i,j,k);
                AA(Id(1),Id(2))=(-C(5,5,i2,j2,k2)/dz-Eta(5,5,i2,j2,k2)/(dt*dz));
                
                Id=id(nx,ny,nz,1,i,j,k,1,i+1,j,k);
                AA(Id(1),Id(2))=(C(1,5,i2,j2,k2)/(2*dx)+Eta(1,5,i2,j2,k2)/(2*dt*dx));
                
                Id=id(nx,ny,nz,1,i,j,k,1,i,j+1,k);
                AA(Id(1),Id(2))=(C(5,6,i2,j2,k2)/(2*dy)+Eta(5,6,i2,j2,k2)/(2*dt*dy));
                
                Id=id(nx,ny,nz,1,i,j,k,1,i,j,k+1);
                AA(Id(1),Id(2))=(C(5,5,i2,j2,k2)/dz+Eta(5,5,i2,j2,k2)/(dt*dz));
                
                Id=id(nx,ny,nz,1,i,j,k,2,i,j-1,k);
                AA(Id(1),Id(2))=(-C(2,5,i2,j2,k2)/(2*dy)-Eta(2,5,i2,j2,k2)/(2*dt*dy));
                
                Id=id(nx,ny,nz,1,i,j,k,2,i-1,j,k);
                AA(Id(1),Id(2))=(-C(5,6,i2,j2,k2)/(2*dx)-Eta(5,6,i2,j2,k2)/(2*dt*dx));
                
                Id=id(nx,ny,nz,1,i,j,k,2,i,j,k);
                AA(Id(1),Id(2))=(-C(4,5,i2,j2,k2)/dz-Eta(4,5,i2,j2,k2)/(dt*dz));
                
                Id=id(nx,ny,nz,1,i,j,k,2,i+1,j,k);
                AA(Id(1),Id(2))=(C(5,6,i2,j2,k2)/(2*dx)+Eta(5,6,i2,j2,k2)/(2*dt*dx));
                
                Id=id(nx,ny,nz,1,i,j,k,2,i,j+1,k);
                AA(Id(1),Id(2))=(C(2,5,i2,j2,k2)/(2*dy)+Eta(2,5,i2,j2,k2)/(2*dt*dy));
                
                Id=id(nx,ny,nz,1,i,j,k,2,i,j,k+1);
                AA(Id(1),Id(2))=(C(4,5,i2,j2,k2)/dz+Eta(4,5,i2,j2,k2)/(dt*dz));
                
                Id=id(nx,ny,nz,1,i,j,k,3,i,j-1,k);
                AA(Id(1),Id(2))=(-C(4,5,i2,j2,k2)/(2*dy)-Eta(4,5,i2,j2,k2)/(2*dt*dy));
                
                Id=id(nx,ny,nz,1,i,j,k,3,i-1,j,k);
                AA(Id(1),Id(2))=(-C(5,5,i2,j2,k2)/(2*dx)-Eta(5,5,i2,j2,k2)/(2*dt*dx));
                
                Id=id(nx,ny,nz,1,i,j,k,3,i,j,k);
                AA(Id(1),Id(2))=(-C(3,5,i2,j2,k2)/dz-Eta(3,5,i2,j2,k2)/(dt*dz));
                
                Id=id(nx,ny,nz,1,i,j,k,3,i+1,j,k);
                AA(Id(1),Id(2))=(C(5,5,i2,j2,k2)/(2*dx)+Eta(5,5,i2,j2,k2)/(2*dt*dx));
                
                Id=id(nx,ny,nz,1,i,j,k,3,i,j+1,k);
                AA(Id(1),Id(2))=(C(4,5,i2,j2,k2)/(2*dy)+Eta(4,5,i2,j2,k2)/(2*dt*dy));
                
                Id=id(nx,ny,nz,1,i,j,k,3,i,j,k+1);
                AA(Id(1),Id(2))=(C(3,5,i2,j2,k2)/dz+Eta(3,5,i2,j2,k2)/(dt*dz));
                
                %% second eq
                Id=id(nx,ny,nz,2,i,j,k,1,i,j-1,k);
                AA(Id(1),Id(2))=(-C(4,6,i2,j2,k2)/(2*dy)-Eta(4,6,i2,j2,k2)/(2*dt*dy));
                
                Id=id(nx,ny,nz,2,i,j,k,1,i-1,j,k);
                AA(Id(1),Id(2))=(-C(1,4,i2,j2,k2)/(2*dx)-Eta(1,4,i2,j2,k2)/(2*dt*dx));
                
                Id=id(nx,ny,nz,2,i,j,k,1,i,j,k);
                AA(Id(1),Id(2))=(-C(4,5,i2,j2,k2)/dz-Eta(4,5,i2,j2,k2)/(dt*dz));
                
                Id=id(nx,ny,nz,2,i,j,k,1,i+1,j,k);
                AA(Id(1),Id(2))=(C(1,4,i2,j2,k2)/(2*dx)+Eta(1,4,i2,j2,k2)/(2*dt*dx));
                
                Id=id(nx,ny,nz,2,i,j,k,1,i,j+1,k);
                AA(Id(1),Id(2))=(C(4,6,i2,j2,k2)/(2*dy)+Eta(4,6,i2,j2,k2)/(2*dt*dy));
                
                Id=id(nx,ny,nz,2,i,j,k,1,i,j,k+1);
                AA(Id(1),Id(2))=(C(4,5,i2,j2,k2)/dz+Eta(4,5,i2,j2,k2)/(dt*dz));
                
                Id=id(nx,ny,nz,2,i,j,k,2,i,j-1,k);
                AA(Id(1),Id(2))=(-C(2,4,i2,j2,k2)/(2*dy)-Eta(2,4,i2,j2,k2)/(2*dt*dy));
                
                Id=id(nx,ny,nz,2,i,j,k,2,i-1,j,k);
                AA(Id(1),Id(2))=(-C(4,6,i2,j2,k2)/(2*dx)-Eta(4,6,i2,j2,k2)/(2*dt*dx));
                
                Id=id(nx,ny,nz,2,i,j,k,2,i,j,k);
                AA(Id(1),Id(2))=(-C(4,4,i2,j2,k2)/dz-Eta(4,4,i2,j2,k2)/(dt*dz));
                
                Id=id(nx,ny,nz,2,i,j,k,2,i+1,j,k);
                AA(Id(1),Id(2))=(C(4,6,i2,j2,k2)/(2*dx)+Eta(4,6,i2,j2,k2)/(2*dt*dx));
                
                Id=id(nx,ny,nz,2,i,j,k,2,i,j+1,k);
                AA(Id(1),Id(2))=(C(2,4,i2,j2,k2)/(2*dy)+Eta(2,4,i2,j2,k2)/(2*dt*dy));
                
                Id=id(nx,ny,nz,2,i,j,k,2,i,j,k+1);
                AA(Id(1),Id(2))=(C(4,4,i2,j2,k2)/dz+Eta(4,4,i2,j2,k2)/(dt*dz));
                
                Id=id(nx,ny,nz,2,i,j,k,3,i,j-1,k);
                AA(Id(1),Id(2))=(-C(4,4,i2,j2,k2)/(2*dy)-Eta(4,4,i2,j2,k2)/(2*dt*dy));
                
                Id=id(nx,ny,nz,2,i,j,k,3,i-1,j,k);
                AA(Id(1),Id(2))=(-C(4,5,i2,j2,k2)/(2*dx)-Eta(4,5,i2,j2,k2)/(2*dt*dx));
                
                Id=id(nx,ny,nz,2,i,j,k,3,i,j,k);
                AA(Id(1),Id(2))=(-C(3,4,i2,j2,k2)/dz-Eta(3,4,i2,j2,k2)/(dt*dz));
                
                Id=id(nx,ny,nz,2,i,j,k,3,i+1,j,k);
                AA(Id(1),Id(2))=(C(4,5,i2,j2,k2)/(2*dx)+Eta(4,5,i2,j2,k2)/(2*dt*dx));
                
                Id=id(nx,ny,nz,2,i,j,k,3,i,j+1,k);
                AA(Id(1),Id(2))=(C(4,4,i2,j2,k2)/(2*dy)+Eta(4,4,i2,j2,k2)/(2*dt*dy));
                
                Id=id(nx,ny,nz,2,i,j,k,3,i,j,k+1);
                AA(Id(1),Id(2))=(C(3,4,i2,j2,k2)/dz+Eta(3,4,i2,j2,k2)/(dt*dz));
                %% third eq
                Id=id(nx,ny,nz,3,i,j,k,1,i,j-1,k);
                AA(Id(1),Id(2))=(-C(3,6,i2,j2,k2)/(2*dy)-Eta(3,6,i2,j2,k2)/(2*dt*dy));
                
                Id=id(nx,ny,nz,3,i,j,k,1,i-1,j,k);
                AA(Id(1),Id(2))=(-C(1,3,i2,j2,k2)/(2*dx)-Eta(1,3,i2,j2,k2)/(2*dt*dx));
                
                Id=id(nx,ny,nz,3,i,j,k,1,i,j,k);
                AA(Id(1),Id(2))=(-C(3,5,i2,j2,k2)/dz-Eta(3,5,i2,j2,k2)/(dt*dz));
                
                Id=id(nx,ny,nz,3,i,j,k,1,i+1,j,k);
                AA(Id(1),Id(2))=(C(1,3,i2,j2,k2)/(2*dx)+Eta(1,3,i2,j2,k2)/(2*dt*dx));
                
                Id=id(nx,ny,nz,3,i,j,k,1,i,j+1,k);
                AA(Id(1),Id(2))=(C(3,6,i2,j2,k2)/(2*dy)+Eta(3,6,i2,j2,k2)/(2*dt*dy));
                
                Id=id(nx,ny,nz,3,i,j,k,1,i,j,k+1);
                AA(Id(1),Id(2))=(C(3,5,i2,j2,k2)/dz+Eta(3,5,i2,j2,k2)/(dt*dz));
                
                Id=id(nx,ny,nz,3,i,j,k,2,i,j-1,k);
                AA(Id(1),Id(2))=(-C(2,3,i2,j2,k2)/(2*dy)-Eta(2,3,i2,j2,k2)/(2*dt*dy));
                
                Id=id(nx,ny,nz,3,i,j,k,2,i-1,j,k);
                AA(Id(1),Id(2))=(-C(3,6,i2,j2,k2)/(2*dx)-Eta(3,6,i2,j2,k2)/(2*dt*dx));
                
                Id=id(nx,ny,nz,3,i,j,k,2,i,j,k);
                AA(Id(1),Id(2))=(-C(3,4,i2,j2,k2)/dz-Eta(3,4,i2,j2,k2)/(dt*dz));
                
                Id=id(nx,ny,nz,3,i,j,k,2,i+1,j,k);
                AA(Id(1),Id(2))=(C(3,6,i2,j2,k2)/(2*dx)+Eta(3,6,i2,j2,k2)/(2*dt*dx));
                
                Id=id(nx,ny,nz,3,i,j,k,2,i,j+1,k);
                AA(Id(1),Id(2))=(C(2,3,i2,j2,k2)/(2*dy)+Eta(2,3,i2,j2,k2)/(2*dt*dy));
                
                Id=id(nx,ny,nz,3,i,j,k,2,i,j,k+1);
                AA(Id(1),Id(2))=(C(3,4,i2,j2,k2)/dz+Eta(3,4,i2,j2,k2)/(dt*dz));
                
                Id=id(nx,ny,nz,3,i,j,k,3,i,j-1,k);
                AA(Id(1),Id(2))=(-C(3,4,i2,j2,k2)/(2*dy)-Eta(3,4,i2,j2,k2)/(2*dt*dy));
                
                Id=id(nx,ny,nz,3,i,j,k,3,i-1,j,k);
                AA(Id(1),Id(2))=(-C(3,5,i2,j2,k2)/(2*dx)-Eta(3,5,i2,j2,k2)/(2*dt*dx));
                
                Id=id(nx,ny,nz,3,i,j,k,3,i,j,k);
                AA(Id(1),Id(2))=(-C(3,3,i2,j2,k2)/dz-Eta(3,3,i2,j2,k2)/(dt*dz));
                
                Id=id(nx,ny,nz,3,i,j,k,3,i+1,j,k);
                AA(Id(1),Id(2))=(C(3,5,i2,j2,k2)/(2*dx)+Eta(3,5,i2,j2,k2)/(2*dt*dx));
                
                Id=id(nx,ny,nz,3,i,j,k,3,i,j+1,k);
                AA(Id(1),Id(2))=(C(3,4,i2,j2,k2)/(2*dy)+Eta(3,4,i2,j2,k2)/(2*dt*dy));
                
                Id=id(nx,ny,nz,3,i,j,k,3,i,j,k+1);
                AA(Id(1),Id(2))=(C(3,3,i2,j2,k2)/dz+Eta(3,3,i2,j2,k2)/(dt*dz));
            end
        end
        %% for l=2
        l=1;
        Sx=zeros(nx*scalex,ny*scaley,nz*scalez);
        Sy=Sx;
        Sz=Sx;
        % compute u
        for m=1:Ns
            Sx(sx(m),sy(m),sz(m))=srcx(l,m);
            Sy(sx(m),sy(m),sz(m))=srcy(l,m);
            Sz(sx(m),sy(m),sz(m))=srcz(l,m);
            for i=sx(m)-1:sx(m)+1
                for j=sy(m)-1:sy(m)+1
                    for k=sz(m)-1:sz(m)+1
                        [i2,j2,k2]=rd(i,j,k);
                        ux(i,j,k,l+1)=ux(i,j,k,l+1)+dt^2/rho(i2,j2,k2)*((Sz(i,j+1,k)-Sz(i,j-1,k))/2/dy-(Sy(i,j,k+1)-Sy(i,j,k-1))/2/dz);
                        uy(i,j,k,l+1)=uy(i,j,k,l+1)+dt^2/rho(i2,j2,k2)*((Sx(i,j,k+1)-Sx(i,j,k-1))/2/dz-(Sz(i+1,j,k)-Sz(i-1,j,k))/2/dx);
                        uz(i,j,k,l+1)=uz(i,j,k,l+1)+dt^2/rho(i2,j2,k2)*((Sy(i+1,j,k)-Sy(i-1,j,k))/2/dx-(Sx(i,j+1,k)-Sx(i,j-1,k))/2/dy);
                    end
                end
            end
        end
        
        fprintf('\ntime step=%d/%d',l+1,nt);
        fprintf('\n    epalsed time=%.2fs',toc);
        d=clock;
        fprintf('\n    current time=%d %d %d %d %d %.0d  ',d(1),d(2),d(3),d(4),d(5),d(6));
        %% for l>=3
        for l=2:nt-1
            %% compute U
            Ux=Ux+ux(:,:,:,l)*dt;
            Uy=Uy+uy(:,:,:,l)*dt;
            Uz=Uz+uz(:,:,:,l)*dt;
            %% compute w
            for i=[2:lp+1,nx-lp:nx-1]
                for j=2:ny-1
                    for k=2:nz-1
                       [i2,j2,k2]=rd(i,j,k);
                        w(1,1,i,j,k)=(hateta(1,1,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(1,1,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(1,1,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(1,1,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(1,1,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(1,1,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(1,1,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(1,1,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(1,1,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(1,1,1,1,i2,j2,k2)+hatetatwo(1,1,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(1,1,1,2,i2,j2,k2)+hatetatwo(1,1,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(1,1,1,3,i2,j2,k2)+hatetatwo(1,1,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(1,1,2,1,i2,j2,k2)+hatetatwo(1,1,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(1,1,2,2,i2,j2,k2)+hatetatwo(1,1,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(1,1,2,3,i2,j2,k2)+hatetatwo(1,1,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(1,1,3,1,i2,j2,k2)+hatetatwo(1,1,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(1,1,3,2,i2,j2,k2)+hatetatwo(1,1,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(1,1,3,3,i2,j2,k2)+hatetatwo(1,1,3,3,i2,j2,k2)))/dz-(hatctwo(1,1,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(1,1,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,1,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(1,1,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(1,1,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,1,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(1,1,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(1,1,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,1,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta1(i,j,k)*w(1,1,i,j,k)*dt+w(1,1,i,j,k);
                        w(1,2,i,j,k)=(hateta(1,2,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(1,2,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(1,2,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(1,2,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(1,2,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(1,2,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(1,2,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(1,2,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(1,2,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(1,2,1,1,i2,j2,k2)+hatetatwo(1,2,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(1,2,1,2,i2,j2,k2)+hatetatwo(1,2,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(1,2,1,3,i2,j2,k2)+hatetatwo(1,2,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(1,2,2,1,i2,j2,k2)+hatetatwo(1,2,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(1,2,2,2,i2,j2,k2)+hatetatwo(1,2,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(1,2,2,3,i2,j2,k2)+hatetatwo(1,2,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(1,2,3,1,i2,j2,k2)+hatetatwo(1,2,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(1,2,3,2,i2,j2,k2)+hatetatwo(1,2,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(1,2,3,3,i2,j2,k2)+hatetatwo(1,2,3,3,i2,j2,k2)))/dz-(hatctwo(1,2,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(1,2,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,2,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(1,2,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(1,2,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,2,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(1,2,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(1,2,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,2,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta1(i,j,k)*w(1,2,i,j,k)*dt+w(1,2,i,j,k);
                        w(1,3,i,j,k)=(hateta(1,3,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(1,3,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(1,3,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(1,3,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(1,3,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(1,3,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(1,3,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(1,3,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(1,3,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(1,3,1,1,i2,j2,k2)+hatetatwo(1,3,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(1,3,1,2,i2,j2,k2)+hatetatwo(1,3,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(1,3,1,3,i2,j2,k2)+hatetatwo(1,3,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(1,3,2,1,i2,j2,k2)+hatetatwo(1,3,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(1,3,2,2,i2,j2,k2)+hatetatwo(1,3,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(1,3,2,3,i2,j2,k2)+hatetatwo(1,3,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(1,3,3,1,i2,j2,k2)+hatetatwo(1,3,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(1,3,3,2,i2,j2,k2)+hatetatwo(1,3,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(1,3,3,3,i2,j2,k2)+hatetatwo(1,3,3,3,i2,j2,k2)))/dz-(hatctwo(1,3,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(1,3,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,3,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(1,3,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(1,3,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,3,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(1,3,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(1,3,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,3,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta1(i,j,k)*w(1,3,i,j,k)*dt+w(1,3,i,j,k);
                        w(2,1,i,j,k)=(hateta(2,1,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(2,1,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(2,1,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(2,1,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(2,1,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(2,1,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(2,1,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(2,1,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(2,1,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(2,1,1,1,i2,j2,k2)+hatetatwo(2,1,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(2,1,1,2,i2,j2,k2)+hatetatwo(2,1,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(2,1,1,3,i2,j2,k2)+hatetatwo(2,1,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(2,1,2,1,i2,j2,k2)+hatetatwo(2,1,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(2,1,2,2,i2,j2,k2)+hatetatwo(2,1,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(2,1,2,3,i2,j2,k2)+hatetatwo(2,1,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(2,1,3,1,i2,j2,k2)+hatetatwo(2,1,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(2,1,3,2,i2,j2,k2)+hatetatwo(2,1,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(2,1,3,3,i2,j2,k2)+hatetatwo(2,1,3,3,i2,j2,k2)))/dz-(hatctwo(2,1,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(2,1,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,1,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(2,1,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(2,1,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,1,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(2,1,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(2,1,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,1,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta2(i,j,k)*w(2,1,i,j,k)*dt+w(2,1,i,j,k);
                        w(2,2,i,j,k)=(hateta(2,2,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(2,2,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(2,2,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(2,2,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(2,2,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(2,2,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(2,2,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(2,2,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(2,2,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(2,2,1,1,i2,j2,k2)+hatetatwo(2,2,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(2,2,1,2,i2,j2,k2)+hatetatwo(2,2,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(2,2,1,3,i2,j2,k2)+hatetatwo(2,2,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(2,2,2,1,i2,j2,k2)+hatetatwo(2,2,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(2,2,2,2,i2,j2,k2)+hatetatwo(2,2,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(2,2,2,3,i2,j2,k2)+hatetatwo(2,2,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(2,2,3,1,i2,j2,k2)+hatetatwo(2,2,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(2,2,3,2,i2,j2,k2)+hatetatwo(2,2,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(2,2,3,3,i2,j2,k2)+hatetatwo(2,2,3,3,i2,j2,k2)))/dz-(hatctwo(2,2,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(2,2,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,2,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(2,2,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(2,2,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,2,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(2,2,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(2,2,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,2,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta2(i,j,k)*w(2,2,i,j,k)*dt+w(2,2,i,j,k);
                        w(2,3,i,j,k)=(hateta(2,3,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(2,3,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(2,3,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(2,3,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(2,3,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(2,3,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(2,3,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(2,3,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(2,3,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(2,3,1,1,i2,j2,k2)+hatetatwo(2,3,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(2,3,1,2,i2,j2,k2)+hatetatwo(2,3,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(2,3,1,3,i2,j2,k2)+hatetatwo(2,3,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(2,3,2,1,i2,j2,k2)+hatetatwo(2,3,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(2,3,2,2,i2,j2,k2)+hatetatwo(2,3,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(2,3,2,3,i2,j2,k2)+hatetatwo(2,3,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(2,3,3,1,i2,j2,k2)+hatetatwo(2,3,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(2,3,3,2,i2,j2,k2)+hatetatwo(2,3,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(2,3,3,3,i2,j2,k2)+hatetatwo(2,3,3,3,i2,j2,k2)))/dz-(hatctwo(2,3,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(2,3,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,3,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(2,3,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(2,3,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,3,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(2,3,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(2,3,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,3,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta2(i,j,k)*w(2,3,i,j,k)*dt+w(2,3,i,j,k);
                        w(3,1,i,j,k)=(hateta(3,1,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(3,1,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(3,1,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(3,1,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(3,1,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(3,1,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(3,1,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(3,1,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(3,1,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(3,1,1,1,i2,j2,k2)+hatetatwo(3,1,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(3,1,1,2,i2,j2,k2)+hatetatwo(3,1,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(3,1,1,3,i2,j2,k2)+hatetatwo(3,1,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(3,1,2,1,i2,j2,k2)+hatetatwo(3,1,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(3,1,2,2,i2,j2,k2)+hatetatwo(3,1,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(3,1,2,3,i2,j2,k2)+hatetatwo(3,1,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(3,1,3,1,i2,j2,k2)+hatetatwo(3,1,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(3,1,3,2,i2,j2,k2)+hatetatwo(3,1,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(3,1,3,3,i2,j2,k2)+hatetatwo(3,1,3,3,i2,j2,k2)))/dz-(hatctwo(3,1,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(3,1,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,1,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(3,1,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(3,1,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,1,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(3,1,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(3,1,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,1,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta3(i,j,k)*w(3,1,i,j,k)*dt+w(3,1,i,j,k);
                        w(3,2,i,j,k)=(hateta(3,2,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(3,2,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(3,2,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(3,2,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(3,2,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(3,2,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(3,2,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(3,2,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(3,2,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(3,2,1,1,i2,j2,k2)+hatetatwo(3,2,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(3,2,1,2,i2,j2,k2)+hatetatwo(3,2,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(3,2,1,3,i2,j2,k2)+hatetatwo(3,2,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(3,2,2,1,i2,j2,k2)+hatetatwo(3,2,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(3,2,2,2,i2,j2,k2)+hatetatwo(3,2,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(3,2,2,3,i2,j2,k2)+hatetatwo(3,2,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(3,2,3,1,i2,j2,k2)+hatetatwo(3,2,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(3,2,3,2,i2,j2,k2)+hatetatwo(3,2,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(3,2,3,3,i2,j2,k2)+hatetatwo(3,2,3,3,i2,j2,k2)))/dz-(hatctwo(3,2,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(3,2,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,2,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(3,2,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(3,2,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,2,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(3,2,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(3,2,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,2,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta3(i,j,k)*w(3,2,i,j,k)*dt+w(3,2,i,j,k);
                        w(3,3,i,j,k)=(hateta(3,3,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(3,3,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(3,3,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(3,3,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(3,3,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(3,3,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(3,3,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(3,3,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(3,3,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(3,3,1,1,i2,j2,k2)+hatetatwo(3,3,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(3,3,1,2,i2,j2,k2)+hatetatwo(3,3,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(3,3,1,3,i2,j2,k2)+hatetatwo(3,3,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(3,3,2,1,i2,j2,k2)+hatetatwo(3,3,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(3,3,2,2,i2,j2,k2)+hatetatwo(3,3,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(3,3,2,3,i2,j2,k2)+hatetatwo(3,3,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(3,3,3,1,i2,j2,k2)+hatetatwo(3,3,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(3,3,3,2,i2,j2,k2)+hatetatwo(3,3,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(3,3,3,3,i2,j2,k2)+hatetatwo(3,3,3,3,i2,j2,k2)))/dz-(hatctwo(3,3,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(3,3,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,3,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(3,3,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(3,3,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,3,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(3,3,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(3,3,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,3,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta3(i,j,k)*w(3,3,i,j,k)*dt+w(3,3,i,j,k);
                    end
                end
            end
            
            for i=2:nx-1
                for j=[2:lp+1,ny-lp:ny-1]
                    for k=2:nz-1
                        [i2,j2,k2]=rd(i,j,k);
                         w(1,1,i,j,k)=(hateta(1,1,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(1,1,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(1,1,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(1,1,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(1,1,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(1,1,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(1,1,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(1,1,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(1,1,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(1,1,1,1,i2,j2,k2)+hatetatwo(1,1,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(1,1,1,2,i2,j2,k2)+hatetatwo(1,1,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(1,1,1,3,i2,j2,k2)+hatetatwo(1,1,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(1,1,2,1,i2,j2,k2)+hatetatwo(1,1,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(1,1,2,2,i2,j2,k2)+hatetatwo(1,1,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(1,1,2,3,i2,j2,k2)+hatetatwo(1,1,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(1,1,3,1,i2,j2,k2)+hatetatwo(1,1,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(1,1,3,2,i2,j2,k2)+hatetatwo(1,1,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(1,1,3,3,i2,j2,k2)+hatetatwo(1,1,3,3,i2,j2,k2)))/dz-(hatctwo(1,1,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(1,1,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,1,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(1,1,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(1,1,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,1,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(1,1,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(1,1,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,1,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta1(i,j,k)*w(1,1,i,j,k)*dt+w(1,1,i,j,k);
                        w(1,2,i,j,k)=(hateta(1,2,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(1,2,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(1,2,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(1,2,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(1,2,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(1,2,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(1,2,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(1,2,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(1,2,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(1,2,1,1,i2,j2,k2)+hatetatwo(1,2,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(1,2,1,2,i2,j2,k2)+hatetatwo(1,2,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(1,2,1,3,i2,j2,k2)+hatetatwo(1,2,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(1,2,2,1,i2,j2,k2)+hatetatwo(1,2,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(1,2,2,2,i2,j2,k2)+hatetatwo(1,2,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(1,2,2,3,i2,j2,k2)+hatetatwo(1,2,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(1,2,3,1,i2,j2,k2)+hatetatwo(1,2,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(1,2,3,2,i2,j2,k2)+hatetatwo(1,2,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(1,2,3,3,i2,j2,k2)+hatetatwo(1,2,3,3,i2,j2,k2)))/dz-(hatctwo(1,2,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(1,2,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,2,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(1,2,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(1,2,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,2,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(1,2,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(1,2,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,2,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta1(i,j,k)*w(1,2,i,j,k)*dt+w(1,2,i,j,k);
                        w(1,3,i,j,k)=(hateta(1,3,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(1,3,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(1,3,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(1,3,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(1,3,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(1,3,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(1,3,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(1,3,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(1,3,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(1,3,1,1,i2,j2,k2)+hatetatwo(1,3,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(1,3,1,2,i2,j2,k2)+hatetatwo(1,3,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(1,3,1,3,i2,j2,k2)+hatetatwo(1,3,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(1,3,2,1,i2,j2,k2)+hatetatwo(1,3,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(1,3,2,2,i2,j2,k2)+hatetatwo(1,3,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(1,3,2,3,i2,j2,k2)+hatetatwo(1,3,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(1,3,3,1,i2,j2,k2)+hatetatwo(1,3,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(1,3,3,2,i2,j2,k2)+hatetatwo(1,3,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(1,3,3,3,i2,j2,k2)+hatetatwo(1,3,3,3,i2,j2,k2)))/dz-(hatctwo(1,3,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(1,3,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,3,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(1,3,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(1,3,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,3,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(1,3,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(1,3,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,3,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta1(i,j,k)*w(1,3,i,j,k)*dt+w(1,3,i,j,k);
                        w(2,1,i,j,k)=(hateta(2,1,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(2,1,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(2,1,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(2,1,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(2,1,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(2,1,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(2,1,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(2,1,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(2,1,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(2,1,1,1,i2,j2,k2)+hatetatwo(2,1,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(2,1,1,2,i2,j2,k2)+hatetatwo(2,1,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(2,1,1,3,i2,j2,k2)+hatetatwo(2,1,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(2,1,2,1,i2,j2,k2)+hatetatwo(2,1,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(2,1,2,2,i2,j2,k2)+hatetatwo(2,1,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(2,1,2,3,i2,j2,k2)+hatetatwo(2,1,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(2,1,3,1,i2,j2,k2)+hatetatwo(2,1,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(2,1,3,2,i2,j2,k2)+hatetatwo(2,1,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(2,1,3,3,i2,j2,k2)+hatetatwo(2,1,3,3,i2,j2,k2)))/dz-(hatctwo(2,1,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(2,1,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,1,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(2,1,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(2,1,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,1,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(2,1,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(2,1,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,1,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta2(i,j,k)*w(2,1,i,j,k)*dt+w(2,1,i,j,k);
                        w(2,2,i,j,k)=(hateta(2,2,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(2,2,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(2,2,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(2,2,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(2,2,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(2,2,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(2,2,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(2,2,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(2,2,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(2,2,1,1,i2,j2,k2)+hatetatwo(2,2,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(2,2,1,2,i2,j2,k2)+hatetatwo(2,2,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(2,2,1,3,i2,j2,k2)+hatetatwo(2,2,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(2,2,2,1,i2,j2,k2)+hatetatwo(2,2,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(2,2,2,2,i2,j2,k2)+hatetatwo(2,2,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(2,2,2,3,i2,j2,k2)+hatetatwo(2,2,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(2,2,3,1,i2,j2,k2)+hatetatwo(2,2,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(2,2,3,2,i2,j2,k2)+hatetatwo(2,2,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(2,2,3,3,i2,j2,k2)+hatetatwo(2,2,3,3,i2,j2,k2)))/dz-(hatctwo(2,2,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(2,2,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,2,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(2,2,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(2,2,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,2,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(2,2,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(2,2,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,2,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta2(i,j,k)*w(2,2,i,j,k)*dt+w(2,2,i,j,k);
                        w(2,3,i,j,k)=(hateta(2,3,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(2,3,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(2,3,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(2,3,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(2,3,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(2,3,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(2,3,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(2,3,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(2,3,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(2,3,1,1,i2,j2,k2)+hatetatwo(2,3,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(2,3,1,2,i2,j2,k2)+hatetatwo(2,3,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(2,3,1,3,i2,j2,k2)+hatetatwo(2,3,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(2,3,2,1,i2,j2,k2)+hatetatwo(2,3,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(2,3,2,2,i2,j2,k2)+hatetatwo(2,3,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(2,3,2,3,i2,j2,k2)+hatetatwo(2,3,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(2,3,3,1,i2,j2,k2)+hatetatwo(2,3,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(2,3,3,2,i2,j2,k2)+hatetatwo(2,3,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(2,3,3,3,i2,j2,k2)+hatetatwo(2,3,3,3,i2,j2,k2)))/dz-(hatctwo(2,3,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(2,3,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,3,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(2,3,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(2,3,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,3,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(2,3,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(2,3,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,3,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta2(i,j,k)*w(2,3,i,j,k)*dt+w(2,3,i,j,k);
                        w(3,1,i,j,k)=(hateta(3,1,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(3,1,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(3,1,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(3,1,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(3,1,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(3,1,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(3,1,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(3,1,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(3,1,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(3,1,1,1,i2,j2,k2)+hatetatwo(3,1,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(3,1,1,2,i2,j2,k2)+hatetatwo(3,1,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(3,1,1,3,i2,j2,k2)+hatetatwo(3,1,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(3,1,2,1,i2,j2,k2)+hatetatwo(3,1,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(3,1,2,2,i2,j2,k2)+hatetatwo(3,1,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(3,1,2,3,i2,j2,k2)+hatetatwo(3,1,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(3,1,3,1,i2,j2,k2)+hatetatwo(3,1,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(3,1,3,2,i2,j2,k2)+hatetatwo(3,1,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(3,1,3,3,i2,j2,k2)+hatetatwo(3,1,3,3,i2,j2,k2)))/dz-(hatctwo(3,1,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(3,1,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,1,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(3,1,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(3,1,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,1,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(3,1,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(3,1,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,1,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta3(i,j,k)*w(3,1,i,j,k)*dt+w(3,1,i,j,k);
                        w(3,2,i,j,k)=(hateta(3,2,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(3,2,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(3,2,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(3,2,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(3,2,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(3,2,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(3,2,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(3,2,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(3,2,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(3,2,1,1,i2,j2,k2)+hatetatwo(3,2,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(3,2,1,2,i2,j2,k2)+hatetatwo(3,2,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(3,2,1,3,i2,j2,k2)+hatetatwo(3,2,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(3,2,2,1,i2,j2,k2)+hatetatwo(3,2,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(3,2,2,2,i2,j2,k2)+hatetatwo(3,2,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(3,2,2,3,i2,j2,k2)+hatetatwo(3,2,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(3,2,3,1,i2,j2,k2)+hatetatwo(3,2,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(3,2,3,2,i2,j2,k2)+hatetatwo(3,2,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(3,2,3,3,i2,j2,k2)+hatetatwo(3,2,3,3,i2,j2,k2)))/dz-(hatctwo(3,2,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(3,2,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,2,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(3,2,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(3,2,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,2,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(3,2,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(3,2,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,2,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta3(i,j,k)*w(3,2,i,j,k)*dt+w(3,2,i,j,k);
                        w(3,3,i,j,k)=(hateta(3,3,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(3,3,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(3,3,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(3,3,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(3,3,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(3,3,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(3,3,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(3,3,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(3,3,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(3,3,1,1,i2,j2,k2)+hatetatwo(3,3,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(3,3,1,2,i2,j2,k2)+hatetatwo(3,3,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(3,3,1,3,i2,j2,k2)+hatetatwo(3,3,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(3,3,2,1,i2,j2,k2)+hatetatwo(3,3,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(3,3,2,2,i2,j2,k2)+hatetatwo(3,3,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(3,3,2,3,i2,j2,k2)+hatetatwo(3,3,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(3,3,3,1,i2,j2,k2)+hatetatwo(3,3,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(3,3,3,2,i2,j2,k2)+hatetatwo(3,3,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(3,3,3,3,i2,j2,k2)+hatetatwo(3,3,3,3,i2,j2,k2)))/dz-(hatctwo(3,3,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(3,3,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,3,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(3,3,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(3,3,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,3,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(3,3,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(3,3,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,3,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta3(i,j,k)*w(3,3,i,j,k)*dt+w(3,3,i,j,k);
                    end
                end
            end
            
            for i=2:nx-1
                for j=2:ny-1
                    for k=[2:lp+1,nz-lp:nz-1]
                        [i2,j2,k2]=rd(i,j,k);
                          w(1,1,i,j,k)=(hateta(1,1,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(1,1,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(1,1,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(1,1,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(1,1,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(1,1,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(1,1,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(1,1,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(1,1,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(1,1,1,1,i2,j2,k2)+hatetatwo(1,1,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(1,1,1,2,i2,j2,k2)+hatetatwo(1,1,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(1,1,1,3,i2,j2,k2)+hatetatwo(1,1,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(1,1,2,1,i2,j2,k2)+hatetatwo(1,1,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(1,1,2,2,i2,j2,k2)+hatetatwo(1,1,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(1,1,2,3,i2,j2,k2)+hatetatwo(1,1,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(1,1,3,1,i2,j2,k2)+hatetatwo(1,1,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(1,1,3,2,i2,j2,k2)+hatetatwo(1,1,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(1,1,3,3,i2,j2,k2)+hatetatwo(1,1,3,3,i2,j2,k2)))/dz-(hatctwo(1,1,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(1,1,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,1,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(1,1,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(1,1,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,1,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(1,1,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(1,1,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,1,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta1(i,j,k)*w(1,1,i,j,k)*dt+w(1,1,i,j,k);
                        w(1,2,i,j,k)=(hateta(1,2,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(1,2,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(1,2,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(1,2,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(1,2,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(1,2,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(1,2,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(1,2,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(1,2,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(1,2,1,1,i2,j2,k2)+hatetatwo(1,2,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(1,2,1,2,i2,j2,k2)+hatetatwo(1,2,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(1,2,1,3,i2,j2,k2)+hatetatwo(1,2,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(1,2,2,1,i2,j2,k2)+hatetatwo(1,2,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(1,2,2,2,i2,j2,k2)+hatetatwo(1,2,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(1,2,2,3,i2,j2,k2)+hatetatwo(1,2,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(1,2,3,1,i2,j2,k2)+hatetatwo(1,2,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(1,2,3,2,i2,j2,k2)+hatetatwo(1,2,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(1,2,3,3,i2,j2,k2)+hatetatwo(1,2,3,3,i2,j2,k2)))/dz-(hatctwo(1,2,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(1,2,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,2,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(1,2,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(1,2,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,2,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(1,2,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(1,2,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,2,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta1(i,j,k)*w(1,2,i,j,k)*dt+w(1,2,i,j,k);
                        w(1,3,i,j,k)=(hateta(1,3,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(1,3,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(1,3,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(1,3,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(1,3,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(1,3,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(1,3,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(1,3,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(1,3,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(1,3,1,1,i2,j2,k2)+hatetatwo(1,3,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(1,3,1,2,i2,j2,k2)+hatetatwo(1,3,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(1,3,1,3,i2,j2,k2)+hatetatwo(1,3,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(1,3,2,1,i2,j2,k2)+hatetatwo(1,3,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(1,3,2,2,i2,j2,k2)+hatetatwo(1,3,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(1,3,2,3,i2,j2,k2)+hatetatwo(1,3,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(1,3,3,1,i2,j2,k2)+hatetatwo(1,3,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(1,3,3,2,i2,j2,k2)+hatetatwo(1,3,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(1,3,3,3,i2,j2,k2)+hatetatwo(1,3,3,3,i2,j2,k2)))/dz-(hatctwo(1,3,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(1,3,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,3,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(1,3,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(1,3,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,3,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(1,3,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(1,3,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(1,3,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta1(i,j,k)*w(1,3,i,j,k)*dt+w(1,3,i,j,k);
                        w(2,1,i,j,k)=(hateta(2,1,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(2,1,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(2,1,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(2,1,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(2,1,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(2,1,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(2,1,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(2,1,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(2,1,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(2,1,1,1,i2,j2,k2)+hatetatwo(2,1,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(2,1,1,2,i2,j2,k2)+hatetatwo(2,1,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(2,1,1,3,i2,j2,k2)+hatetatwo(2,1,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(2,1,2,1,i2,j2,k2)+hatetatwo(2,1,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(2,1,2,2,i2,j2,k2)+hatetatwo(2,1,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(2,1,2,3,i2,j2,k2)+hatetatwo(2,1,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(2,1,3,1,i2,j2,k2)+hatetatwo(2,1,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(2,1,3,2,i2,j2,k2)+hatetatwo(2,1,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(2,1,3,3,i2,j2,k2)+hatetatwo(2,1,3,3,i2,j2,k2)))/dz-(hatctwo(2,1,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(2,1,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,1,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(2,1,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(2,1,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,1,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(2,1,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(2,1,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,1,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta2(i,j,k)*w(2,1,i,j,k)*dt+w(2,1,i,j,k);
                        w(2,2,i,j,k)=(hateta(2,2,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(2,2,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(2,2,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(2,2,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(2,2,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(2,2,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(2,2,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(2,2,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(2,2,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(2,2,1,1,i2,j2,k2)+hatetatwo(2,2,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(2,2,1,2,i2,j2,k2)+hatetatwo(2,2,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(2,2,1,3,i2,j2,k2)+hatetatwo(2,2,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(2,2,2,1,i2,j2,k2)+hatetatwo(2,2,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(2,2,2,2,i2,j2,k2)+hatetatwo(2,2,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(2,2,2,3,i2,j2,k2)+hatetatwo(2,2,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(2,2,3,1,i2,j2,k2)+hatetatwo(2,2,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(2,2,3,2,i2,j2,k2)+hatetatwo(2,2,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(2,2,3,3,i2,j2,k2)+hatetatwo(2,2,3,3,i2,j2,k2)))/dz-(hatctwo(2,2,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(2,2,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,2,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(2,2,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(2,2,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,2,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(2,2,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(2,2,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,2,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta2(i,j,k)*w(2,2,i,j,k)*dt+w(2,2,i,j,k);
                        w(2,3,i,j,k)=(hateta(2,3,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(2,3,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(2,3,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(2,3,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(2,3,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(2,3,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(2,3,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(2,3,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(2,3,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(2,3,1,1,i2,j2,k2)+hatetatwo(2,3,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(2,3,1,2,i2,j2,k2)+hatetatwo(2,3,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(2,3,1,3,i2,j2,k2)+hatetatwo(2,3,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(2,3,2,1,i2,j2,k2)+hatetatwo(2,3,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(2,3,2,2,i2,j2,k2)+hatetatwo(2,3,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(2,3,2,3,i2,j2,k2)+hatetatwo(2,3,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(2,3,3,1,i2,j2,k2)+hatetatwo(2,3,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(2,3,3,2,i2,j2,k2)+hatetatwo(2,3,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(2,3,3,3,i2,j2,k2)+hatetatwo(2,3,3,3,i2,j2,k2)))/dz-(hatctwo(2,3,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(2,3,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,3,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(2,3,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(2,3,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,3,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(2,3,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(2,3,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(2,3,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta2(i,j,k)*w(2,3,i,j,k)*dt+w(2,3,i,j,k);
                        w(3,1,i,j,k)=(hateta(3,1,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(3,1,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(3,1,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(3,1,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(3,1,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(3,1,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(3,1,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(3,1,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(3,1,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(3,1,1,1,i2,j2,k2)+hatetatwo(3,1,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(3,1,1,2,i2,j2,k2)+hatetatwo(3,1,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(3,1,1,3,i2,j2,k2)+hatetatwo(3,1,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(3,1,2,1,i2,j2,k2)+hatetatwo(3,1,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(3,1,2,2,i2,j2,k2)+hatetatwo(3,1,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(3,1,2,3,i2,j2,k2)+hatetatwo(3,1,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(3,1,3,1,i2,j2,k2)+hatetatwo(3,1,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(3,1,3,2,i2,j2,k2)+hatetatwo(3,1,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(3,1,3,3,i2,j2,k2)+hatetatwo(3,1,3,3,i2,j2,k2)))/dz-(hatctwo(3,1,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(3,1,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,1,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(3,1,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(3,1,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,1,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(3,1,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(3,1,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,1,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta3(i,j,k)*w(3,1,i,j,k)*dt+w(3,1,i,j,k);
                        w(3,2,i,j,k)=(hateta(3,2,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(3,2,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(3,2,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(3,2,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(3,2,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(3,2,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(3,2,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(3,2,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(3,2,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(3,2,1,1,i2,j2,k2)+hatetatwo(3,2,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(3,2,1,2,i2,j2,k2)+hatetatwo(3,2,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(3,2,1,3,i2,j2,k2)+hatetatwo(3,2,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(3,2,2,1,i2,j2,k2)+hatetatwo(3,2,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(3,2,2,2,i2,j2,k2)+hatetatwo(3,2,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(3,2,2,3,i2,j2,k2)+hatetatwo(3,2,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(3,2,3,1,i2,j2,k2)+hatetatwo(3,2,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(3,2,3,2,i2,j2,k2)+hatetatwo(3,2,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(3,2,3,3,i2,j2,k2)+hatetatwo(3,2,3,3,i2,j2,k2)))/dz-(hatctwo(3,2,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(3,2,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,2,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(3,2,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(3,2,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,2,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(3,2,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(3,2,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,2,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta3(i,j,k)*w(3,2,i,j,k)*dt+w(3,2,i,j,k);
                        w(3,3,i,j,k)=(hateta(3,3,1,1,i2,j2,k2)*(ux(i-1,j,k,l-1)/2-ux(i-1,j,k,l)/2-ux(i+1,j,k,l-1)/2+ux(i+1,j,k,l)/2))/(dt*dx)-(hatctwo(3,3,1,2,i2,j2,k2)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(3,3,1,3,i2,j2,k2)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(3,3,2,1,i2,j2,k2)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(3,3,2,2,i2,j2,k2)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(3,3,2,3,i2,j2,k2)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(3,3,3,1,i2,j2,k2)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(3,3,3,2,i2,j2,k2)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(3,3,3,3,i2,j2,k2)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2)*(hatc(3,3,1,1,i2,j2,k2)+hatetatwo(3,3,1,1,i2,j2,k2)))/dx-((ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2)*(hatc(3,3,1,2,i2,j2,k2)+hatetatwo(3,3,1,2,i2,j2,k2)))/dy-((ux(i,j,k-1,l)/2-ux(i,j,k+1,l)/2)*(hatc(3,3,1,3,i2,j2,k2)+hatetatwo(3,3,1,3,i2,j2,k2)))/dz-((uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2)*(hatc(3,3,2,1,i2,j2,k2)+hatetatwo(3,3,2,1,i2,j2,k2)))/dx-((uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2)*(hatc(3,3,2,2,i2,j2,k2)+hatetatwo(3,3,2,2,i2,j2,k2)))/dy-((uy(i,j,k-1,l)/2-uy(i,j,k+1,l)/2)*(hatc(3,3,2,3,i2,j2,k2)+hatetatwo(3,3,2,3,i2,j2,k2)))/dz-((uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2)*(hatc(3,3,3,1,i2,j2,k2)+hatetatwo(3,3,3,1,i2,j2,k2)))/dx-((uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2)*(hatc(3,3,3,2,i2,j2,k2)+hatetatwo(3,3,3,2,i2,j2,k2)))/dy-((uz(i,j,k-1,l)/2-uz(i,j,k+1,l)/2)*(hatc(3,3,3,3,i2,j2,k2)+hatetatwo(3,3,3,3,i2,j2,k2)))/dz-(hatctwo(3,3,1,1,i2,j2,k2)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(3,3,1,2,i2,j2,k2)*(ux(i,j-1,k,l-1)/2-ux(i,j-1,k,l)/2-ux(i,j+1,k,l-1)/2+ux(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,3,1,3,i2,j2,k2)*(ux(i,j,k-1,l-1)/2-ux(i,j,k-1,l)/2-ux(i,j,k+1,l-1)/2+ux(i,j,k+1,l)/2))/(dt*dz)+(hateta(3,3,2,1,i2,j2,k2)*(uy(i-1,j,k,l-1)/2-uy(i-1,j,k,l)/2-uy(i+1,j,k,l-1)/2+uy(i+1,j,k,l)/2))/(dt*dx)+(hateta(3,3,2,2,i2,j2,k2)*(uy(i,j-1,k,l-1)/2-uy(i,j-1,k,l)/2-uy(i,j+1,k,l-1)/2+uy(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,3,2,3,i2,j2,k2)*(uy(i,j,k-1,l-1)/2-uy(i,j,k-1,l)/2-uy(i,j,k+1,l-1)/2+uy(i,j,k+1,l)/2))/(dt*dz)+(hateta(3,3,3,1,i2,j2,k2)*(uz(i-1,j,k,l-1)/2-uz(i-1,j,k,l)/2-uz(i+1,j,k,l-1)/2+uz(i+1,j,k,l)/2))/(dt*dx)+(hateta(3,3,3,2,i2,j2,k2)*(uz(i,j-1,k,l-1)/2-uz(i,j-1,k,l)/2-uz(i,j+1,k,l-1)/2+uz(i,j+1,k,l)/2))/(dt*dy)+(hateta(3,3,3,3,i2,j2,k2)*(uz(i,j,k-1,l-1)/2-uz(i,j,k-1,l)/2-uz(i,j,k+1,l-1)/2+uz(i,j,k+1,l)/2))/(dt*dz)...
                            -beta3(i,j,k)*w(3,3,i,j,k)*dt+w(3,3,i,j,k);
                    end
                end
            end
            %% compute u
            for i=2:nx-1
                for j=2:ny-1
                    for k=3:nz-1
                        [i2,j2,k2]=rd(i,j,k);
                        ux(i,j,k,l+1)=((w(1,1,i2+1,j2,k2)-w(1,1,i2-1,j2,k2))/2/dx-Eta(6,6,i2,j2,k2)*((ux(i,j-1,k,l-1)-2*ux(i,j,k,l-1)+ux(i,j+1,k,l-1))/(dt*dy^2)-(ux(i,j-1,k,l)-2*ux(i,j,k,l)+ux(i,j+1,k,l))/(dt*dy^2))-Eta(5,5,i2,j2,k2)*((ux(i,j,k-1,l-1)-2*ux(i,j,k,l-1)+ux(i,j,k+1,l-1))/(dt*dz^2)-(ux(i,j,k-1,l)-2*ux(i,j,k,l)+ux(i,j,k+1,l))/(dt*dz^2))-Eta(1,6,i2,j2,k2)*((uy(i-1,j,k,l-1)-2*uy(i,j,k,l-1)+uy(i+1,j,k,l-1))/(dt*dx^2)-(uy(i-1,j,k,l)-2*uy(i,j,k,l)+uy(i+1,j,k,l))/(dt*dx^2))-Eta(2,6,i2,j2,k2)*((uy(i,j-1,k,l-1)-2*uy(i,j,k,l-1)+uy(i,j+1,k,l-1))/(dt*dy^2)-(uy(i,j-1,k,l)-2*uy(i,j,k,l)+uy(i,j+1,k,l))/(dt*dy^2))-Eta(4,5,i2,j2,k2)*((uy(i,j,k-1,l-1)-2*uy(i,j,k,l-1)+uy(i,j,k+1,l-1))/(dt*dz^2)-(uy(i,j,k-1,l)-2*uy(i,j,k,l)+uy(i,j,k+1,l))/(dt*dz^2))-Eta(1,5,i2,j2,k2)*((uz(i-1,j,k,l-1)-2*uz(i,j,k,l-1)+uz(i+1,j,k,l-1))/(dt*dx^2)-(uz(i-1,j,k,l)-2*uz(i,j,k,l)+uz(i+1,j,k,l))/(dt*dx^2))-Eta(4,6,i2,j2,k2)*((uz(i,j-1,k,l-1)-2*uz(i,j,k,l-1)+uz(i,j+1,k,l-1))/(dt*dy^2)-(uz(i,j-1,k,l)-2*uz(i,j,k,l)+uz(i,j+1,k,l))/(dt*dy^2))-Eta(3,5,i2,j2,k2)*((uz(i,j,k-1,l-1)-2*uz(i,j,k,l-1)+uz(i,j,k+1,l-1))/(dt*dz^2)-(uz(i,j,k-1,l)-2*uz(i,j,k,l)+uz(i,j,k+1,l))/(dt*dz^2))-Eta(1,1,i2,j2,k2)*((ux(i-1,j,k,l-1)-2*ux(i,j,k,l-1)+ux(i+1,j,k,l-1))/(dt*dx^2)-(ux(i-1,j,k,l)-2*ux(i,j,k,l)+ux(i+1,j,k,l))/(dt*dx^2))+(w(1,2,i2,j2+1,k2)-w(1,2,i2,j2-1,k2))/2/dy+(w(1,3,i2,j2,k2+1)-w(1,3,i2,j2,k2-1))/2/dz-rho(i,j,k)*(Ux(i,j,k)*ctwo(i2,j2,k2)+b(i2,j2,k2)*ux(i,j,k,l)+(ux(i,j,k,l-1)-2*ux(i,j,k,l))/dt^2-(a(i2,j2,k2)*ux(i,j,k,l))/dt)-2*Eta(1,6,i2,j2,k2)*((ux(i-1,j-1,k,l-1)/4-ux(i-1,j+1,k,l-1)/4-ux(i+1,j-1,k,l-1)/4+ux(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(ux(i-1,j-1,k,l)/4-ux(i-1,j+1,k,l)/4-ux(i+1,j-1,k,l)/4+ux(i+1,j+1,k,l)/4)/(dt*dx*dy))-2*Eta(1,5,i2,j2,k2)*((ux(i-1,j,k-1,l-1)/4-ux(i-1,j,k+1,l-1)/4-ux(i+1,j,k-1,l-1)/4+ux(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(ux(i-1,j,k-1,l)/4-ux(i-1,j,k+1,l)/4-ux(i+1,j,k-1,l)/4+ux(i+1,j,k+1,l)/4)/(dt*dx*dz))-2*Eta(5,6,i2,j2,k2)*((ux(i,j-1,k-1,l-1)/4-ux(i,j-1,k+1,l-1)/4-ux(i,j+1,k-1,l-1)/4+ux(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(ux(i,j-1,k-1,l)/4-ux(i,j-1,k+1,l)/4-ux(i,j+1,k-1,l)/4+ux(i,j+1,k+1,l)/4)/(dt*dy*dz))-Eta(1,2,i2,j2,k2)*((uy(i-1,j-1,k,l-1)/4-uy(i-1,j+1,k,l-1)/4-uy(i+1,j-1,k,l-1)/4+uy(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(uy(i-1,j-1,k,l)/4-uy(i-1,j+1,k,l)/4-uy(i+1,j-1,k,l)/4+uy(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(6,6,i2,j2,k2)*((uy(i-1,j-1,k,l-1)/4-uy(i-1,j+1,k,l-1)/4-uy(i+1,j-1,k,l-1)/4+uy(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(uy(i-1,j-1,k,l)/4-uy(i-1,j+1,k,l)/4-uy(i+1,j-1,k,l)/4+uy(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(1,4,i2,j2,k2)*((uy(i-1,j,k-1,l-1)/4-uy(i-1,j,k+1,l-1)/4-uy(i+1,j,k-1,l-1)/4+uy(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(uy(i-1,j,k-1,l)/4-uy(i-1,j,k+1,l)/4-uy(i+1,j,k-1,l)/4+uy(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(5,6,i2,j2,k2)*((uy(i-1,j,k-1,l-1)/4-uy(i-1,j,k+1,l-1)/4-uy(i+1,j,k-1,l-1)/4+uy(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(uy(i-1,j,k-1,l)/4-uy(i-1,j,k+1,l)/4-uy(i+1,j,k-1,l)/4+uy(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(2,5,i2,j2,k2)*((uy(i,j-1,k-1,l-1)/4-uy(i,j-1,k+1,l-1)/4-uy(i,j+1,k-1,l-1)/4+uy(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(uy(i,j-1,k-1,l)/4-uy(i,j-1,k+1,l)/4-uy(i,j+1,k-1,l)/4+uy(i,j+1,k+1,l)/4)/(dt*dy*dz))-Eta(4,6,i2,j2,k2)*((uy(i,j-1,k-1,l-1)/4-uy(i,j-1,k+1,l-1)/4-uy(i,j+1,k-1,l-1)/4+uy(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(uy(i,j-1,k-1,l)/4-uy(i,j-1,k+1,l)/4-uy(i,j+1,k-1,l)/4+uy(i,j+1,k+1,l)/4)/(dt*dy*dz))-Eta(1,4,i2,j2,k2)*((uz(i-1,j-1,k,l-1)/4-uz(i-1,j+1,k,l-1)/4-uz(i+1,j-1,k,l-1)/4+uz(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(uz(i-1,j-1,k,l)/4-uz(i-1,j+1,k,l)/4-uz(i+1,j-1,k,l)/4+uz(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(5,6,i2,j2,k2)*((uz(i-1,j-1,k,l-1)/4-uz(i-1,j+1,k,l-1)/4-uz(i+1,j-1,k,l-1)/4+uz(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(uz(i-1,j-1,k,l)/4-uz(i-1,j+1,k,l)/4-uz(i+1,j-1,k,l)/4+uz(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(1,3,i2,j2,k2)*((uz(i-1,j,k-1,l-1)/4-uz(i-1,j,k+1,l-1)/4-uz(i+1,j,k-1,l-1)/4+uz(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(uz(i-1,j,k-1,l)/4-uz(i-1,j,k+1,l)/4-uz(i+1,j,k-1,l)/4+uz(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(5,5,i2,j2,k2)*((uz(i-1,j,k-1,l-1)/4-uz(i-1,j,k+1,l-1)/4-uz(i+1,j,k-1,l-1)/4+uz(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(uz(i-1,j,k-1,l)/4-uz(i-1,j,k+1,l)/4-uz(i+1,j,k-1,l)/4+uz(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(3,6,i2,j2,k2)*((uz(i,j-1,k-1,l-1)/4-uz(i,j-1,k+1,l-1)/4-uz(i,j+1,k-1,l-1)/4+uz(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(uz(i,j-1,k-1,l)/4-uz(i,j-1,k+1,l)/4-uz(i,j+1,k-1,l)/4+uz(i,j+1,k+1,l)/4)/(dt*dy*dz))-Eta(4,5,i2,j2,k2)*((uz(i,j-1,k-1,l-1)/4-uz(i,j-1,k+1,l-1)/4-uz(i,j+1,k-1,l-1)/4+uz(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(uz(i,j-1,k-1,l)/4-uz(i,j-1,k+1,l)/4-uz(i,j+1,k-1,l)/4+uz(i,j+1,k+1,l)/4)/(dt*dy*dz))+(C(1,1,i2,j2,k2)*(ux(i-1,j,k,l)-2*ux(i,j,k,l)+ux(i+1,j,k,l)))/dx^2+(C(6,6,i2,j2,k2)*(ux(i,j-1,k,l)-2*ux(i,j,k,l)+ux(i,j+1,k,l)))/dy^2+(C(5,5,i2,j2,k2)*(ux(i,j,k-1,l)-2*ux(i,j,k,l)+ux(i,j,k+1,l)))/dz^2+(C(1,6,i2,j2,k2)*(uy(i-1,j,k,l)-2*uy(i,j,k,l)+uy(i+1,j,k,l)))/dx^2+(C(2,6,i2,j2,k2)*(uy(i,j-1,k,l)-2*uy(i,j,k,l)+uy(i,j+1,k,l)))/dy^2+(C(4,5,i2,j2,k2)*(uy(i,j,k-1,l)-2*uy(i,j,k,l)+uy(i,j,k+1,l)))/dz^2+(C(1,5,i2,j2,k2)*(uz(i-1,j,k,l)-2*uz(i,j,k,l)+uz(i+1,j,k,l)))/dx^2+(C(4,6,i2,j2,k2)*(uz(i,j-1,k,l)-2*uz(i,j,k,l)+uz(i,j+1,k,l)))/dy^2+(C(3,5,i2,j2,k2)*(uz(i,j,k-1,l)-2*uz(i,j,k,l)+uz(i,j,k+1,l)))/dz^2+srci+(2*C(1,6,i2,j2,k2)*(ux(i-1,j-1,k,l)/4-ux(i-1,j+1,k,l)/4-ux(i+1,j-1,k,l)/4+ux(i+1,j+1,k,l)/4))/(dx*dy)+(2*C(1,5,i2,j2,k2)*(ux(i-1,j,k-1,l)/4-ux(i-1,j,k+1,l)/4-ux(i+1,j,k-1,l)/4+ux(i+1,j,k+1,l)/4))/(dx*dz)+(2*C(5,6,i2,j2,k2)*(ux(i,j-1,k-1,l)/4-ux(i,j-1,k+1,l)/4-ux(i,j+1,k-1,l)/4+ux(i,j+1,k+1,l)/4))/(dy*dz)+(C(1,2,i2,j2,k2)*(uy(i-1,j-1,k,l)/4-uy(i-1,j+1,k,l)/4-uy(i+1,j-1,k,l)/4+uy(i+1,j+1,k,l)/4))/(dx*dy)+(C(6,6,i2,j2,k2)*(uy(i-1,j-1,k,l)/4-uy(i-1,j+1,k,l)/4-uy(i+1,j-1,k,l)/4+uy(i+1,j+1,k,l)/4))/(dx*dy)+(C(1,4,i2,j2,k2)*(uy(i-1,j,k-1,l)/4-uy(i-1,j,k+1,l)/4-uy(i+1,j,k-1,l)/4+uy(i+1,j,k+1,l)/4))/(dx*dz)+(C(5,6,i2,j2,k2)*(uy(i-1,j,k-1,l)/4-uy(i-1,j,k+1,l)/4-uy(i+1,j,k-1,l)/4+uy(i+1,j,k+1,l)/4))/(dx*dz)+(C(2,5,i2,j2,k2)*(uy(i,j-1,k-1,l)/4-uy(i,j-1,k+1,l)/4-uy(i,j+1,k-1,l)/4+uy(i,j+1,k+1,l)/4))/(dy*dz)+(C(4,6,i2,j2,k2)*(uy(i,j-1,k-1,l)/4-uy(i,j-1,k+1,l)/4-uy(i,j+1,k-1,l)/4+uy(i,j+1,k+1,l)/4))/(dy*dz)+(C(1,4,i2,j2,k2)*(uz(i-1,j-1,k,l)/4-uz(i-1,j+1,k,l)/4-uz(i+1,j-1,k,l)/4+uz(i+1,j+1,k,l)/4))/(dx*dy)+(C(5,6,i2,j2,k2)*(uz(i-1,j-1,k,l)/4-uz(i-1,j+1,k,l)/4-uz(i+1,j-1,k,l)/4+uz(i+1,j+1,k,l)/4))/(dx*dy)+(C(1,3,i2,j2,k2)*(uz(i-1,j,k-1,l)/4-uz(i-1,j,k+1,l)/4-uz(i+1,j,k-1,l)/4+uz(i+1,j,k+1,l)/4))/(dx*dz)+(C(5,5,i2,j2,k2)*(uz(i-1,j,k-1,l)/4-uz(i-1,j,k+1,l)/4-uz(i+1,j,k-1,l)/4+uz(i+1,j,k+1,l)/4))/(dx*dz)+(C(3,6,i2,j2,k2)*(uz(i,j-1,k-1,l)/4-uz(i,j-1,k+1,l)/4-uz(i,j+1,k-1,l)/4+uz(i,j+1,k+1,l)/4))/(dy*dz)+(C(4,5,i2,j2,k2)*(uz(i,j-1,k-1,l)/4-uz(i,j-1,k+1,l)/4-uz(i,j+1,k-1,l)/4+uz(i,j+1,k+1,l)/4))/(dy*dz))/(rho(i,j,k)*(a(i2,j2,k2)/dt+1/dt^2));
                        
                        uy(i,j,k,l+1)=((w(2,1,i2+1,j2,k2)-w(2,1,i2-1,j2,k2))/2/dx-Eta(2,6,i2,j2,k2)*((ux(i,j-1,k,l-1)-2*ux(i,j,k,l-1)+ux(i,j+1,k,l-1))/(dt*dy^2)-(ux(i,j-1,k,l)-2*ux(i,j,k,l)+ux(i,j+1,k,l))/(dt*dy^2))-Eta(4,5,i2,j2,k2)*((ux(i,j,k-1,l-1)-2*ux(i,j,k,l-1)+ux(i,j,k+1,l-1))/(dt*dz^2)-(ux(i,j,k-1,l)-2*ux(i,j,k,l)+ux(i,j,k+1,l))/(dt*dz^2))-Eta(6,6,i2,j2,k2)*((uy(i-1,j,k,l-1)-2*uy(i,j,k,l-1)+uy(i+1,j,k,l-1))/(dt*dx^2)-(uy(i-1,j,k,l)-2*uy(i,j,k,l)+uy(i+1,j,k,l))/(dt*dx^2))-Eta(2,2,i2,j2,k2)*((uy(i,j-1,k,l-1)-2*uy(i,j,k,l-1)+uy(i,j+1,k,l-1))/(dt*dy^2)-(uy(i,j-1,k,l)-2*uy(i,j,k,l)+uy(i,j+1,k,l))/(dt*dy^2))-Eta(4,4,i2,j2,k2)*((uy(i,j,k-1,l-1)-2*uy(i,j,k,l-1)+uy(i,j,k+1,l-1))/(dt*dz^2)-(uy(i,j,k-1,l)-2*uy(i,j,k,l)+uy(i,j,k+1,l))/(dt*dz^2))-Eta(5,6,i2,j2,k2)*((uz(i-1,j,k,l-1)-2*uz(i,j,k,l-1)+uz(i+1,j,k,l-1))/(dt*dx^2)-(uz(i-1,j,k,l)-2*uz(i,j,k,l)+uz(i+1,j,k,l))/(dt*dx^2))-Eta(2,4,i2,j2,k2)*((uz(i,j-1,k,l-1)-2*uz(i,j,k,l-1)+uz(i,j+1,k,l-1))/(dt*dy^2)-(uz(i,j-1,k,l)-2*uz(i,j,k,l)+uz(i,j+1,k,l))/(dt*dy^2))-Eta(3,4,i2,j2,k2)*((uz(i,j,k-1,l-1)-2*uz(i,j,k,l-1)+uz(i,j,k+1,l-1))/(dt*dz^2)-(uz(i,j,k-1,l)-2*uz(i,j,k,l)+uz(i,j,k+1,l))/(dt*dz^2))-Eta(1,6,i2,j2,k2)*((ux(i-1,j,k,l-1)-2*ux(i,j,k,l-1)+ux(i+1,j,k,l-1))/(dt*dx^2)-(ux(i-1,j,k,l)-2*ux(i,j,k,l)+ux(i+1,j,k,l))/(dt*dx^2))+(w(2,2,i2,j2+1,k2)-w(2,2,i2,j2-1,k2))/2/dy+(w(2,3,i2,j2,k2+1)-w(2,3,i2,j2,k2-1))/2/dz-rho(i,j,k)*(Uy(i,j,k)*ctwo(i2,j2,k2)+b(i2,j2,k2)*uy(i,j,k,l)+(uy(i,j,k,l-1)-2*uy(i,j,k,l))/dt^2-(a(i2,j2,k2)*uy(i,j,k,l))/dt)-Eta(1,2,i2,j2,k2)*((ux(i-1,j-1,k,l-1)/4-ux(i-1,j+1,k,l-1)/4-ux(i+1,j-1,k,l-1)/4+ux(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(ux(i-1,j-1,k,l)/4-ux(i-1,j+1,k,l)/4-ux(i+1,j-1,k,l)/4+ux(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(6,6,i2,j2,k2)*((ux(i-1,j-1,k,l-1)/4-ux(i-1,j+1,k,l-1)/4-ux(i+1,j-1,k,l-1)/4+ux(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(ux(i-1,j-1,k,l)/4-ux(i-1,j+1,k,l)/4-ux(i+1,j-1,k,l)/4+ux(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(1,4,i2,j2,k2)*((ux(i-1,j,k-1,l-1)/4-ux(i-1,j,k+1,l-1)/4-ux(i+1,j,k-1,l-1)/4+ux(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(ux(i-1,j,k-1,l)/4-ux(i-1,j,k+1,l)/4-ux(i+1,j,k-1,l)/4+ux(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(5,6,i2,j2,k2)*((ux(i-1,j,k-1,l-1)/4-ux(i-1,j,k+1,l-1)/4-ux(i+1,j,k-1,l-1)/4+ux(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(ux(i-1,j,k-1,l)/4-ux(i-1,j,k+1,l)/4-ux(i+1,j,k-1,l)/4+ux(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(2,5,i2,j2,k2)*((ux(i,j-1,k-1,l-1)/4-ux(i,j-1,k+1,l-1)/4-ux(i,j+1,k-1,l-1)/4+ux(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(ux(i,j-1,k-1,l)/4-ux(i,j-1,k+1,l)/4-ux(i,j+1,k-1,l)/4+ux(i,j+1,k+1,l)/4)/(dt*dy*dz))-Eta(4,6,i2,j2,k2)*((ux(i,j-1,k-1,l-1)/4-ux(i,j-1,k+1,l-1)/4-ux(i,j+1,k-1,l-1)/4+ux(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(ux(i,j-1,k-1,l)/4-ux(i,j-1,k+1,l)/4-ux(i,j+1,k-1,l)/4+ux(i,j+1,k+1,l)/4)/(dt*dy*dz))-2*Eta(2,6,i2,j2,k2)*((uy(i-1,j-1,k,l-1)/4-uy(i-1,j+1,k,l-1)/4-uy(i+1,j-1,k,l-1)/4+uy(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(uy(i-1,j-1,k,l)/4-uy(i-1,j+1,k,l)/4-uy(i+1,j-1,k,l)/4+uy(i+1,j+1,k,l)/4)/(dt*dx*dy))-2*Eta(4,6,i2,j2,k2)*((uy(i-1,j,k-1,l-1)/4-uy(i-1,j,k+1,l-1)/4-uy(i+1,j,k-1,l-1)/4+uy(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(uy(i-1,j,k-1,l)/4-uy(i-1,j,k+1,l)/4-uy(i+1,j,k-1,l)/4+uy(i+1,j,k+1,l)/4)/(dt*dx*dz))-2*Eta(2,4,i2,j2,k2)*((uy(i,j-1,k-1,l-1)/4-uy(i,j-1,k+1,l-1)/4-uy(i,j+1,k-1,l-1)/4+uy(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(uy(i,j-1,k-1,l)/4-uy(i,j-1,k+1,l)/4-uy(i,j+1,k-1,l)/4+uy(i,j+1,k+1,l)/4)/(dt*dy*dz))-Eta(2,5,i2,j2,k2)*((uz(i-1,j-1,k,l-1)/4-uz(i-1,j+1,k,l-1)/4-uz(i+1,j-1,k,l-1)/4+uz(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(uz(i-1,j-1,k,l)/4-uz(i-1,j+1,k,l)/4-uz(i+1,j-1,k,l)/4+uz(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(4,6,i2,j2,k2)*((uz(i-1,j-1,k,l-1)/4-uz(i-1,j+1,k,l-1)/4-uz(i+1,j-1,k,l-1)/4+uz(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(uz(i-1,j-1,k,l)/4-uz(i-1,j+1,k,l)/4-uz(i+1,j-1,k,l)/4+uz(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(3,6,i2,j2,k2)*((uz(i-1,j,k-1,l-1)/4-uz(i-1,j,k+1,l-1)/4-uz(i+1,j,k-1,l-1)/4+uz(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(uz(i-1,j,k-1,l)/4-uz(i-1,j,k+1,l)/4-uz(i+1,j,k-1,l)/4+uz(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(4,5,i2,j2,k2)*((uz(i-1,j,k-1,l-1)/4-uz(i-1,j,k+1,l-1)/4-uz(i+1,j,k-1,l-1)/4+uz(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(uz(i-1,j,k-1,l)/4-uz(i-1,j,k+1,l)/4-uz(i+1,j,k-1,l)/4+uz(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(2,3,i2,j2,k2)*((uz(i,j-1,k-1,l-1)/4-uz(i,j-1,k+1,l-1)/4-uz(i,j+1,k-1,l-1)/4+uz(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(uz(i,j-1,k-1,l)/4-uz(i,j-1,k+1,l)/4-uz(i,j+1,k-1,l)/4+uz(i,j+1,k+1,l)/4)/(dt*dy*dz))-Eta(4,4,i2,j2,k2)*((uz(i,j-1,k-1,l-1)/4-uz(i,j-1,k+1,l-1)/4-uz(i,j+1,k-1,l-1)/4+uz(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(uz(i,j-1,k-1,l)/4-uz(i,j-1,k+1,l)/4-uz(i,j+1,k-1,l)/4+uz(i,j+1,k+1,l)/4)/(dt*dy*dz))+(C(1,6,i2,j2,k2)*(ux(i-1,j,k,l)-2*ux(i,j,k,l)+ux(i+1,j,k,l)))/dx^2+(C(2,6,i2,j2,k2)*(ux(i,j-1,k,l)-2*ux(i,j,k,l)+ux(i,j+1,k,l)))/dy^2+(C(4,5,i2,j2,k2)*(ux(i,j,k-1,l)-2*ux(i,j,k,l)+ux(i,j,k+1,l)))/dz^2+(C(6,6,i2,j2,k2)*(uy(i-1,j,k,l)-2*uy(i,j,k,l)+uy(i+1,j,k,l)))/dx^2+(C(2,2,i2,j2,k2)*(uy(i,j-1,k,l)-2*uy(i,j,k,l)+uy(i,j+1,k,l)))/dy^2+(C(4,4,i2,j2,k2)*(uy(i,j,k-1,l)-2*uy(i,j,k,l)+uy(i,j,k+1,l)))/dz^2+(C(5,6,i2,j2,k2)*(uz(i-1,j,k,l)-2*uz(i,j,k,l)+uz(i+1,j,k,l)))/dx^2+(C(2,4,i2,j2,k2)*(uz(i,j-1,k,l)-2*uz(i,j,k,l)+uz(i,j+1,k,l)))/dy^2+(C(3,4,i2,j2,k2)*(uz(i,j,k-1,l)-2*uz(i,j,k,l)+uz(i,j,k+1,l)))/dz^2+srci+(C(1,2,i2,j2,k2)*(ux(i-1,j-1,k,l)/4-ux(i-1,j+1,k,l)/4-ux(i+1,j-1,k,l)/4+ux(i+1,j+1,k,l)/4))/(dx*dy)+(C(6,6,i2,j2,k2)*(ux(i-1,j-1,k,l)/4-ux(i-1,j+1,k,l)/4-ux(i+1,j-1,k,l)/4+ux(i+1,j+1,k,l)/4))/(dx*dy)+(C(1,4,i2,j2,k2)*(ux(i-1,j,k-1,l)/4-ux(i-1,j,k+1,l)/4-ux(i+1,j,k-1,l)/4+ux(i+1,j,k+1,l)/4))/(dx*dz)+(C(5,6,i2,j2,k2)*(ux(i-1,j,k-1,l)/4-ux(i-1,j,k+1,l)/4-ux(i+1,j,k-1,l)/4+ux(i+1,j,k+1,l)/4))/(dx*dz)+(C(2,5,i2,j2,k2)*(ux(i,j-1,k-1,l)/4-ux(i,j-1,k+1,l)/4-ux(i,j+1,k-1,l)/4+ux(i,j+1,k+1,l)/4))/(dy*dz)+(C(4,6,i2,j2,k2)*(ux(i,j-1,k-1,l)/4-ux(i,j-1,k+1,l)/4-ux(i,j+1,k-1,l)/4+ux(i,j+1,k+1,l)/4))/(dy*dz)+(2*C(2,6,i2,j2,k2)*(uy(i-1,j-1,k,l)/4-uy(i-1,j+1,k,l)/4-uy(i+1,j-1,k,l)/4+uy(i+1,j+1,k,l)/4))/(dx*dy)+(2*C(4,6,i2,j2,k2)*(uy(i-1,j,k-1,l)/4-uy(i-1,j,k+1,l)/4-uy(i+1,j,k-1,l)/4+uy(i+1,j,k+1,l)/4))/(dx*dz)+(2*C(2,4,i2,j2,k2)*(uy(i,j-1,k-1,l)/4-uy(i,j-1,k+1,l)/4-uy(i,j+1,k-1,l)/4+uy(i,j+1,k+1,l)/4))/(dy*dz)+(C(2,5,i2,j2,k2)*(uz(i-1,j-1,k,l)/4-uz(i-1,j+1,k,l)/4-uz(i+1,j-1,k,l)/4+uz(i+1,j+1,k,l)/4))/(dx*dy)+(C(4,6,i2,j2,k2)*(uz(i-1,j-1,k,l)/4-uz(i-1,j+1,k,l)/4-uz(i+1,j-1,k,l)/4+uz(i+1,j+1,k,l)/4))/(dx*dy)+(C(3,6,i2,j2,k2)*(uz(i-1,j,k-1,l)/4-uz(i-1,j,k+1,l)/4-uz(i+1,j,k-1,l)/4+uz(i+1,j,k+1,l)/4))/(dx*dz)+(C(4,5,i2,j2,k2)*(uz(i-1,j,k-1,l)/4-uz(i-1,j,k+1,l)/4-uz(i+1,j,k-1,l)/4+uz(i+1,j,k+1,l)/4))/(dx*dz)+(C(2,3,i2,j2,k2)*(uz(i,j-1,k-1,l)/4-uz(i,j-1,k+1,l)/4-uz(i,j+1,k-1,l)/4+uz(i,j+1,k+1,l)/4))/(dy*dz)+(C(4,4,i2,j2,k2)*(uz(i,j-1,k-1,l)/4-uz(i,j-1,k+1,l)/4-uz(i,j+1,k-1,l)/4+uz(i,j+1,k+1,l)/4))/(dy*dz))/(rho(i,j,k)*(a(i2,j2,k2)/dt+1/dt^2));
                        
                        uz(i,j,k,l+1)=((w(3,1,i2+1,j2,k2)-w(3,1,i2-1,j2,k2))/2/dx-Eta(4,6,i2,j2,k2)*((ux(i,j-1,k,l-1)-2*ux(i,j,k,l-1)+ux(i,j+1,k,l-1))/(dt*dy^2)-(ux(i,j-1,k,l)-2*ux(i,j,k,l)+ux(i,j+1,k,l))/(dt*dy^2))-Eta(3,5,i2,j2,k2)*((ux(i,j,k-1,l-1)-2*ux(i,j,k,l-1)+ux(i,j,k+1,l-1))/(dt*dz^2)-(ux(i,j,k-1,l)-2*ux(i,j,k,l)+ux(i,j,k+1,l))/(dt*dz^2))-Eta(5,6,i2,j2,k2)*((uy(i-1,j,k,l-1)-2*uy(i,j,k,l-1)+uy(i+1,j,k,l-1))/(dt*dx^2)-(uy(i-1,j,k,l)-2*uy(i,j,k,l)+uy(i+1,j,k,l))/(dt*dx^2))-Eta(2,4,i2,j2,k2)*((uy(i,j-1,k,l-1)-2*uy(i,j,k,l-1)+uy(i,j+1,k,l-1))/(dt*dy^2)-(uy(i,j-1,k,l)-2*uy(i,j,k,l)+uy(i,j+1,k,l))/(dt*dy^2))-Eta(3,4,i2,j2,k2)*((uy(i,j,k-1,l-1)-2*uy(i,j,k,l-1)+uy(i,j,k+1,l-1))/(dt*dz^2)-(uy(i,j,k-1,l)-2*uy(i,j,k,l)+uy(i,j,k+1,l))/(dt*dz^2))-Eta(5,5,i2,j2,k2)*((uz(i-1,j,k,l-1)-2*uz(i,j,k,l-1)+uz(i+1,j,k,l-1))/(dt*dx^2)-(uz(i-1,j,k,l)-2*uz(i,j,k,l)+uz(i+1,j,k,l))/(dt*dx^2))-Eta(4,4,i2,j2,k2)*((uz(i,j-1,k,l-1)-2*uz(i,j,k,l-1)+uz(i,j+1,k,l-1))/(dt*dy^2)-(uz(i,j-1,k,l)-2*uz(i,j,k,l)+uz(i,j+1,k,l))/(dt*dy^2))-Eta(3,3,i2,j2,k2)*((uz(i,j,k-1,l-1)-2*uz(i,j,k,l-1)+uz(i,j,k+1,l-1))/(dt*dz^2)-(uz(i,j,k-1,l)-2*uz(i,j,k,l)+uz(i,j,k+1,l))/(dt*dz^2))-Eta(1,5,i2,j2,k2)*((ux(i-1,j,k,l-1)-2*ux(i,j,k,l-1)+ux(i+1,j,k,l-1))/(dt*dx^2)-(ux(i-1,j,k,l)-2*ux(i,j,k,l)+ux(i+1,j,k,l))/(dt*dx^2))+(w(3,2,i2,j2+1,k2)-w(3,2,i2,j2-1,k2))/2/dy+(w(3,3,i2,j2,k2+1)-w(3,3,i2,j2,k2-1))/2/dz-rho(i,j,k)*(Uz(i,j,k)*ctwo(i2,j2,k2)+b(i2,j2,k2)*uz(i,j,k,l)+(uz(i,j,k,l-1)-2*uz(i,j,k,l))/dt^2-(a(i2,j2,k2)*uz(i,j,k,l))/dt)-Eta(1,4,i2,j2,k2)*((ux(i-1,j-1,k,l-1)/4-ux(i-1,j+1,k,l-1)/4-ux(i+1,j-1,k,l-1)/4+ux(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(ux(i-1,j-1,k,l)/4-ux(i-1,j+1,k,l)/4-ux(i+1,j-1,k,l)/4+ux(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(5,6,i2,j2,k2)*((ux(i-1,j-1,k,l-1)/4-ux(i-1,j+1,k,l-1)/4-ux(i+1,j-1,k,l-1)/4+ux(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(ux(i-1,j-1,k,l)/4-ux(i-1,j+1,k,l)/4-ux(i+1,j-1,k,l)/4+ux(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(1,3,i2,j2,k2)*((ux(i-1,j,k-1,l-1)/4-ux(i-1,j,k+1,l-1)/4-ux(i+1,j,k-1,l-1)/4+ux(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(ux(i-1,j,k-1,l)/4-ux(i-1,j,k+1,l)/4-ux(i+1,j,k-1,l)/4+ux(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(5,5,i2,j2,k2)*((ux(i-1,j,k-1,l-1)/4-ux(i-1,j,k+1,l-1)/4-ux(i+1,j,k-1,l-1)/4+ux(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(ux(i-1,j,k-1,l)/4-ux(i-1,j,k+1,l)/4-ux(i+1,j,k-1,l)/4+ux(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(3,6,i2,j2,k2)*((ux(i,j-1,k-1,l-1)/4-ux(i,j-1,k+1,l-1)/4-ux(i,j+1,k-1,l-1)/4+ux(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(ux(i,j-1,k-1,l)/4-ux(i,j-1,k+1,l)/4-ux(i,j+1,k-1,l)/4+ux(i,j+1,k+1,l)/4)/(dt*dy*dz))-Eta(4,5,i2,j2,k2)*((ux(i,j-1,k-1,l-1)/4-ux(i,j-1,k+1,l-1)/4-ux(i,j+1,k-1,l-1)/4+ux(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(ux(i,j-1,k-1,l)/4-ux(i,j-1,k+1,l)/4-ux(i,j+1,k-1,l)/4+ux(i,j+1,k+1,l)/4)/(dt*dy*dz))-Eta(2,5,i2,j2,k2)*((uy(i-1,j-1,k,l-1)/4-uy(i-1,j+1,k,l-1)/4-uy(i+1,j-1,k,l-1)/4+uy(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(uy(i-1,j-1,k,l)/4-uy(i-1,j+1,k,l)/4-uy(i+1,j-1,k,l)/4+uy(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(4,6,i2,j2,k2)*((uy(i-1,j-1,k,l-1)/4-uy(i-1,j+1,k,l-1)/4-uy(i+1,j-1,k,l-1)/4+uy(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(uy(i-1,j-1,k,l)/4-uy(i-1,j+1,k,l)/4-uy(i+1,j-1,k,l)/4+uy(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(3,6,i2,j2,k2)*((uy(i-1,j,k-1,l-1)/4-uy(i-1,j,k+1,l-1)/4-uy(i+1,j,k-1,l-1)/4+uy(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(uy(i-1,j,k-1,l)/4-uy(i-1,j,k+1,l)/4-uy(i+1,j,k-1,l)/4+uy(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(4,5,i2,j2,k2)*((uy(i-1,j,k-1,l-1)/4-uy(i-1,j,k+1,l-1)/4-uy(i+1,j,k-1,l-1)/4+uy(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(uy(i-1,j,k-1,l)/4-uy(i-1,j,k+1,l)/4-uy(i+1,j,k-1,l)/4+uy(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(2,3,i2,j2,k2)*((uy(i,j-1,k-1,l-1)/4-uy(i,j-1,k+1,l-1)/4-uy(i,j+1,k-1,l-1)/4+uy(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(uy(i,j-1,k-1,l)/4-uy(i,j-1,k+1,l)/4-uy(i,j+1,k-1,l)/4+uy(i,j+1,k+1,l)/4)/(dt*dy*dz))-Eta(4,4,i2,j2,k2)*((uy(i,j-1,k-1,l-1)/4-uy(i,j-1,k+1,l-1)/4-uy(i,j+1,k-1,l-1)/4+uy(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(uy(i,j-1,k-1,l)/4-uy(i,j-1,k+1,l)/4-uy(i,j+1,k-1,l)/4+uy(i,j+1,k+1,l)/4)/(dt*dy*dz))-2*Eta(4,5,i2,j2,k2)*((uz(i-1,j-1,k,l-1)/4-uz(i-1,j+1,k,l-1)/4-uz(i+1,j-1,k,l-1)/4+uz(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(uz(i-1,j-1,k,l)/4-uz(i-1,j+1,k,l)/4-uz(i+1,j-1,k,l)/4+uz(i+1,j+1,k,l)/4)/(dt*dx*dy))-2*Eta(3,5,i2,j2,k2)*((uz(i-1,j,k-1,l-1)/4-uz(i-1,j,k+1,l-1)/4-uz(i+1,j,k-1,l-1)/4+uz(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(uz(i-1,j,k-1,l)/4-uz(i-1,j,k+1,l)/4-uz(i+1,j,k-1,l)/4+uz(i+1,j,k+1,l)/4)/(dt*dx*dz))-2*Eta(3,4,i2,j2,k2)*((uz(i,j-1,k-1,l-1)/4-uz(i,j-1,k+1,l-1)/4-uz(i,j+1,k-1,l-1)/4+uz(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(uz(i,j-1,k-1,l)/4-uz(i,j-1,k+1,l)/4-uz(i,j+1,k-1,l)/4+uz(i,j+1,k+1,l)/4)/(dt*dy*dz))+(C(1,5,i2,j2,k2)*(ux(i-1,j,k,l)-2*ux(i,j,k,l)+ux(i+1,j,k,l)))/dx^2+(C(4,6,i2,j2,k2)*(ux(i,j-1,k,l)-2*ux(i,j,k,l)+ux(i,j+1,k,l)))/dy^2+(C(3,5,i2,j2,k2)*(ux(i,j,k-1,l)-2*ux(i,j,k,l)+ux(i,j,k+1,l)))/dz^2+(C(5,6,i2,j2,k2)*(uy(i-1,j,k,l)-2*uy(i,j,k,l)+uy(i+1,j,k,l)))/dx^2+(C(2,4,i2,j2,k2)*(uy(i,j-1,k,l)-2*uy(i,j,k,l)+uy(i,j+1,k,l)))/dy^2+(C(3,4,i2,j2,k2)*(uy(i,j,k-1,l)-2*uy(i,j,k,l)+uy(i,j,k+1,l)))/dz^2+(C(5,5,i2,j2,k2)*(uz(i-1,j,k,l)-2*uz(i,j,k,l)+uz(i+1,j,k,l)))/dx^2+(C(4,4,i2,j2,k2)*(uz(i,j-1,k,l)-2*uz(i,j,k,l)+uz(i,j+1,k,l)))/dy^2+(C(3,3,i2,j2,k2)*(uz(i,j,k-1,l)-2*uz(i,j,k,l)+uz(i,j,k+1,l)))/dz^2+srci+(C(1,4,i2,j2,k2)*(ux(i-1,j-1,k,l)/4-ux(i-1,j+1,k,l)/4-ux(i+1,j-1,k,l)/4+ux(i+1,j+1,k,l)/4))/(dx*dy)+(C(5,6,i2,j2,k2)*(ux(i-1,j-1,k,l)/4-ux(i-1,j+1,k,l)/4-ux(i+1,j-1,k,l)/4+ux(i+1,j+1,k,l)/4))/(dx*dy)+(C(1,3,i2,j2,k2)*(ux(i-1,j,k-1,l)/4-ux(i-1,j,k+1,l)/4-ux(i+1,j,k-1,l)/4+ux(i+1,j,k+1,l)/4))/(dx*dz)+(C(5,5,i2,j2,k2)*(ux(i-1,j,k-1,l)/4-ux(i-1,j,k+1,l)/4-ux(i+1,j,k-1,l)/4+ux(i+1,j,k+1,l)/4))/(dx*dz)+(C(3,6,i2,j2,k2)*(ux(i,j-1,k-1,l)/4-ux(i,j-1,k+1,l)/4-ux(i,j+1,k-1,l)/4+ux(i,j+1,k+1,l)/4))/(dy*dz)+(C(4,5,i2,j2,k2)*(ux(i,j-1,k-1,l)/4-ux(i,j-1,k+1,l)/4-ux(i,j+1,k-1,l)/4+ux(i,j+1,k+1,l)/4))/(dy*dz)+(C(2,5,i2,j2,k2)*(uy(i-1,j-1,k,l)/4-uy(i-1,j+1,k,l)/4-uy(i+1,j-1,k,l)/4+uy(i+1,j+1,k,l)/4))/(dx*dy)+(C(4,6,i2,j2,k2)*(uy(i-1,j-1,k,l)/4-uy(i-1,j+1,k,l)/4-uy(i+1,j-1,k,l)/4+uy(i+1,j+1,k,l)/4))/(dx*dy)+(C(3,6,i2,j2,k2)*(uy(i-1,j,k-1,l)/4-uy(i-1,j,k+1,l)/4-uy(i+1,j,k-1,l)/4+uy(i+1,j,k+1,l)/4))/(dx*dz)+(C(4,5,i2,j2,k2)*(uy(i-1,j,k-1,l)/4-uy(i-1,j,k+1,l)/4-uy(i+1,j,k-1,l)/4+uy(i+1,j,k+1,l)/4))/(dx*dz)+(C(2,3,i2,j2,k2)*(uy(i,j-1,k-1,l)/4-uy(i,j-1,k+1,l)/4-uy(i,j+1,k-1,l)/4+uy(i,j+1,k+1,l)/4))/(dy*dz)+(C(4,4,i2,j2,k2)*(uy(i,j-1,k-1,l)/4-uy(i,j-1,k+1,l)/4-uy(i,j+1,k-1,l)/4+uy(i,j+1,k+1,l)/4))/(dy*dz)+(2*C(4,5,i2,j2,k2)*(uz(i-1,j-1,k,l)/4-uz(i-1,j+1,k,l)/4-uz(i+1,j-1,k,l)/4+uz(i+1,j+1,k,l)/4))/(dx*dy)+(2*C(3,5,i2,j2,k2)*(uz(i-1,j,k-1,l)/4-uz(i-1,j,k+1,l)/4-uz(i+1,j,k-1,l)/4+uz(i+1,j,k+1,l)/4))/(dx*dz)+(2*C(3,4,i2,j2,k2)*(uz(i,j-1,k-1,l)/4-uz(i,j-1,k+1,l)/4-uz(i,j+1,k-1,l)/4+uz(i,j+1,k+1,l)/4))/(dy*dz))/(rho(i,j,k)*(a(i2,j2,k2)/dt+1/dt^2));
                    
                    end
                end
            end
            %% free surface
            k=1;
              for i=2:nx-1
                for j=2:ny-1
                   [i2,j2,k2]=rd(i,j,k);
                    Id=id(nx,ny,nz,1,i,j,k,1,i,j,k);
                    % first eq
                    B(Id(1)  )=-((Eta(1,5,i2,j2,k2)*(ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2))/(dt*dx)+(Eta(5,6,i2,j2,k2)*(ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2))/(dt*dy)+(Eta(5,6,i2,j2,k2)*(uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2))/(dt*dx)+(Eta(2,5,i2,j2,k2)*(uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2))/(dt*dy)+(Eta(5,5,i2,j2,k2)*(uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2))/(dt*dx)+(Eta(4,5,i2,j2,k2)*(uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2))/(dt*dy)+(Eta(5,5,i2,j2,k2)*(ux(i,j,k,l)-ux(i,j,k+1,l)))/(dt*dz)+(Eta(4,5,i2,j2,k2)*(uy(i,j,k,l)-uy(i,j,k+1,l)))/(dt*dz)+(Eta(3,5,i2,j2,k2)*(uz(i,j,k,l)-uz(i,j,k+1,l)))/(dt*dz));
                    
                    % second eq
                    B(Id(1)+1)=-((Eta(1,4,i2,j2,k2)*(ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2))/(dt*dx)+(Eta(4,6,i2,j2,k2)*(ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2))/(dt*dy)+(Eta(4,6,i2,j2,k2)*(uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2))/(dt*dx)+(Eta(2,4,i2,j2,k2)*(uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2))/(dt*dy)+(Eta(4,5,i2,j2,k2)*(uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2))/(dt*dx)+(Eta(4,4,i2,j2,k2)*(uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2))/(dt*dy)+(Eta(4,5,i2,j2,k2)*(ux(i,j,k,l)-ux(i,j,k+1,l)))/(dt*dz)+(Eta(4,4,i2,j2,k2)*(uy(i,j,k,l)-uy(i,j,k+1,l)))/(dt*dz)+(Eta(3,4,i2,j2,k2)*(uz(i,j,k,l)-uz(i,j,k+1,l)))/(dt*dz));
                    
                    % third eq
                    B(Id(1)+2)=-((Eta(1,3,i2,j2,k2)*(ux(i-1,j,k,l)/2-ux(i+1,j,k,l)/2))/(dt*dx)+(Eta(3,6,i2,j2,k2)*(ux(i,j-1,k,l)/2-ux(i,j+1,k,l)/2))/(dt*dy)+(Eta(3,6,i2,j2,k2)*(uy(i-1,j,k,l)/2-uy(i+1,j,k,l)/2))/(dt*dx)+(Eta(2,3,i2,j2,k2)*(uy(i,j-1,k,l)/2-uy(i,j+1,k,l)/2))/(dt*dy)+(Eta(3,5,i2,j2,k2)*(uz(i-1,j,k,l)/2-uz(i+1,j,k,l)/2))/(dt*dx)+(Eta(3,4,i2,j2,k2)*(uz(i,j-1,k,l)/2-uz(i,j+1,k,l)/2))/(dt*dy)+(Eta(3,5,i2,j2,k2)*(ux(i,j,k,l)-ux(i,j,k+1,l)))/(dt*dz)+(Eta(3,4,i2,j2,k2)*(uy(i,j,k,l)-uy(i,j,k+1,l)))/(dt*dz)+(Eta(3,3,i2,j2,k2)*(uz(i,j,k,l)-uz(i,j,k+1,l)))/(dt*dz));
                end
            end
            %% second layer in the z direction
            k=2;
            for i=2:nx-1
                for j=2:ny-1
                    [i2,j2,k2]=rd(i,j,k);
                    Id=id(nx,ny,nz,1,i,j,k,1,i,j,k);
                    
                    B(Id(2)  )=((w(1,1,i2+1,j2,k2)-w(1,1,i2-1,j2,k2))/2/dx-Eta(6,6,i2,j2,k2)*((ux(i,j-1,k,l-1)-2*ux(i,j,k,l-1)+ux(i,j+1,k,l-1))/(dt*dy^2)-(ux(i,j-1,k,l)-2*ux(i,j,k,l)+ux(i,j+1,k,l))/(dt*dy^2))-Eta(5,5,i2,j2,k2)*((ux(i,j,k-1,l-1)-2*ux(i,j,k,l-1)+ux(i,j,k+1,l-1))/(dt*dz^2)-(ux(i,j,k-1,l)-2*ux(i,j,k,l)+ux(i,j,k+1,l))/(dt*dz^2))-Eta(1,6,i2,j2,k2)*((uy(i-1,j,k,l-1)-2*uy(i,j,k,l-1)+uy(i+1,j,k,l-1))/(dt*dx^2)-(uy(i-1,j,k,l)-2*uy(i,j,k,l)+uy(i+1,j,k,l))/(dt*dx^2))-Eta(2,6,i2,j2,k2)*((uy(i,j-1,k,l-1)-2*uy(i,j,k,l-1)+uy(i,j+1,k,l-1))/(dt*dy^2)-(uy(i,j-1,k,l)-2*uy(i,j,k,l)+uy(i,j+1,k,l))/(dt*dy^2))-Eta(4,5,i2,j2,k2)*((uy(i,j,k-1,l-1)-2*uy(i,j,k,l-1)+uy(i,j,k+1,l-1))/(dt*dz^2)-(uy(i,j,k-1,l)-2*uy(i,j,k,l)+uy(i,j,k+1,l))/(dt*dz^2))-Eta(1,5,i2,j2,k2)*((uz(i-1,j,k,l-1)-2*uz(i,j,k,l-1)+uz(i+1,j,k,l-1))/(dt*dx^2)-(uz(i-1,j,k,l)-2*uz(i,j,k,l)+uz(i+1,j,k,l))/(dt*dx^2))-Eta(4,6,i2,j2,k2)*((uz(i,j-1,k,l-1)-2*uz(i,j,k,l-1)+uz(i,j+1,k,l-1))/(dt*dy^2)-(uz(i,j-1,k,l)-2*uz(i,j,k,l)+uz(i,j+1,k,l))/(dt*dy^2))-Eta(3,5,i2,j2,k2)*((uz(i,j,k-1,l-1)-2*uz(i,j,k,l-1)+uz(i,j,k+1,l-1))/(dt*dz^2)-(uz(i,j,k-1,l)-2*uz(i,j,k,l)+uz(i,j,k+1,l))/(dt*dz^2))-Eta(1,1,i2,j2,k2)*((ux(i-1,j,k,l-1)-2*ux(i,j,k,l-1)+ux(i+1,j,k,l-1))/(dt*dx^2)-(ux(i-1,j,k,l)-2*ux(i,j,k,l)+ux(i+1,j,k,l))/(dt*dx^2))+(w(1,2,i2,j2+1,k2)-w(1,2,i2,j2-1,k2))/2/dy+(w(1,3,i2,j2,k2+1)-w(1,3,i2,j2,k2-1))/2/dz-rho(i,j,k)*(Ux(i,j,k)*ctwo(i2,j2,k2)+b(i2,j2,k2)*ux(i,j,k,l)+(ux(i,j,k,l-1)-2*ux(i,j,k,l))/dt^2-(a(i2,j2,k2)*ux(i,j,k,l))/dt)-2*Eta(1,6,i2,j2,k2)*((ux(i-1,j-1,k,l-1)/4-ux(i-1,j+1,k,l-1)/4-ux(i+1,j-1,k,l-1)/4+ux(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(ux(i-1,j-1,k,l)/4-ux(i-1,j+1,k,l)/4-ux(i+1,j-1,k,l)/4+ux(i+1,j+1,k,l)/4)/(dt*dx*dy))-2*Eta(1,5,i2,j2,k2)*((ux(i-1,j,k-1,l-1)/4-ux(i-1,j,k+1,l-1)/4-ux(i+1,j,k-1,l-1)/4+ux(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(ux(i-1,j,k-1,l)/4-ux(i-1,j,k+1,l)/4-ux(i+1,j,k-1,l)/4+ux(i+1,j,k+1,l)/4)/(dt*dx*dz))-2*Eta(5,6,i2,j2,k2)*((ux(i,j-1,k-1,l-1)/4-ux(i,j-1,k+1,l-1)/4-ux(i,j+1,k-1,l-1)/4+ux(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(ux(i,j-1,k-1,l)/4-ux(i,j-1,k+1,l)/4-ux(i,j+1,k-1,l)/4+ux(i,j+1,k+1,l)/4)/(dt*dy*dz))-Eta(1,2,i2,j2,k2)*((uy(i-1,j-1,k,l-1)/4-uy(i-1,j+1,k,l-1)/4-uy(i+1,j-1,k,l-1)/4+uy(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(uy(i-1,j-1,k,l)/4-uy(i-1,j+1,k,l)/4-uy(i+1,j-1,k,l)/4+uy(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(6,6,i2,j2,k2)*((uy(i-1,j-1,k,l-1)/4-uy(i-1,j+1,k,l-1)/4-uy(i+1,j-1,k,l-1)/4+uy(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(uy(i-1,j-1,k,l)/4-uy(i-1,j+1,k,l)/4-uy(i+1,j-1,k,l)/4+uy(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(1,4,i2,j2,k2)*((uy(i-1,j,k-1,l-1)/4-uy(i-1,j,k+1,l-1)/4-uy(i+1,j,k-1,l-1)/4+uy(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(uy(i-1,j,k-1,l)/4-uy(i-1,j,k+1,l)/4-uy(i+1,j,k-1,l)/4+uy(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(5,6,i2,j2,k2)*((uy(i-1,j,k-1,l-1)/4-uy(i-1,j,k+1,l-1)/4-uy(i+1,j,k-1,l-1)/4+uy(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(uy(i-1,j,k-1,l)/4-uy(i-1,j,k+1,l)/4-uy(i+1,j,k-1,l)/4+uy(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(2,5,i2,j2,k2)*((uy(i,j-1,k-1,l-1)/4-uy(i,j-1,k+1,l-1)/4-uy(i,j+1,k-1,l-1)/4+uy(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(uy(i,j-1,k-1,l)/4-uy(i,j-1,k+1,l)/4-uy(i,j+1,k-1,l)/4+uy(i,j+1,k+1,l)/4)/(dt*dy*dz))-Eta(4,6,i2,j2,k2)*((uy(i,j-1,k-1,l-1)/4-uy(i,j-1,k+1,l-1)/4-uy(i,j+1,k-1,l-1)/4+uy(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(uy(i,j-1,k-1,l)/4-uy(i,j-1,k+1,l)/4-uy(i,j+1,k-1,l)/4+uy(i,j+1,k+1,l)/4)/(dt*dy*dz))-Eta(1,4,i2,j2,k2)*((uz(i-1,j-1,k,l-1)/4-uz(i-1,j+1,k,l-1)/4-uz(i+1,j-1,k,l-1)/4+uz(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(uz(i-1,j-1,k,l)/4-uz(i-1,j+1,k,l)/4-uz(i+1,j-1,k,l)/4+uz(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(5,6,i2,j2,k2)*((uz(i-1,j-1,k,l-1)/4-uz(i-1,j+1,k,l-1)/4-uz(i+1,j-1,k,l-1)/4+uz(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(uz(i-1,j-1,k,l)/4-uz(i-1,j+1,k,l)/4-uz(i+1,j-1,k,l)/4+uz(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(1,3,i2,j2,k2)*((uz(i-1,j,k-1,l-1)/4-uz(i-1,j,k+1,l-1)/4-uz(i+1,j,k-1,l-1)/4+uz(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(uz(i-1,j,k-1,l)/4-uz(i-1,j,k+1,l)/4-uz(i+1,j,k-1,l)/4+uz(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(5,5,i2,j2,k2)*((uz(i-1,j,k-1,l-1)/4-uz(i-1,j,k+1,l-1)/4-uz(i+1,j,k-1,l-1)/4+uz(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(uz(i-1,j,k-1,l)/4-uz(i-1,j,k+1,l)/4-uz(i+1,j,k-1,l)/4+uz(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(3,6,i2,j2,k2)*((uz(i,j-1,k-1,l-1)/4-uz(i,j-1,k+1,l-1)/4-uz(i,j+1,k-1,l-1)/4+uz(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(uz(i,j-1,k-1,l)/4-uz(i,j-1,k+1,l)/4-uz(i,j+1,k-1,l)/4+uz(i,j+1,k+1,l)/4)/(dt*dy*dz))-Eta(4,5,i2,j2,k2)*((uz(i,j-1,k-1,l-1)/4-uz(i,j-1,k+1,l-1)/4-uz(i,j+1,k-1,l-1)/4+uz(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(uz(i,j-1,k-1,l)/4-uz(i,j-1,k+1,l)/4-uz(i,j+1,k-1,l)/4+uz(i,j+1,k+1,l)/4)/(dt*dy*dz))+(C(1,1,i2,j2,k2)*(ux(i-1,j,k,l)-2*ux(i,j,k,l)+ux(i+1,j,k,l)))/dx^2+(C(6,6,i2,j2,k2)*(ux(i,j-1,k,l)-2*ux(i,j,k,l)+ux(i,j+1,k,l)))/dy^2+(C(5,5,i2,j2,k2)*(ux(i,j,k-1,l)-2*ux(i,j,k,l)+ux(i,j,k+1,l)))/dz^2+(C(1,6,i2,j2,k2)*(uy(i-1,j,k,l)-2*uy(i,j,k,l)+uy(i+1,j,k,l)))/dx^2+(C(2,6,i2,j2,k2)*(uy(i,j-1,k,l)-2*uy(i,j,k,l)+uy(i,j+1,k,l)))/dy^2+(C(4,5,i2,j2,k2)*(uy(i,j,k-1,l)-2*uy(i,j,k,l)+uy(i,j,k+1,l)))/dz^2+(C(1,5,i2,j2,k2)*(uz(i-1,j,k,l)-2*uz(i,j,k,l)+uz(i+1,j,k,l)))/dx^2+(C(4,6,i2,j2,k2)*(uz(i,j-1,k,l)-2*uz(i,j,k,l)+uz(i,j+1,k,l)))/dy^2+(C(3,5,i2,j2,k2)*(uz(i,j,k-1,l)-2*uz(i,j,k,l)+uz(i,j,k+1,l)))/dz^2+srci+(2*C(1,6,i2,j2,k2)*(ux(i-1,j-1,k,l)/4-ux(i-1,j+1,k,l)/4-ux(i+1,j-1,k,l)/4+ux(i+1,j+1,k,l)/4))/(dx*dy)+(2*C(1,5,i2,j2,k2)*(ux(i-1,j,k-1,l)/4-ux(i-1,j,k+1,l)/4-ux(i+1,j,k-1,l)/4+ux(i+1,j,k+1,l)/4))/(dx*dz)+(2*C(5,6,i2,j2,k2)*(ux(i,j-1,k-1,l)/4-ux(i,j-1,k+1,l)/4-ux(i,j+1,k-1,l)/4+ux(i,j+1,k+1,l)/4))/(dy*dz)+(C(1,2,i2,j2,k2)*(uy(i-1,j-1,k,l)/4-uy(i-1,j+1,k,l)/4-uy(i+1,j-1,k,l)/4+uy(i+1,j+1,k,l)/4))/(dx*dy)+(C(6,6,i2,j2,k2)*(uy(i-1,j-1,k,l)/4-uy(i-1,j+1,k,l)/4-uy(i+1,j-1,k,l)/4+uy(i+1,j+1,k,l)/4))/(dx*dy)+(C(1,4,i2,j2,k2)*(uy(i-1,j,k-1,l)/4-uy(i-1,j,k+1,l)/4-uy(i+1,j,k-1,l)/4+uy(i+1,j,k+1,l)/4))/(dx*dz)+(C(5,6,i2,j2,k2)*(uy(i-1,j,k-1,l)/4-uy(i-1,j,k+1,l)/4-uy(i+1,j,k-1,l)/4+uy(i+1,j,k+1,l)/4))/(dx*dz)+(C(2,5,i2,j2,k2)*(uy(i,j-1,k-1,l)/4-uy(i,j-1,k+1,l)/4-uy(i,j+1,k-1,l)/4+uy(i,j+1,k+1,l)/4))/(dy*dz)+(C(4,6,i2,j2,k2)*(uy(i,j-1,k-1,l)/4-uy(i,j-1,k+1,l)/4-uy(i,j+1,k-1,l)/4+uy(i,j+1,k+1,l)/4))/(dy*dz)+(C(1,4,i2,j2,k2)*(uz(i-1,j-1,k,l)/4-uz(i-1,j+1,k,l)/4-uz(i+1,j-1,k,l)/4+uz(i+1,j+1,k,l)/4))/(dx*dy)+(C(5,6,i2,j2,k2)*(uz(i-1,j-1,k,l)/4-uz(i-1,j+1,k,l)/4-uz(i+1,j-1,k,l)/4+uz(i+1,j+1,k,l)/4))/(dx*dy)+(C(1,3,i2,j2,k2)*(uz(i-1,j,k-1,l)/4-uz(i-1,j,k+1,l)/4-uz(i+1,j,k-1,l)/4+uz(i+1,j,k+1,l)/4))/(dx*dz)+(C(5,5,i2,j2,k2)*(uz(i-1,j,k-1,l)/4-uz(i-1,j,k+1,l)/4-uz(i+1,j,k-1,l)/4+uz(i+1,j,k+1,l)/4))/(dx*dz)+(C(3,6,i2,j2,k2)*(uz(i,j-1,k-1,l)/4-uz(i,j-1,k+1,l)/4-uz(i,j+1,k-1,l)/4+uz(i,j+1,k+1,l)/4))/(dy*dz)+(C(4,5,i2,j2,k2)*(uz(i,j-1,k-1,l)/4-uz(i,j-1,k+1,l)/4-uz(i,j+1,k-1,l)/4+uz(i,j+1,k+1,l)/4))/(dy*dz))/(rho(i,j,k)*(a(i2,j2,k2)/dt+1/dt^2));
                        
                    B(Id(2)+1)=((w(2,1,i2+1,j2,k2)-w(2,1,i2-1,j2,k2))/2/dx-Eta(2,6,i2,j2,k2)*((ux(i,j-1,k,l-1)-2*ux(i,j,k,l-1)+ux(i,j+1,k,l-1))/(dt*dy^2)-(ux(i,j-1,k,l)-2*ux(i,j,k,l)+ux(i,j+1,k,l))/(dt*dy^2))-Eta(4,5,i2,j2,k2)*((ux(i,j,k-1,l-1)-2*ux(i,j,k,l-1)+ux(i,j,k+1,l-1))/(dt*dz^2)-(ux(i,j,k-1,l)-2*ux(i,j,k,l)+ux(i,j,k+1,l))/(dt*dz^2))-Eta(6,6,i2,j2,k2)*((uy(i-1,j,k,l-1)-2*uy(i,j,k,l-1)+uy(i+1,j,k,l-1))/(dt*dx^2)-(uy(i-1,j,k,l)-2*uy(i,j,k,l)+uy(i+1,j,k,l))/(dt*dx^2))-Eta(2,2,i2,j2,k2)*((uy(i,j-1,k,l-1)-2*uy(i,j,k,l-1)+uy(i,j+1,k,l-1))/(dt*dy^2)-(uy(i,j-1,k,l)-2*uy(i,j,k,l)+uy(i,j+1,k,l))/(dt*dy^2))-Eta(4,4,i2,j2,k2)*((uy(i,j,k-1,l-1)-2*uy(i,j,k,l-1)+uy(i,j,k+1,l-1))/(dt*dz^2)-(uy(i,j,k-1,l)-2*uy(i,j,k,l)+uy(i,j,k+1,l))/(dt*dz^2))-Eta(5,6,i2,j2,k2)*((uz(i-1,j,k,l-1)-2*uz(i,j,k,l-1)+uz(i+1,j,k,l-1))/(dt*dx^2)-(uz(i-1,j,k,l)-2*uz(i,j,k,l)+uz(i+1,j,k,l))/(dt*dx^2))-Eta(2,4,i2,j2,k2)*((uz(i,j-1,k,l-1)-2*uz(i,j,k,l-1)+uz(i,j+1,k,l-1))/(dt*dy^2)-(uz(i,j-1,k,l)-2*uz(i,j,k,l)+uz(i,j+1,k,l))/(dt*dy^2))-Eta(3,4,i2,j2,k2)*((uz(i,j,k-1,l-1)-2*uz(i,j,k,l-1)+uz(i,j,k+1,l-1))/(dt*dz^2)-(uz(i,j,k-1,l)-2*uz(i,j,k,l)+uz(i,j,k+1,l))/(dt*dz^2))-Eta(1,6,i2,j2,k2)*((ux(i-1,j,k,l-1)-2*ux(i,j,k,l-1)+ux(i+1,j,k,l-1))/(dt*dx^2)-(ux(i-1,j,k,l)-2*ux(i,j,k,l)+ux(i+1,j,k,l))/(dt*dx^2))+(w(2,2,i2,j2+1,k2)-w(2,2,i2,j2-1,k2))/2/dy+(w(2,3,i2,j2,k2+1)-w(2,3,i2,j2,k2-1))/2/dz-rho(i,j,k)*(Uy(i,j,k)*ctwo(i2,j2,k2)+b(i2,j2,k2)*uy(i,j,k,l)+(uy(i,j,k,l-1)-2*uy(i,j,k,l))/dt^2-(a(i2,j2,k2)*uy(i,j,k,l))/dt)-Eta(1,2,i2,j2,k2)*((ux(i-1,j-1,k,l-1)/4-ux(i-1,j+1,k,l-1)/4-ux(i+1,j-1,k,l-1)/4+ux(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(ux(i-1,j-1,k,l)/4-ux(i-1,j+1,k,l)/4-ux(i+1,j-1,k,l)/4+ux(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(6,6,i2,j2,k2)*((ux(i-1,j-1,k,l-1)/4-ux(i-1,j+1,k,l-1)/4-ux(i+1,j-1,k,l-1)/4+ux(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(ux(i-1,j-1,k,l)/4-ux(i-1,j+1,k,l)/4-ux(i+1,j-1,k,l)/4+ux(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(1,4,i2,j2,k2)*((ux(i-1,j,k-1,l-1)/4-ux(i-1,j,k+1,l-1)/4-ux(i+1,j,k-1,l-1)/4+ux(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(ux(i-1,j,k-1,l)/4-ux(i-1,j,k+1,l)/4-ux(i+1,j,k-1,l)/4+ux(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(5,6,i2,j2,k2)*((ux(i-1,j,k-1,l-1)/4-ux(i-1,j,k+1,l-1)/4-ux(i+1,j,k-1,l-1)/4+ux(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(ux(i-1,j,k-1,l)/4-ux(i-1,j,k+1,l)/4-ux(i+1,j,k-1,l)/4+ux(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(2,5,i2,j2,k2)*((ux(i,j-1,k-1,l-1)/4-ux(i,j-1,k+1,l-1)/4-ux(i,j+1,k-1,l-1)/4+ux(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(ux(i,j-1,k-1,l)/4-ux(i,j-1,k+1,l)/4-ux(i,j+1,k-1,l)/4+ux(i,j+1,k+1,l)/4)/(dt*dy*dz))-Eta(4,6,i2,j2,k2)*((ux(i,j-1,k-1,l-1)/4-ux(i,j-1,k+1,l-1)/4-ux(i,j+1,k-1,l-1)/4+ux(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(ux(i,j-1,k-1,l)/4-ux(i,j-1,k+1,l)/4-ux(i,j+1,k-1,l)/4+ux(i,j+1,k+1,l)/4)/(dt*dy*dz))-2*Eta(2,6,i2,j2,k2)*((uy(i-1,j-1,k,l-1)/4-uy(i-1,j+1,k,l-1)/4-uy(i+1,j-1,k,l-1)/4+uy(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(uy(i-1,j-1,k,l)/4-uy(i-1,j+1,k,l)/4-uy(i+1,j-1,k,l)/4+uy(i+1,j+1,k,l)/4)/(dt*dx*dy))-2*Eta(4,6,i2,j2,k2)*((uy(i-1,j,k-1,l-1)/4-uy(i-1,j,k+1,l-1)/4-uy(i+1,j,k-1,l-1)/4+uy(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(uy(i-1,j,k-1,l)/4-uy(i-1,j,k+1,l)/4-uy(i+1,j,k-1,l)/4+uy(i+1,j,k+1,l)/4)/(dt*dx*dz))-2*Eta(2,4,i2,j2,k2)*((uy(i,j-1,k-1,l-1)/4-uy(i,j-1,k+1,l-1)/4-uy(i,j+1,k-1,l-1)/4+uy(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(uy(i,j-1,k-1,l)/4-uy(i,j-1,k+1,l)/4-uy(i,j+1,k-1,l)/4+uy(i,j+1,k+1,l)/4)/(dt*dy*dz))-Eta(2,5,i2,j2,k2)*((uz(i-1,j-1,k,l-1)/4-uz(i-1,j+1,k,l-1)/4-uz(i+1,j-1,k,l-1)/4+uz(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(uz(i-1,j-1,k,l)/4-uz(i-1,j+1,k,l)/4-uz(i+1,j-1,k,l)/4+uz(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(4,6,i2,j2,k2)*((uz(i-1,j-1,k,l-1)/4-uz(i-1,j+1,k,l-1)/4-uz(i+1,j-1,k,l-1)/4+uz(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(uz(i-1,j-1,k,l)/4-uz(i-1,j+1,k,l)/4-uz(i+1,j-1,k,l)/4+uz(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(3,6,i2,j2,k2)*((uz(i-1,j,k-1,l-1)/4-uz(i-1,j,k+1,l-1)/4-uz(i+1,j,k-1,l-1)/4+uz(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(uz(i-1,j,k-1,l)/4-uz(i-1,j,k+1,l)/4-uz(i+1,j,k-1,l)/4+uz(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(4,5,i2,j2,k2)*((uz(i-1,j,k-1,l-1)/4-uz(i-1,j,k+1,l-1)/4-uz(i+1,j,k-1,l-1)/4+uz(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(uz(i-1,j,k-1,l)/4-uz(i-1,j,k+1,l)/4-uz(i+1,j,k-1,l)/4+uz(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(2,3,i2,j2,k2)*((uz(i,j-1,k-1,l-1)/4-uz(i,j-1,k+1,l-1)/4-uz(i,j+1,k-1,l-1)/4+uz(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(uz(i,j-1,k-1,l)/4-uz(i,j-1,k+1,l)/4-uz(i,j+1,k-1,l)/4+uz(i,j+1,k+1,l)/4)/(dt*dy*dz))-Eta(4,4,i2,j2,k2)*((uz(i,j-1,k-1,l-1)/4-uz(i,j-1,k+1,l-1)/4-uz(i,j+1,k-1,l-1)/4+uz(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(uz(i,j-1,k-1,l)/4-uz(i,j-1,k+1,l)/4-uz(i,j+1,k-1,l)/4+uz(i,j+1,k+1,l)/4)/(dt*dy*dz))+(C(1,6,i2,j2,k2)*(ux(i-1,j,k,l)-2*ux(i,j,k,l)+ux(i+1,j,k,l)))/dx^2+(C(2,6,i2,j2,k2)*(ux(i,j-1,k,l)-2*ux(i,j,k,l)+ux(i,j+1,k,l)))/dy^2+(C(4,5,i2,j2,k2)*(ux(i,j,k-1,l)-2*ux(i,j,k,l)+ux(i,j,k+1,l)))/dz^2+(C(6,6,i2,j2,k2)*(uy(i-1,j,k,l)-2*uy(i,j,k,l)+uy(i+1,j,k,l)))/dx^2+(C(2,2,i2,j2,k2)*(uy(i,j-1,k,l)-2*uy(i,j,k,l)+uy(i,j+1,k,l)))/dy^2+(C(4,4,i2,j2,k2)*(uy(i,j,k-1,l)-2*uy(i,j,k,l)+uy(i,j,k+1,l)))/dz^2+(C(5,6,i2,j2,k2)*(uz(i-1,j,k,l)-2*uz(i,j,k,l)+uz(i+1,j,k,l)))/dx^2+(C(2,4,i2,j2,k2)*(uz(i,j-1,k,l)-2*uz(i,j,k,l)+uz(i,j+1,k,l)))/dy^2+(C(3,4,i2,j2,k2)*(uz(i,j,k-1,l)-2*uz(i,j,k,l)+uz(i,j,k+1,l)))/dz^2+srci+(C(1,2,i2,j2,k2)*(ux(i-1,j-1,k,l)/4-ux(i-1,j+1,k,l)/4-ux(i+1,j-1,k,l)/4+ux(i+1,j+1,k,l)/4))/(dx*dy)+(C(6,6,i2,j2,k2)*(ux(i-1,j-1,k,l)/4-ux(i-1,j+1,k,l)/4-ux(i+1,j-1,k,l)/4+ux(i+1,j+1,k,l)/4))/(dx*dy)+(C(1,4,i2,j2,k2)*(ux(i-1,j,k-1,l)/4-ux(i-1,j,k+1,l)/4-ux(i+1,j,k-1,l)/4+ux(i+1,j,k+1,l)/4))/(dx*dz)+(C(5,6,i2,j2,k2)*(ux(i-1,j,k-1,l)/4-ux(i-1,j,k+1,l)/4-ux(i+1,j,k-1,l)/4+ux(i+1,j,k+1,l)/4))/(dx*dz)+(C(2,5,i2,j2,k2)*(ux(i,j-1,k-1,l)/4-ux(i,j-1,k+1,l)/4-ux(i,j+1,k-1,l)/4+ux(i,j+1,k+1,l)/4))/(dy*dz)+(C(4,6,i2,j2,k2)*(ux(i,j-1,k-1,l)/4-ux(i,j-1,k+1,l)/4-ux(i,j+1,k-1,l)/4+ux(i,j+1,k+1,l)/4))/(dy*dz)+(2*C(2,6,i2,j2,k2)*(uy(i-1,j-1,k,l)/4-uy(i-1,j+1,k,l)/4-uy(i+1,j-1,k,l)/4+uy(i+1,j+1,k,l)/4))/(dx*dy)+(2*C(4,6,i2,j2,k2)*(uy(i-1,j,k-1,l)/4-uy(i-1,j,k+1,l)/4-uy(i+1,j,k-1,l)/4+uy(i+1,j,k+1,l)/4))/(dx*dz)+(2*C(2,4,i2,j2,k2)*(uy(i,j-1,k-1,l)/4-uy(i,j-1,k+1,l)/4-uy(i,j+1,k-1,l)/4+uy(i,j+1,k+1,l)/4))/(dy*dz)+(C(2,5,i2,j2,k2)*(uz(i-1,j-1,k,l)/4-uz(i-1,j+1,k,l)/4-uz(i+1,j-1,k,l)/4+uz(i+1,j+1,k,l)/4))/(dx*dy)+(C(4,6,i2,j2,k2)*(uz(i-1,j-1,k,l)/4-uz(i-1,j+1,k,l)/4-uz(i+1,j-1,k,l)/4+uz(i+1,j+1,k,l)/4))/(dx*dy)+(C(3,6,i2,j2,k2)*(uz(i-1,j,k-1,l)/4-uz(i-1,j,k+1,l)/4-uz(i+1,j,k-1,l)/4+uz(i+1,j,k+1,l)/4))/(dx*dz)+(C(4,5,i2,j2,k2)*(uz(i-1,j,k-1,l)/4-uz(i-1,j,k+1,l)/4-uz(i+1,j,k-1,l)/4+uz(i+1,j,k+1,l)/4))/(dx*dz)+(C(2,3,i2,j2,k2)*(uz(i,j-1,k-1,l)/4-uz(i,j-1,k+1,l)/4-uz(i,j+1,k-1,l)/4+uz(i,j+1,k+1,l)/4))/(dy*dz)+(C(4,4,i2,j2,k2)*(uz(i,j-1,k-1,l)/4-uz(i,j-1,k+1,l)/4-uz(i,j+1,k-1,l)/4+uz(i,j+1,k+1,l)/4))/(dy*dz))/(rho(i,j,k)*(a(i2,j2,k2)/dt+1/dt^2));
                        
                    B(Id(2)+2)=((w(3,1,i2+1,j2,k2)-w(3,1,i2-1,j2,k2))/2/dx-Eta(4,6,i2,j2,k2)*((ux(i,j-1,k,l-1)-2*ux(i,j,k,l-1)+ux(i,j+1,k,l-1))/(dt*dy^2)-(ux(i,j-1,k,l)-2*ux(i,j,k,l)+ux(i,j+1,k,l))/(dt*dy^2))-Eta(3,5,i2,j2,k2)*((ux(i,j,k-1,l-1)-2*ux(i,j,k,l-1)+ux(i,j,k+1,l-1))/(dt*dz^2)-(ux(i,j,k-1,l)-2*ux(i,j,k,l)+ux(i,j,k+1,l))/(dt*dz^2))-Eta(5,6,i2,j2,k2)*((uy(i-1,j,k,l-1)-2*uy(i,j,k,l-1)+uy(i+1,j,k,l-1))/(dt*dx^2)-(uy(i-1,j,k,l)-2*uy(i,j,k,l)+uy(i+1,j,k,l))/(dt*dx^2))-Eta(2,4,i2,j2,k2)*((uy(i,j-1,k,l-1)-2*uy(i,j,k,l-1)+uy(i,j+1,k,l-1))/(dt*dy^2)-(uy(i,j-1,k,l)-2*uy(i,j,k,l)+uy(i,j+1,k,l))/(dt*dy^2))-Eta(3,4,i2,j2,k2)*((uy(i,j,k-1,l-1)-2*uy(i,j,k,l-1)+uy(i,j,k+1,l-1))/(dt*dz^2)-(uy(i,j,k-1,l)-2*uy(i,j,k,l)+uy(i,j,k+1,l))/(dt*dz^2))-Eta(5,5,i2,j2,k2)*((uz(i-1,j,k,l-1)-2*uz(i,j,k,l-1)+uz(i+1,j,k,l-1))/(dt*dx^2)-(uz(i-1,j,k,l)-2*uz(i,j,k,l)+uz(i+1,j,k,l))/(dt*dx^2))-Eta(4,4,i2,j2,k2)*((uz(i,j-1,k,l-1)-2*uz(i,j,k,l-1)+uz(i,j+1,k,l-1))/(dt*dy^2)-(uz(i,j-1,k,l)-2*uz(i,j,k,l)+uz(i,j+1,k,l))/(dt*dy^2))-Eta(3,3,i2,j2,k2)*((uz(i,j,k-1,l-1)-2*uz(i,j,k,l-1)+uz(i,j,k+1,l-1))/(dt*dz^2)-(uz(i,j,k-1,l)-2*uz(i,j,k,l)+uz(i,j,k+1,l))/(dt*dz^2))-Eta(1,5,i2,j2,k2)*((ux(i-1,j,k,l-1)-2*ux(i,j,k,l-1)+ux(i+1,j,k,l-1))/(dt*dx^2)-(ux(i-1,j,k,l)-2*ux(i,j,k,l)+ux(i+1,j,k,l))/(dt*dx^2))+(w(3,2,i2,j2+1,k2)-w(3,2,i2,j2-1,k2))/2/dy+(w(3,3,i2,j2,k2+1)-w(3,3,i2,j2,k2-1))/2/dz-rho(i,j,k)*(Uz(i,j,k)*ctwo(i2,j2,k2)+b(i2,j2,k2)*uz(i,j,k,l)+(uz(i,j,k,l-1)-2*uz(i,j,k,l))/dt^2-(a(i2,j2,k2)*uz(i,j,k,l))/dt)-Eta(1,4,i2,j2,k2)*((ux(i-1,j-1,k,l-1)/4-ux(i-1,j+1,k,l-1)/4-ux(i+1,j-1,k,l-1)/4+ux(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(ux(i-1,j-1,k,l)/4-ux(i-1,j+1,k,l)/4-ux(i+1,j-1,k,l)/4+ux(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(5,6,i2,j2,k2)*((ux(i-1,j-1,k,l-1)/4-ux(i-1,j+1,k,l-1)/4-ux(i+1,j-1,k,l-1)/4+ux(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(ux(i-1,j-1,k,l)/4-ux(i-1,j+1,k,l)/4-ux(i+1,j-1,k,l)/4+ux(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(1,3,i2,j2,k2)*((ux(i-1,j,k-1,l-1)/4-ux(i-1,j,k+1,l-1)/4-ux(i+1,j,k-1,l-1)/4+ux(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(ux(i-1,j,k-1,l)/4-ux(i-1,j,k+1,l)/4-ux(i+1,j,k-1,l)/4+ux(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(5,5,i2,j2,k2)*((ux(i-1,j,k-1,l-1)/4-ux(i-1,j,k+1,l-1)/4-ux(i+1,j,k-1,l-1)/4+ux(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(ux(i-1,j,k-1,l)/4-ux(i-1,j,k+1,l)/4-ux(i+1,j,k-1,l)/4+ux(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(3,6,i2,j2,k2)*((ux(i,j-1,k-1,l-1)/4-ux(i,j-1,k+1,l-1)/4-ux(i,j+1,k-1,l-1)/4+ux(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(ux(i,j-1,k-1,l)/4-ux(i,j-1,k+1,l)/4-ux(i,j+1,k-1,l)/4+ux(i,j+1,k+1,l)/4)/(dt*dy*dz))-Eta(4,5,i2,j2,k2)*((ux(i,j-1,k-1,l-1)/4-ux(i,j-1,k+1,l-1)/4-ux(i,j+1,k-1,l-1)/4+ux(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(ux(i,j-1,k-1,l)/4-ux(i,j-1,k+1,l)/4-ux(i,j+1,k-1,l)/4+ux(i,j+1,k+1,l)/4)/(dt*dy*dz))-Eta(2,5,i2,j2,k2)*((uy(i-1,j-1,k,l-1)/4-uy(i-1,j+1,k,l-1)/4-uy(i+1,j-1,k,l-1)/4+uy(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(uy(i-1,j-1,k,l)/4-uy(i-1,j+1,k,l)/4-uy(i+1,j-1,k,l)/4+uy(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(4,6,i2,j2,k2)*((uy(i-1,j-1,k,l-1)/4-uy(i-1,j+1,k,l-1)/4-uy(i+1,j-1,k,l-1)/4+uy(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(uy(i-1,j-1,k,l)/4-uy(i-1,j+1,k,l)/4-uy(i+1,j-1,k,l)/4+uy(i+1,j+1,k,l)/4)/(dt*dx*dy))-Eta(3,6,i2,j2,k2)*((uy(i-1,j,k-1,l-1)/4-uy(i-1,j,k+1,l-1)/4-uy(i+1,j,k-1,l-1)/4+uy(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(uy(i-1,j,k-1,l)/4-uy(i-1,j,k+1,l)/4-uy(i+1,j,k-1,l)/4+uy(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(4,5,i2,j2,k2)*((uy(i-1,j,k-1,l-1)/4-uy(i-1,j,k+1,l-1)/4-uy(i+1,j,k-1,l-1)/4+uy(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(uy(i-1,j,k-1,l)/4-uy(i-1,j,k+1,l)/4-uy(i+1,j,k-1,l)/4+uy(i+1,j,k+1,l)/4)/(dt*dx*dz))-Eta(2,3,i2,j2,k2)*((uy(i,j-1,k-1,l-1)/4-uy(i,j-1,k+1,l-1)/4-uy(i,j+1,k-1,l-1)/4+uy(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(uy(i,j-1,k-1,l)/4-uy(i,j-1,k+1,l)/4-uy(i,j+1,k-1,l)/4+uy(i,j+1,k+1,l)/4)/(dt*dy*dz))-Eta(4,4,i2,j2,k2)*((uy(i,j-1,k-1,l-1)/4-uy(i,j-1,k+1,l-1)/4-uy(i,j+1,k-1,l-1)/4+uy(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(uy(i,j-1,k-1,l)/4-uy(i,j-1,k+1,l)/4-uy(i,j+1,k-1,l)/4+uy(i,j+1,k+1,l)/4)/(dt*dy*dz))-2*Eta(4,5,i2,j2,k2)*((uz(i-1,j-1,k,l-1)/4-uz(i-1,j+1,k,l-1)/4-uz(i+1,j-1,k,l-1)/4+uz(i+1,j+1,k,l-1)/4)/(dt*dx*dy)-(uz(i-1,j-1,k,l)/4-uz(i-1,j+1,k,l)/4-uz(i+1,j-1,k,l)/4+uz(i+1,j+1,k,l)/4)/(dt*dx*dy))-2*Eta(3,5,i2,j2,k2)*((uz(i-1,j,k-1,l-1)/4-uz(i-1,j,k+1,l-1)/4-uz(i+1,j,k-1,l-1)/4+uz(i+1,j,k+1,l-1)/4)/(dt*dx*dz)-(uz(i-1,j,k-1,l)/4-uz(i-1,j,k+1,l)/4-uz(i+1,j,k-1,l)/4+uz(i+1,j,k+1,l)/4)/(dt*dx*dz))-2*Eta(3,4,i2,j2,k2)*((uz(i,j-1,k-1,l-1)/4-uz(i,j-1,k+1,l-1)/4-uz(i,j+1,k-1,l-1)/4+uz(i,j+1,k+1,l-1)/4)/(dt*dy*dz)-(uz(i,j-1,k-1,l)/4-uz(i,j-1,k+1,l)/4-uz(i,j+1,k-1,l)/4+uz(i,j+1,k+1,l)/4)/(dt*dy*dz))+(C(1,5,i2,j2,k2)*(ux(i-1,j,k,l)-2*ux(i,j,k,l)+ux(i+1,j,k,l)))/dx^2+(C(4,6,i2,j2,k2)*(ux(i,j-1,k,l)-2*ux(i,j,k,l)+ux(i,j+1,k,l)))/dy^2+(C(3,5,i2,j2,k2)*(ux(i,j,k-1,l)-2*ux(i,j,k,l)+ux(i,j,k+1,l)))/dz^2+(C(5,6,i2,j2,k2)*(uy(i-1,j,k,l)-2*uy(i,j,k,l)+uy(i+1,j,k,l)))/dx^2+(C(2,4,i2,j2,k2)*(uy(i,j-1,k,l)-2*uy(i,j,k,l)+uy(i,j+1,k,l)))/dy^2+(C(3,4,i2,j2,k2)*(uy(i,j,k-1,l)-2*uy(i,j,k,l)+uy(i,j,k+1,l)))/dz^2+(C(5,5,i2,j2,k2)*(uz(i-1,j,k,l)-2*uz(i,j,k,l)+uz(i+1,j,k,l)))/dx^2+(C(4,4,i2,j2,k2)*(uz(i,j-1,k,l)-2*uz(i,j,k,l)+uz(i,j+1,k,l)))/dy^2+(C(3,3,i2,j2,k2)*(uz(i,j,k-1,l)-2*uz(i,j,k,l)+uz(i,j,k+1,l)))/dz^2+srci+(C(1,4,i2,j2,k2)*(ux(i-1,j-1,k,l)/4-ux(i-1,j+1,k,l)/4-ux(i+1,j-1,k,l)/4+ux(i+1,j+1,k,l)/4))/(dx*dy)+(C(5,6,i2,j2,k2)*(ux(i-1,j-1,k,l)/4-ux(i-1,j+1,k,l)/4-ux(i+1,j-1,k,l)/4+ux(i+1,j+1,k,l)/4))/(dx*dy)+(C(1,3,i2,j2,k2)*(ux(i-1,j,k-1,l)/4-ux(i-1,j,k+1,l)/4-ux(i+1,j,k-1,l)/4+ux(i+1,j,k+1,l)/4))/(dx*dz)+(C(5,5,i2,j2,k2)*(ux(i-1,j,k-1,l)/4-ux(i-1,j,k+1,l)/4-ux(i+1,j,k-1,l)/4+ux(i+1,j,k+1,l)/4))/(dx*dz)+(C(3,6,i2,j2,k2)*(ux(i,j-1,k-1,l)/4-ux(i,j-1,k+1,l)/4-ux(i,j+1,k-1,l)/4+ux(i,j+1,k+1,l)/4))/(dy*dz)+(C(4,5,i2,j2,k2)*(ux(i,j-1,k-1,l)/4-ux(i,j-1,k+1,l)/4-ux(i,j+1,k-1,l)/4+ux(i,j+1,k+1,l)/4))/(dy*dz)+(C(2,5,i2,j2,k2)*(uy(i-1,j-1,k,l)/4-uy(i-1,j+1,k,l)/4-uy(i+1,j-1,k,l)/4+uy(i+1,j+1,k,l)/4))/(dx*dy)+(C(4,6,i2,j2,k2)*(uy(i-1,j-1,k,l)/4-uy(i-1,j+1,k,l)/4-uy(i+1,j-1,k,l)/4+uy(i+1,j+1,k,l)/4))/(dx*dy)+(C(3,6,i2,j2,k2)*(uy(i-1,j,k-1,l)/4-uy(i-1,j,k+1,l)/4-uy(i+1,j,k-1,l)/4+uy(i+1,j,k+1,l)/4))/(dx*dz)+(C(4,5,i2,j2,k2)*(uy(i-1,j,k-1,l)/4-uy(i-1,j,k+1,l)/4-uy(i+1,j,k-1,l)/4+uy(i+1,j,k+1,l)/4))/(dx*dz)+(C(2,3,i2,j2,k2)*(uy(i,j-1,k-1,l)/4-uy(i,j-1,k+1,l)/4-uy(i,j+1,k-1,l)/4+uy(i,j+1,k+1,l)/4))/(dy*dz)+(C(4,4,i2,j2,k2)*(uy(i,j-1,k-1,l)/4-uy(i,j-1,k+1,l)/4-uy(i,j+1,k-1,l)/4+uy(i,j+1,k+1,l)/4))/(dy*dz)+(2*C(4,5,i2,j2,k2)*(uz(i-1,j-1,k,l)/4-uz(i-1,j+1,k,l)/4-uz(i+1,j-1,k,l)/4+uz(i+1,j+1,k,l)/4))/(dx*dy)+(2*C(3,5,i2,j2,k2)*(uz(i-1,j,k-1,l)/4-uz(i-1,j,k+1,l)/4-uz(i+1,j,k-1,l)/4+uz(i+1,j,k+1,l)/4))/(dx*dz)+(2*C(3,4,i2,j2,k2)*(uz(i,j-1,k-1,l)/4-uz(i,j-1,k+1,l)/4-uz(i,j+1,k-1,l)/4+uz(i,j+1,k+1,l)/4))/(dy*dz))/(rho(i,j,k)*(a(i2,j2,k2)/dt+1/dt^2));
                    
                end
            end
            %%
            Sx=zeros(nx,ny,nz);
            Sy=Sx;
            Sz=Sx;
            
            for m=1:Ns
                Sx(sx(m),sy(m),sz(m))=srcx(l,m);
                Sy(sx(m),sy(m),sz(m))=srcy(l,m);
                Sz(sx(m),sy(m),sz(m))=srcz(l,m);
                
                for k=sz(m)-1:sz(m)+1
                    if k<=2
                        for i=sx(m)-1:sx(m)+1
                            for j=sy(m)-1:sy(m)+1
                                Id=id(nx,ny,nz,1,i,j,k,1,i,j,k);
                                B(Id(2)  )=B(Id(2)  )+dt^2/rho(i,j,k)*((Sz(i,j+1,k)-Sz(i,j-1,k))/2/dy-(Sy(i,j,k+1)-Sy(i,j,k-1))/2/dz);
                                B(Id(2)+1)=B(Id(2)+1)+dt^2/rho(i,j,k)*((Sx(i,j,k+1)-Sx(i,j,k-1))/2/dz-(Sz(i+1,j,k)-Sz(i-1,j,k))/2/dx);
                                B(Id(2)+2)=B(Id(2)+2)+dt^2/rho(i,j,k)*((Sy(i+1,j,k)-Sy(i-1,j,k))/2/dx-(Sx(i,j+1,k)-Sx(i,j-1,k))/2/dy);
                            end
                        end
                    else
                        for i=sx(m)-1:sx(m)+1
                            for j=sy(m)-1:sy(m)+1
                                ux(i,j,k,l+1)=ux(i,j,k,l+1)+dt^2/rho(i,j,k)*((Sz(i,j+1,k)-Sz(i,j-1,k))/2/dy-(Sy(i,j,k+1)-Sy(i,j,k-1))/2/dz);
                                uy(i,j,k,l+1)=uy(i,j,k,l+1)+dt^2/rho(i,j,k)*((Sx(i,j,k+1)-Sx(i,j,k-1))/2/dz-(Sz(i+1,j,k)-Sz(i-1,j,k))/2/dx);
                                uz(i,j,k,l+1)=uz(i,j,k,l+1)+dt^2/rho(i,j,k)*((Sy(i+1,j,k)-Sy(i-1,j,k))/2/dx-(Sx(i,j+1,k)-Sx(i,j-1,k))/2/dy);
                            end
                        end
                    end
                end
            end
            %% solve u
            % u2=AA\B;
            u2=gmres(AA,B,[],tol,10^3,[],[],u2);
            ux(:,:,1:2,l+1)=reshape(u2(1:3:nx*scalex*ny*scaley*3*2),[nx*scalex,ny*scaley,2]);
            uy(:,:,1:2,l+1)=reshape(u2(2:3:nx*scalex*ny*scaley*3*2),[nx*scalex,ny*scaley,2]);
            uz(:,:,1:2,l+1)=reshape(u2(3:3:nx*scalex*ny*scaley*3*2),[nx*scalex,ny*scaley,2]);
            %% plot
            figure(9)
            %set(gcf,'Visible','on');
            %set(gcf,'position',[0,0,1500,600]);
            pcolor3(ux(:,:,:,l));
            colorbar;
            set(gca,'zdir','reverse');
            xlabel(['x*' num2str(dx) '[m]']);
            ylabel(['y*' num2str(dy) '[m]']);
            zlabel(['z*' num2str(dz) '[m]']);
            title(['t=' num2str(dt*l) 's']);
            
            for i=1:size(sx,2)
                hold on;
                ax2=plot3(sx(i),sy(i),sz(i),'o','color','red');
            end
            legend([ax2],'source','Location',[0.5,0.03,0.005,0.005],'orientation','horizontal');
            hold off;
            shg;
            %% timing
            fprintf('\ntime step=%d/%d',l+1,nt);
            fprintf('\n    epalsed time=%.2fs',toc);
            d=clock;
            fprintf('\n    current time=%d %d %d %d %d %.0d  ',d(1),d(2),d(3),d(4),d(5),d(6));
        end
        %%
    case 1
        %% initialization
        tic;
        format shortg;
        % number of sources
        Ns=size(srcx,2);
        Nr=size(rx,2);
        
        AA=sparse(1:nx*ny*3*2,1:nx*ny*3*2,ones(nx*ny*3*2,1),nx*ny*3*2,nx*ny*3*2);
        B=zeros(nx*ny*3*2,1);
        
        ux=zeros(nx,ny,nz,3);
        uy=ux;
        uz=ux;
        
        Ux=zeros(nx,ny,nz);
        Uy=Ux;
        Uz=Ux;
        
        Rx=zeros(nt,Nr);
        Ry=Rx;
        Rz=Rx;
        
        Rux=zeros(nx,ny,nz,length(rt));
        Ruy=Rux;
        Ruz=Rux;
        
        w=zeros(3,3,nx,ny,nz);
        u2=zeros(nx*ny*3*2,1);
        %% PML
        vmax=sqrt(reshape(C(3,3,:,:,:),[nx,ny,nz])./rho);
        beta01=vmax*(lpn+1)*log(1/Rc)/2/lp/dx;
        beta02=vmax*(lpn+1)*log(1/Rc)/2/lp/dy;
        beta03=vmax*(lpn+1)*log(1/Rc)/2/lp/dz;
        %%
        beta1=zeros(nx,ny,nz);
        t=beta1;
        t(2:lp+1,:,:)=repmat(reshape((abs((1:lp)-lp-1)/lp).^lpn,[lp,1,1]),[1,ny,nz]);
        t(nx-lp:nx-1,:,:)=repmat(reshape(((abs(nx-lp-(nx-lp+1:nx)))/lp).^lpn,[lp,1,1]),[1,ny,nz]);
        beta1=beta01.*t;
        
        beta2=zeros(nx,ny,nz);
        t=beta2;
        t(:,2:lp+1,:)=repmat(reshape((abs((1:lp)-lp-1)/lp).^lpn,[1,lp,1]),[nx,1,nz]);
        t(:,ny-lp:ny-1,:)=repmat(reshape(((abs(nx-lp-(nx-lp+1:nx)))/lp).^lpn,[1,lp,1]),[nx,1,nz]);
        beta2=beta02.*t;
        
        beta3=zeros(nx,ny,nz);
        t=beta3;
        t(:,:,2:lp+1)=repmat(reshape((abs((1:lp)-lp-1)/lp).^lpn,[1,1,lp]),[nx,ny,1]);
        t(:,:,nz-lp:nz-1)=repmat(reshape(((abs(nz-lp-(nz-lp+1:nz)))/lp).^lpn,[1,1,lp]),[nx,ny,1]);
        beta3=beta03.*t;
        
        beta1(1,:,:)=beta1(2,:,:);
        beta1(end,:,:)=beta1(end-1,:,:);
        
        beta2(:,1,:)=beta2(:,2,:);
        beta2(:,end,:)=beta2(:,end-1,:);
        
        beta3(:,:,1)=beta3(:,:,2);
        beta3(:,:,end)=beta3(:,:,end-1);
        
        % free surface
        beta3(:,:,1:lp+1)=0;
        beta2(lp+2:nx-lp-1,lp+2:ny-lp-1,1:lp+1)=0;
        beta1(lp+2:nx-lp-1,lp+2:ny-lp-1,1:lp+1)=0;
        
        a=beta1+beta2+beta3;
        b=beta1.*beta2+beta2.*beta3+beta3.*beta1;
        c=beta1.*beta2.*beta3;
        a2=zeros(size(a));
        c2=zeros(size(c));
        % a and b are pending confirmed
        a2(a~=0)=1;
        c2(c~=0)=1;
        %% parameters for PML
        hatc=zeros(3,3,3,3,nx,ny,nz);
        hatctwo=hatc;
        hateta=hatc;
        hatetatwo=hatc;
        for i=1:3
            for j=1:3
                for k=1:3
                    for l=1:3
                        I=vn(i,j,k,l);
                        hatc(i,j,k,l,:,:,:)=reshape(a2.*reshape(C(I(1),I(2),:,:,:),[nx,ny,nz]),[1,1,1,1,nx,ny,nz]);
                        hatctwo(i,j,k,l,:,:,:)=reshape(c2./eval(['beta' (num2str(l))]).*reshape(C(I(1),I(2),:,:,:),[nx,ny,nz]),[1,1,1,1,nx,ny,nz]);
                        hateta(i,j,k,l,:,:,:)=reshape((a2-eval(['beta' (num2str(j))])-eval(['beta' (num2str(l))])).*reshape(Eta(I(1),I(2),:,:,:),[nx,ny,nz]),[1,1,1,1,nx,ny,nz]);
                        hatetatwo(i,j,k,l,:,:,:)=reshape(c2./eval(['beta' (num2str(l))]).*reshape(Eta(I(1),I(2),:,:,:),[nx,ny,nz]),[1,1,1,1,nx,ny,nz]);
                    end
                end
            end
        end
        hatctwo(isnan(hatctwo))=0;
        hatctwo(isinf(hatctwo))=0;
        hatetatwo(isnan(hatetatwo))=0;
        hatetatwo(isinf(hatetatwo))=0;
        %% free surface
        k=1;
        for i=2:nx-1
            for j=2:ny-1
                %% first eq
                Id=id(nx,ny,nz,1,i,j,k,1,i,j-1,k);
                AA(Id(1),Id(2))=(-C(5,6,i,j,k)/(2*dy)-Eta(5,6,i,j,k)/(2*dt*dy));
                
                Id=id(nx,ny,nz,1,i,j,k,1,i-1,j,k);
                AA(Id(1),Id(2))=(-C(1,5,i,j,k)/(2*dx)-Eta(1,5,i,j,k)/(2*dt*dx));
                
                Id=id(nx,ny,nz,1,i,j,k,1,i,j,k);
                AA(Id(1),Id(2))=(-C(5,5,i,j,k)/dz-Eta(5,5,i,j,k)/(dt*dz));
                
                Id=id(nx,ny,nz,1,i,j,k,1,i+1,j,k);
                AA(Id(1),Id(2))=(C(1,5,i,j,k)/(2*dx)+Eta(1,5,i,j,k)/(2*dt*dx));
                
                Id=id(nx,ny,nz,1,i,j,k,1,i,j+1,k);
                AA(Id(1),Id(2))=(C(5,6,i,j,k)/(2*dy)+Eta(5,6,i,j,k)/(2*dt*dy));
                
                Id=id(nx,ny,nz,1,i,j,k,1,i,j,k+1);
                AA(Id(1),Id(2))=(C(5,5,i,j,k)/dz+Eta(5,5,i,j,k)/(dt*dz));
                
                Id=id(nx,ny,nz,1,i,j,k,2,i,j-1,k);
                AA(Id(1),Id(2))=(-C(2,5,i,j,k)/(2*dy)-Eta(2,5,i,j,k)/(2*dt*dy));
                
                Id=id(nx,ny,nz,1,i,j,k,2,i-1,j,k);
                AA(Id(1),Id(2))=(-C(5,6,i,j,k)/(2*dx)-Eta(5,6,i,j,k)/(2*dt*dx));
                
                Id=id(nx,ny,nz,1,i,j,k,2,i,j,k);
                AA(Id(1),Id(2))=(-C(4,5,i,j,k)/dz-Eta(4,5,i,j,k)/(dt*dz));
                
                Id=id(nx,ny,nz,1,i,j,k,2,i+1,j,k);
                AA(Id(1),Id(2))=(C(5,6,i,j,k)/(2*dx)+Eta(5,6,i,j,k)/(2*dt*dx));
                
                Id=id(nx,ny,nz,1,i,j,k,2,i,j+1,k);
                AA(Id(1),Id(2))=(C(2,5,i,j,k)/(2*dy)+Eta(2,5,i,j,k)/(2*dt*dy));
                
                Id=id(nx,ny,nz,1,i,j,k,2,i,j,k+1);
                AA(Id(1),Id(2))=(C(4,5,i,j,k)/dz+Eta(4,5,i,j,k)/(dt*dz));
                
                Id=id(nx,ny,nz,1,i,j,k,3,i,j-1,k);
                AA(Id(1),Id(2))=(-C(4,5,i,j,k)/(2*dy)-Eta(4,5,i,j,k)/(2*dt*dy));
                
                Id=id(nx,ny,nz,1,i,j,k,3,i-1,j,k);
                AA(Id(1),Id(2))=(-C(5,5,i,j,k)/(2*dx)-Eta(5,5,i,j,k)/(2*dt*dx));
                
                Id=id(nx,ny,nz,1,i,j,k,3,i,j,k);
                AA(Id(1),Id(2))=(-C(3,5,i,j,k)/dz-Eta(3,5,i,j,k)/(dt*dz));
                
                Id=id(nx,ny,nz,1,i,j,k,3,i+1,j,k);
                AA(Id(1),Id(2))=(C(5,5,i,j,k)/(2*dx)+Eta(5,5,i,j,k)/(2*dt*dx));
                
                Id=id(nx,ny,nz,1,i,j,k,3,i,j+1,k);
                AA(Id(1),Id(2))=(C(4,5,i,j,k)/(2*dy)+Eta(4,5,i,j,k)/(2*dt*dy));
                
                Id=id(nx,ny,nz,1,i,j,k,3,i,j,k+1);
                AA(Id(1),Id(2))=(C(3,5,i,j,k)/dz+Eta(3,5,i,j,k)/(dt*dz));
                
                %% second eq
                Id=id(nx,ny,nz,2,i,j,k,1,i,j-1,k);
                AA(Id(1),Id(2))=(-C(4,6,i,j,k)/(2*dy)-Eta(4,6,i,j,k)/(2*dt*dy));
                
                Id=id(nx,ny,nz,2,i,j,k,1,i-1,j,k);
                AA(Id(1),Id(2))=(-C(1,4,i,j,k)/(2*dx)-Eta(1,4,i,j,k)/(2*dt*dx));
                
                Id=id(nx,ny,nz,2,i,j,k,1,i,j,k);
                AA(Id(1),Id(2))=(-C(4,5,i,j,k)/dz-Eta(4,5,i,j,k)/(dt*dz));
                
                Id=id(nx,ny,nz,2,i,j,k,1,i+1,j,k);
                AA(Id(1),Id(2))=(C(1,4,i,j,k)/(2*dx)+Eta(1,4,i,j,k)/(2*dt*dx));
                
                Id=id(nx,ny,nz,2,i,j,k,1,i,j+1,k);
                AA(Id(1),Id(2))=(C(4,6,i,j,k)/(2*dy)+Eta(4,6,i,j,k)/(2*dt*dy));
                
                Id=id(nx,ny,nz,2,i,j,k,1,i,j,k+1);
                AA(Id(1),Id(2))=(C(4,5,i,j,k)/dz+Eta(4,5,i,j,k)/(dt*dz));
                
                Id=id(nx,ny,nz,2,i,j,k,2,i,j-1,k);
                AA(Id(1),Id(2))=(-C(2,4,i,j,k)/(2*dy)-Eta(2,4,i,j,k)/(2*dt*dy));
                
                Id=id(nx,ny,nz,2,i,j,k,2,i-1,j,k);
                AA(Id(1),Id(2))=(-C(4,6,i,j,k)/(2*dx)-Eta(4,6,i,j,k)/(2*dt*dx));
                
                Id=id(nx,ny,nz,2,i,j,k,2,i,j,k);
                AA(Id(1),Id(2))=(-C(4,4,i,j,k)/dz-Eta(4,4,i,j,k)/(dt*dz));
                
                Id=id(nx,ny,nz,2,i,j,k,2,i+1,j,k);
                AA(Id(1),Id(2))=(C(4,6,i,j,k)/(2*dx)+Eta(4,6,i,j,k)/(2*dt*dx));
                
                Id=id(nx,ny,nz,2,i,j,k,2,i,j+1,k);
                AA(Id(1),Id(2))=(C(2,4,i,j,k)/(2*dy)+Eta(2,4,i,j,k)/(2*dt*dy));
                
                Id=id(nx,ny,nz,2,i,j,k,2,i,j,k+1);
                AA(Id(1),Id(2))=(C(4,4,i,j,k)/dz+Eta(4,4,i,j,k)/(dt*dz));
                
                Id=id(nx,ny,nz,2,i,j,k,3,i,j-1,k);
                AA(Id(1),Id(2))=(-C(4,4,i,j,k)/(2*dy)-Eta(4,4,i,j,k)/(2*dt*dy));
                
                Id=id(nx,ny,nz,2,i,j,k,3,i-1,j,k);
                AA(Id(1),Id(2))=(-C(4,5,i,j,k)/(2*dx)-Eta(4,5,i,j,k)/(2*dt*dx));
                
                Id=id(nx,ny,nz,2,i,j,k,3,i,j,k);
                AA(Id(1),Id(2))=(-C(3,4,i,j,k)/dz-Eta(3,4,i,j,k)/(dt*dz));
                
                Id=id(nx,ny,nz,2,i,j,k,3,i+1,j,k);
                AA(Id(1),Id(2))=(C(4,5,i,j,k)/(2*dx)+Eta(4,5,i,j,k)/(2*dt*dx));
                
                Id=id(nx,ny,nz,2,i,j,k,3,i,j+1,k);
                AA(Id(1),Id(2))=(C(4,4,i,j,k)/(2*dy)+Eta(4,4,i,j,k)/(2*dt*dy));
                
                Id=id(nx,ny,nz,2,i,j,k,3,i,j,k+1);
                AA(Id(1),Id(2))=(C(3,4,i,j,k)/dz+Eta(3,4,i,j,k)/(dt*dz));
                %% third eq
                Id=id(nx,ny,nz,3,i,j,k,1,i,j-1,k);
                AA(Id(1),Id(2))=(-C(3,6,i,j,k)/(2*dy)-Eta(3,6,i,j,k)/(2*dt*dy));
                
                Id=id(nx,ny,nz,3,i,j,k,1,i-1,j,k);
                AA(Id(1),Id(2))=(-C(1,3,i,j,k)/(2*dx)-Eta(1,3,i,j,k)/(2*dt*dx));
                
                Id=id(nx,ny,nz,3,i,j,k,1,i,j,k);
                AA(Id(1),Id(2))=(-C(3,5,i,j,k)/dz-Eta(3,5,i,j,k)/(dt*dz));
                
                Id=id(nx,ny,nz,3,i,j,k,1,i+1,j,k);
                AA(Id(1),Id(2))=(C(1,3,i,j,k)/(2*dx)+Eta(1,3,i,j,k)/(2*dt*dx));
                
                Id=id(nx,ny,nz,3,i,j,k,1,i,j+1,k);
                AA(Id(1),Id(2))=(C(3,6,i,j,k)/(2*dy)+Eta(3,6,i,j,k)/(2*dt*dy));
                
                Id=id(nx,ny,nz,3,i,j,k,1,i,j,k+1);
                AA(Id(1),Id(2))=(C(3,5,i,j,k)/dz+Eta(3,5,i,j,k)/(dt*dz));
                
                Id=id(nx,ny,nz,3,i,j,k,2,i,j-1,k);
                AA(Id(1),Id(2))=(-C(2,3,i,j,k)/(2*dy)-Eta(2,3,i,j,k)/(2*dt*dy));
                
                Id=id(nx,ny,nz,3,i,j,k,2,i-1,j,k);
                AA(Id(1),Id(2))=(-C(3,6,i,j,k)/(2*dx)-Eta(3,6,i,j,k)/(2*dt*dx));
                
                Id=id(nx,ny,nz,3,i,j,k,2,i,j,k);
                AA(Id(1),Id(2))=(-C(3,4,i,j,k)/dz-Eta(3,4,i,j,k)/(dt*dz));
                
                Id=id(nx,ny,nz,3,i,j,k,2,i+1,j,k);
                AA(Id(1),Id(2))=(C(3,6,i,j,k)/(2*dx)+Eta(3,6,i,j,k)/(2*dt*dx));
                
                Id=id(nx,ny,nz,3,i,j,k,2,i,j+1,k);
                AA(Id(1),Id(2))=(C(2,3,i,j,k)/(2*dy)+Eta(2,3,i,j,k)/(2*dt*dy));
                
                Id=id(nx,ny,nz,3,i,j,k,2,i,j,k+1);
                AA(Id(1),Id(2))=(C(3,4,i,j,k)/dz+Eta(3,4,i,j,k)/(dt*dz));
                
                Id=id(nx,ny,nz,3,i,j,k,3,i,j-1,k);
                AA(Id(1),Id(2))=(-C(3,4,i,j,k)/(2*dy)-Eta(3,4,i,j,k)/(2*dt*dy));
                
                Id=id(nx,ny,nz,3,i,j,k,3,i-1,j,k);
                AA(Id(1),Id(2))=(-C(3,5,i,j,k)/(2*dx)-Eta(3,5,i,j,k)/(2*dt*dx));
                
                Id=id(nx,ny,nz,3,i,j,k,3,i,j,k);
                AA(Id(1),Id(2))=(-C(3,3,i,j,k)/dz-Eta(3,3,i,j,k)/(dt*dz));
                
                Id=id(nx,ny,nz,3,i,j,k,3,i+1,j,k);
                AA(Id(1),Id(2))=(C(3,5,i,j,k)/(2*dx)+Eta(3,5,i,j,k)/(2*dt*dx));
                
                Id=id(nx,ny,nz,3,i,j,k,3,i,j+1,k);
                AA(Id(1),Id(2))=(C(3,4,i,j,k)/(2*dy)+Eta(3,4,i,j,k)/(2*dt*dy));
                
                Id=id(nx,ny,nz,3,i,j,k,3,i,j,k+1);
                AA(Id(1),Id(2))=(C(3,3,i,j,k)/dz+Eta(3,3,i,j,k)/(dt*dz));
            end
        end
        %% for l=2
        l=1;
        Sx=zeros(nx,ny,nz);
        Sy=Sx;
        Sz=Sx;
        % compute u
        for m=1:Ns
            Sx(sx(m),sy(m),sz(m))=srcx(l,m);
            Sy(sx(m),sy(m),sz(m))=srcy(l,m);
            Sz(sx(m),sy(m),sz(m))=srcz(l,m);
            for i=sx(m)-1:sx(m)+1
                for j=sy(m)-1:sy(m)+1
                    for k=sz(m)-1:sz(m)+1
                        ux(i,j,k,3)=ux(i,j,k,2)+dt^2/rho(i,j,k)*((Sz(i,j+1,k)-Sz(i,j-1,k))/2/dy-(Sy(i,j,k+1)-Sy(i,j,k-1))/2/dz);
                        uy(i,j,k,3)=uy(i,j,k,2)+dt^2/rho(i,j,k)*((Sx(i,j,k+1)-Sx(i,j,k-1))/2/dz-(Sz(i+1,j,k)-Sz(i-1,j,k))/2/dx);
                        uz(i,j,k,3)=uz(i,j,k,2)+dt^2/rho(i,j,k)*((Sy(i+1,j,k)-Sy(i-1,j,k))/2/dx-(Sx(i,j+1,k)-Sx(i,j-1,k))/2/dy);
                    end
                end
            end
        end
        %% save part of huge wavefield
        for lr=1:Nr
            Rx(l+1,lr)=ux(rx(lr),ry(lr),rz(lr),3);
            Ry(l+1,lr)=uy(rx(lr),ry(lr),rz(lr),3);
            Rz(l+1,lr)=uz(rx(lr),ry(lr),rz(lr),3);
        end
        
        if ismember(l+1,rt)
            Rl=find(rt==l+1);
            Rux(:,:,:,Rl)=ux(:,:,:,3);
            Ruy(:,:,:,Rl)=uy(:,:,:,3);
            Ruz(:,:,:,Rl)=uz(:,:,:,3);
        end
        
        fprintf('\ntime step=%d/%d',l+1,nt);
        fprintf('\n    epalsed time=%.2fs',toc);
        d=clock;
        fprintf('\n    current time=%d %d %d %d %d %.0d  ',d(1),d(2),d(3),d(4),d(5),d(6));
        %% for l>=3
        for l=2:nt-1
            %% arrange auxiliary field
            ux(:,:,:,1)=ux(:,:,:,2);
            ux(:,:,:,2)=ux(:,:,:,3);
            ux(:,:,:,3)=0;
            
            uy(:,:,:,1)=uy(:,:,:,2);
            uy(:,:,:,2)=uy(:,:,:,3);
            uy(:,:,:,3)=0;
            
            uz(:,:,:,1)=uz(:,:,:,2);
            uz(:,:,:,2)=uz(:,:,:,3);
            uz(:,:,:,3)=0;
            %% compute U
            Ux=Ux+ux(:,:,:,2)*dt;
            Uy=Uy+uy(:,:,:,2)*dt;
            Uz=Uz+uz(:,:,:,2)*dt;
            %% compute w
            for i=[2:lp+1,nx-lp:nx-1]
                for j=2:ny-1
                    for k=2:nz-1
                        w(1,1,i,j,k)=dt*((hateta(1,1,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(1,1,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(1,1,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(1,1,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(1,1,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(1,1,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(1,1,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(1,1,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(1,1,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(1,1,1,1,i,j,k)+hatetatwo(1,1,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(1,1,1,2,i,j,k)+hatetatwo(1,1,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(1,1,1,3,i,j,k)+hatetatwo(1,1,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(1,1,2,1,i,j,k)+hatetatwo(1,1,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(1,1,2,2,i,j,k)+hatetatwo(1,1,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(1,1,2,3,i,j,k)+hatetatwo(1,1,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(1,1,3,1,i,j,k)+hatetatwo(1,1,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(1,1,3,2,i,j,k)+hatetatwo(1,1,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(1,1,3,3,i,j,k)+hatetatwo(1,1,3,3,i,j,k)))/dz-(hatctwo(1,1,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(1,1,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,1,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(1,1,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(1,1,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,1,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(1,1,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(1,1,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,1,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta1(i,j,k)*w(1,1,i,j,k)*dt+w(1,1,i,j,k);
                        w(1,2,i,j,k)=dt*((hateta(1,2,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(1,2,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(1,2,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(1,2,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(1,2,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(1,2,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(1,2,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(1,2,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(1,2,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(1,2,1,1,i,j,k)+hatetatwo(1,2,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(1,2,1,2,i,j,k)+hatetatwo(1,2,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(1,2,1,3,i,j,k)+hatetatwo(1,2,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(1,2,2,1,i,j,k)+hatetatwo(1,2,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(1,2,2,2,i,j,k)+hatetatwo(1,2,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(1,2,2,3,i,j,k)+hatetatwo(1,2,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(1,2,3,1,i,j,k)+hatetatwo(1,2,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(1,2,3,2,i,j,k)+hatetatwo(1,2,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(1,2,3,3,i,j,k)+hatetatwo(1,2,3,3,i,j,k)))/dz-(hatctwo(1,2,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(1,2,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,2,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(1,2,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(1,2,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,2,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(1,2,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(1,2,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,2,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta1(i,j,k)*w(1,2,i,j,k)*dt+w(1,2,i,j,k);
                        w(1,3,i,j,k)=dt*((hateta(1,3,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(1,3,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(1,3,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(1,3,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(1,3,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(1,3,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(1,3,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(1,3,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(1,3,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(1,3,1,1,i,j,k)+hatetatwo(1,3,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(1,3,1,2,i,j,k)+hatetatwo(1,3,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(1,3,1,3,i,j,k)+hatetatwo(1,3,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(1,3,2,1,i,j,k)+hatetatwo(1,3,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(1,3,2,2,i,j,k)+hatetatwo(1,3,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(1,3,2,3,i,j,k)+hatetatwo(1,3,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(1,3,3,1,i,j,k)+hatetatwo(1,3,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(1,3,3,2,i,j,k)+hatetatwo(1,3,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(1,3,3,3,i,j,k)+hatetatwo(1,3,3,3,i,j,k)))/dz-(hatctwo(1,3,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(1,3,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,3,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(1,3,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(1,3,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,3,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(1,3,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(1,3,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,3,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta1(i,j,k)*w(1,3,i,j,k)*dt+w(1,3,i,j,k);
                        w(2,1,i,j,k)=dt*((hateta(2,1,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(2,1,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(2,1,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(2,1,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(2,1,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(2,1,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(2,1,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(2,1,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(2,1,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(2,1,1,1,i,j,k)+hatetatwo(2,1,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(2,1,1,2,i,j,k)+hatetatwo(2,1,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(2,1,1,3,i,j,k)+hatetatwo(2,1,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(2,1,2,1,i,j,k)+hatetatwo(2,1,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(2,1,2,2,i,j,k)+hatetatwo(2,1,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(2,1,2,3,i,j,k)+hatetatwo(2,1,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(2,1,3,1,i,j,k)+hatetatwo(2,1,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(2,1,3,2,i,j,k)+hatetatwo(2,1,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(2,1,3,3,i,j,k)+hatetatwo(2,1,3,3,i,j,k)))/dz-(hatctwo(2,1,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(2,1,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,1,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(2,1,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(2,1,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,1,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(2,1,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(2,1,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,1,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta2(i,j,k)*w(2,1,i,j,k)*dt+w(2,1,i,j,k);
                        w(2,2,i,j,k)=dt*((hateta(2,2,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(2,2,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(2,2,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(2,2,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(2,2,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(2,2,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(2,2,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(2,2,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(2,2,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(2,2,1,1,i,j,k)+hatetatwo(2,2,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(2,2,1,2,i,j,k)+hatetatwo(2,2,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(2,2,1,3,i,j,k)+hatetatwo(2,2,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(2,2,2,1,i,j,k)+hatetatwo(2,2,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(2,2,2,2,i,j,k)+hatetatwo(2,2,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(2,2,2,3,i,j,k)+hatetatwo(2,2,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(2,2,3,1,i,j,k)+hatetatwo(2,2,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(2,2,3,2,i,j,k)+hatetatwo(2,2,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(2,2,3,3,i,j,k)+hatetatwo(2,2,3,3,i,j,k)))/dz-(hatctwo(2,2,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(2,2,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,2,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(2,2,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(2,2,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,2,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(2,2,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(2,2,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,2,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta2(i,j,k)*w(2,2,i,j,k)*dt+w(2,2,i,j,k);
                        w(2,3,i,j,k)=dt*((hateta(2,3,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(2,3,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(2,3,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(2,3,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(2,3,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(2,3,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(2,3,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(2,3,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(2,3,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(2,3,1,1,i,j,k)+hatetatwo(2,3,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(2,3,1,2,i,j,k)+hatetatwo(2,3,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(2,3,1,3,i,j,k)+hatetatwo(2,3,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(2,3,2,1,i,j,k)+hatetatwo(2,3,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(2,3,2,2,i,j,k)+hatetatwo(2,3,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(2,3,2,3,i,j,k)+hatetatwo(2,3,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(2,3,3,1,i,j,k)+hatetatwo(2,3,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(2,3,3,2,i,j,k)+hatetatwo(2,3,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(2,3,3,3,i,j,k)+hatetatwo(2,3,3,3,i,j,k)))/dz-(hatctwo(2,3,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(2,3,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,3,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(2,3,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(2,3,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,3,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(2,3,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(2,3,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,3,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta2(i,j,k)*w(2,3,i,j,k)*dt+w(2,3,i,j,k);
                        w(3,1,i,j,k)=dt*((hateta(3,1,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(3,1,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(3,1,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(3,1,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(3,1,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(3,1,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(3,1,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(3,1,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(3,1,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(3,1,1,1,i,j,k)+hatetatwo(3,1,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(3,1,1,2,i,j,k)+hatetatwo(3,1,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(3,1,1,3,i,j,k)+hatetatwo(3,1,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(3,1,2,1,i,j,k)+hatetatwo(3,1,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(3,1,2,2,i,j,k)+hatetatwo(3,1,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(3,1,2,3,i,j,k)+hatetatwo(3,1,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(3,1,3,1,i,j,k)+hatetatwo(3,1,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(3,1,3,2,i,j,k)+hatetatwo(3,1,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(3,1,3,3,i,j,k)+hatetatwo(3,1,3,3,i,j,k)))/dz-(hatctwo(3,1,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(3,1,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,1,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(3,1,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(3,1,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,1,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(3,1,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(3,1,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,1,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta3(i,j,k)*w(3,1,i,j,k)*dt+w(3,1,i,j,k);
                        w(3,2,i,j,k)=dt*((hateta(3,2,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(3,2,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(3,2,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(3,2,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(3,2,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(3,2,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(3,2,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(3,2,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(3,2,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(3,2,1,1,i,j,k)+hatetatwo(3,2,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(3,2,1,2,i,j,k)+hatetatwo(3,2,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(3,2,1,3,i,j,k)+hatetatwo(3,2,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(3,2,2,1,i,j,k)+hatetatwo(3,2,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(3,2,2,2,i,j,k)+hatetatwo(3,2,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(3,2,2,3,i,j,k)+hatetatwo(3,2,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(3,2,3,1,i,j,k)+hatetatwo(3,2,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(3,2,3,2,i,j,k)+hatetatwo(3,2,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(3,2,3,3,i,j,k)+hatetatwo(3,2,3,3,i,j,k)))/dz-(hatctwo(3,2,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(3,2,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,2,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(3,2,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(3,2,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,2,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(3,2,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(3,2,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,2,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta3(i,j,k)*w(3,2,i,j,k)*dt+w(3,2,i,j,k);
                        w(3,3,i,j,k)=dt*((hateta(3,3,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(3,3,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(3,3,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(3,3,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(3,3,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(3,3,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(3,3,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(3,3,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(3,3,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(3,3,1,1,i,j,k)+hatetatwo(3,3,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(3,3,1,2,i,j,k)+hatetatwo(3,3,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(3,3,1,3,i,j,k)+hatetatwo(3,3,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(3,3,2,1,i,j,k)+hatetatwo(3,3,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(3,3,2,2,i,j,k)+hatetatwo(3,3,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(3,3,2,3,i,j,k)+hatetatwo(3,3,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(3,3,3,1,i,j,k)+hatetatwo(3,3,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(3,3,3,2,i,j,k)+hatetatwo(3,3,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(3,3,3,3,i,j,k)+hatetatwo(3,3,3,3,i,j,k)))/dz-(hatctwo(3,3,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(3,3,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,3,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(3,3,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(3,3,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,3,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(3,3,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(3,3,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,3,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta3(i,j,k)*w(3,3,i,j,k)*dt+w(3,3,i,j,k);
                    end
                end
            end
            
            for i=2:nx-1
                for j=[2:lp+1,ny-lp:ny-1]
                    for k=2:nz-1
                        w(1,1,i,j,k)=dt*((hateta(1,1,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(1,1,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(1,1,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(1,1,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(1,1,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(1,1,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(1,1,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(1,1,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(1,1,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(1,1,1,1,i,j,k)+hatetatwo(1,1,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(1,1,1,2,i,j,k)+hatetatwo(1,1,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(1,1,1,3,i,j,k)+hatetatwo(1,1,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(1,1,2,1,i,j,k)+hatetatwo(1,1,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(1,1,2,2,i,j,k)+hatetatwo(1,1,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(1,1,2,3,i,j,k)+hatetatwo(1,1,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(1,1,3,1,i,j,k)+hatetatwo(1,1,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(1,1,3,2,i,j,k)+hatetatwo(1,1,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(1,1,3,3,i,j,k)+hatetatwo(1,1,3,3,i,j,k)))/dz-(hatctwo(1,1,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(1,1,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,1,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(1,1,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(1,1,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,1,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(1,1,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(1,1,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,1,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta1(i,j,k)*w(1,1,i,j,k)*dt+w(1,1,i,j,k);
                        w(1,2,i,j,k)=dt*((hateta(1,2,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(1,2,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(1,2,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(1,2,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(1,2,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(1,2,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(1,2,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(1,2,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(1,2,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(1,2,1,1,i,j,k)+hatetatwo(1,2,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(1,2,1,2,i,j,k)+hatetatwo(1,2,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(1,2,1,3,i,j,k)+hatetatwo(1,2,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(1,2,2,1,i,j,k)+hatetatwo(1,2,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(1,2,2,2,i,j,k)+hatetatwo(1,2,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(1,2,2,3,i,j,k)+hatetatwo(1,2,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(1,2,3,1,i,j,k)+hatetatwo(1,2,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(1,2,3,2,i,j,k)+hatetatwo(1,2,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(1,2,3,3,i,j,k)+hatetatwo(1,2,3,3,i,j,k)))/dz-(hatctwo(1,2,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(1,2,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,2,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(1,2,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(1,2,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,2,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(1,2,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(1,2,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,2,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta1(i,j,k)*w(1,2,i,j,k)*dt+w(1,2,i,j,k);
                        w(1,3,i,j,k)=dt*((hateta(1,3,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(1,3,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(1,3,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(1,3,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(1,3,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(1,3,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(1,3,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(1,3,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(1,3,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(1,3,1,1,i,j,k)+hatetatwo(1,3,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(1,3,1,2,i,j,k)+hatetatwo(1,3,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(1,3,1,3,i,j,k)+hatetatwo(1,3,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(1,3,2,1,i,j,k)+hatetatwo(1,3,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(1,3,2,2,i,j,k)+hatetatwo(1,3,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(1,3,2,3,i,j,k)+hatetatwo(1,3,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(1,3,3,1,i,j,k)+hatetatwo(1,3,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(1,3,3,2,i,j,k)+hatetatwo(1,3,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(1,3,3,3,i,j,k)+hatetatwo(1,3,3,3,i,j,k)))/dz-(hatctwo(1,3,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(1,3,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,3,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(1,3,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(1,3,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,3,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(1,3,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(1,3,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,3,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta1(i,j,k)*w(1,3,i,j,k)*dt+w(1,3,i,j,k);
                        w(2,1,i,j,k)=dt*((hateta(2,1,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(2,1,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(2,1,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(2,1,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(2,1,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(2,1,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(2,1,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(2,1,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(2,1,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(2,1,1,1,i,j,k)+hatetatwo(2,1,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(2,1,1,2,i,j,k)+hatetatwo(2,1,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(2,1,1,3,i,j,k)+hatetatwo(2,1,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(2,1,2,1,i,j,k)+hatetatwo(2,1,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(2,1,2,2,i,j,k)+hatetatwo(2,1,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(2,1,2,3,i,j,k)+hatetatwo(2,1,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(2,1,3,1,i,j,k)+hatetatwo(2,1,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(2,1,3,2,i,j,k)+hatetatwo(2,1,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(2,1,3,3,i,j,k)+hatetatwo(2,1,3,3,i,j,k)))/dz-(hatctwo(2,1,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(2,1,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,1,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(2,1,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(2,1,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,1,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(2,1,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(2,1,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,1,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta2(i,j,k)*w(2,1,i,j,k)*dt+w(2,1,i,j,k);
                        w(2,2,i,j,k)=dt*((hateta(2,2,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(2,2,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(2,2,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(2,2,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(2,2,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(2,2,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(2,2,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(2,2,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(2,2,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(2,2,1,1,i,j,k)+hatetatwo(2,2,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(2,2,1,2,i,j,k)+hatetatwo(2,2,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(2,2,1,3,i,j,k)+hatetatwo(2,2,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(2,2,2,1,i,j,k)+hatetatwo(2,2,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(2,2,2,2,i,j,k)+hatetatwo(2,2,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(2,2,2,3,i,j,k)+hatetatwo(2,2,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(2,2,3,1,i,j,k)+hatetatwo(2,2,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(2,2,3,2,i,j,k)+hatetatwo(2,2,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(2,2,3,3,i,j,k)+hatetatwo(2,2,3,3,i,j,k)))/dz-(hatctwo(2,2,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(2,2,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,2,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(2,2,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(2,2,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,2,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(2,2,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(2,2,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,2,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta2(i,j,k)*w(2,2,i,j,k)*dt+w(2,2,i,j,k);
                        w(2,3,i,j,k)=dt*((hateta(2,3,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(2,3,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(2,3,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(2,3,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(2,3,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(2,3,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(2,3,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(2,3,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(2,3,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(2,3,1,1,i,j,k)+hatetatwo(2,3,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(2,3,1,2,i,j,k)+hatetatwo(2,3,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(2,3,1,3,i,j,k)+hatetatwo(2,3,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(2,3,2,1,i,j,k)+hatetatwo(2,3,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(2,3,2,2,i,j,k)+hatetatwo(2,3,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(2,3,2,3,i,j,k)+hatetatwo(2,3,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(2,3,3,1,i,j,k)+hatetatwo(2,3,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(2,3,3,2,i,j,k)+hatetatwo(2,3,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(2,3,3,3,i,j,k)+hatetatwo(2,3,3,3,i,j,k)))/dz-(hatctwo(2,3,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(2,3,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,3,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(2,3,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(2,3,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,3,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(2,3,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(2,3,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,3,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta2(i,j,k)*w(2,3,i,j,k)*dt+w(2,3,i,j,k);
                        w(3,1,i,j,k)=dt*((hateta(3,1,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(3,1,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(3,1,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(3,1,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(3,1,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(3,1,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(3,1,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(3,1,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(3,1,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(3,1,1,1,i,j,k)+hatetatwo(3,1,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(3,1,1,2,i,j,k)+hatetatwo(3,1,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(3,1,1,3,i,j,k)+hatetatwo(3,1,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(3,1,2,1,i,j,k)+hatetatwo(3,1,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(3,1,2,2,i,j,k)+hatetatwo(3,1,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(3,1,2,3,i,j,k)+hatetatwo(3,1,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(3,1,3,1,i,j,k)+hatetatwo(3,1,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(3,1,3,2,i,j,k)+hatetatwo(3,1,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(3,1,3,3,i,j,k)+hatetatwo(3,1,3,3,i,j,k)))/dz-(hatctwo(3,1,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(3,1,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,1,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(3,1,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(3,1,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,1,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(3,1,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(3,1,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,1,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta3(i,j,k)*w(3,1,i,j,k)*dt+w(3,1,i,j,k);
                        w(3,2,i,j,k)=dt*((hateta(3,2,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(3,2,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(3,2,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(3,2,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(3,2,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(3,2,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(3,2,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(3,2,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(3,2,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(3,2,1,1,i,j,k)+hatetatwo(3,2,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(3,2,1,2,i,j,k)+hatetatwo(3,2,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(3,2,1,3,i,j,k)+hatetatwo(3,2,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(3,2,2,1,i,j,k)+hatetatwo(3,2,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(3,2,2,2,i,j,k)+hatetatwo(3,2,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(3,2,2,3,i,j,k)+hatetatwo(3,2,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(3,2,3,1,i,j,k)+hatetatwo(3,2,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(3,2,3,2,i,j,k)+hatetatwo(3,2,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(3,2,3,3,i,j,k)+hatetatwo(3,2,3,3,i,j,k)))/dz-(hatctwo(3,2,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(3,2,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,2,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(3,2,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(3,2,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,2,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(3,2,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(3,2,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,2,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta3(i,j,k)*w(3,2,i,j,k)*dt+w(3,2,i,j,k);
                        w(3,3,i,j,k)=dt*((hateta(3,3,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(3,3,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(3,3,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(3,3,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(3,3,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(3,3,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(3,3,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(3,3,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(3,3,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(3,3,1,1,i,j,k)+hatetatwo(3,3,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(3,3,1,2,i,j,k)+hatetatwo(3,3,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(3,3,1,3,i,j,k)+hatetatwo(3,3,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(3,3,2,1,i,j,k)+hatetatwo(3,3,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(3,3,2,2,i,j,k)+hatetatwo(3,3,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(3,3,2,3,i,j,k)+hatetatwo(3,3,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(3,3,3,1,i,j,k)+hatetatwo(3,3,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(3,3,3,2,i,j,k)+hatetatwo(3,3,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(3,3,3,3,i,j,k)+hatetatwo(3,3,3,3,i,j,k)))/dz-(hatctwo(3,3,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(3,3,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,3,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(3,3,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(3,3,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,3,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(3,3,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(3,3,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,3,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta3(i,j,k)*w(3,3,i,j,k)*dt+w(3,3,i,j,k);
                    end
                end
            end
            
            for i=2:nx-1
                for j=2:ny-1
                    for k=[2:lp+1,nz-lp:nz-1]
                        w(1,1,i,j,k)=dt*((hateta(1,1,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(1,1,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(1,1,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(1,1,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(1,1,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(1,1,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(1,1,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(1,1,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(1,1,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(1,1,1,1,i,j,k)+hatetatwo(1,1,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(1,1,1,2,i,j,k)+hatetatwo(1,1,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(1,1,1,3,i,j,k)+hatetatwo(1,1,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(1,1,2,1,i,j,k)+hatetatwo(1,1,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(1,1,2,2,i,j,k)+hatetatwo(1,1,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(1,1,2,3,i,j,k)+hatetatwo(1,1,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(1,1,3,1,i,j,k)+hatetatwo(1,1,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(1,1,3,2,i,j,k)+hatetatwo(1,1,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(1,1,3,3,i,j,k)+hatetatwo(1,1,3,3,i,j,k)))/dz-(hatctwo(1,1,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(1,1,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,1,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(1,1,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(1,1,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,1,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(1,1,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(1,1,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,1,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta1(i,j,k)*w(1,1,i,j,k)*dt+w(1,1,i,j,k);
                        w(1,2,i,j,k)=dt*((hateta(1,2,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(1,2,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(1,2,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(1,2,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(1,2,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(1,2,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(1,2,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(1,2,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(1,2,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(1,2,1,1,i,j,k)+hatetatwo(1,2,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(1,2,1,2,i,j,k)+hatetatwo(1,2,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(1,2,1,3,i,j,k)+hatetatwo(1,2,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(1,2,2,1,i,j,k)+hatetatwo(1,2,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(1,2,2,2,i,j,k)+hatetatwo(1,2,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(1,2,2,3,i,j,k)+hatetatwo(1,2,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(1,2,3,1,i,j,k)+hatetatwo(1,2,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(1,2,3,2,i,j,k)+hatetatwo(1,2,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(1,2,3,3,i,j,k)+hatetatwo(1,2,3,3,i,j,k)))/dz-(hatctwo(1,2,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(1,2,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,2,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(1,2,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(1,2,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,2,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(1,2,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(1,2,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,2,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta1(i,j,k)*w(1,2,i,j,k)*dt+w(1,2,i,j,k);
                        w(1,3,i,j,k)=dt*((hateta(1,3,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(1,3,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(1,3,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(1,3,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(1,3,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(1,3,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(1,3,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(1,3,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(1,3,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(1,3,1,1,i,j,k)+hatetatwo(1,3,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(1,3,1,2,i,j,k)+hatetatwo(1,3,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(1,3,1,3,i,j,k)+hatetatwo(1,3,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(1,3,2,1,i,j,k)+hatetatwo(1,3,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(1,3,2,2,i,j,k)+hatetatwo(1,3,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(1,3,2,3,i,j,k)+hatetatwo(1,3,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(1,3,3,1,i,j,k)+hatetatwo(1,3,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(1,3,3,2,i,j,k)+hatetatwo(1,3,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(1,3,3,3,i,j,k)+hatetatwo(1,3,3,3,i,j,k)))/dz-(hatctwo(1,3,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(1,3,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,3,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(1,3,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(1,3,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,3,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(1,3,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(1,3,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(1,3,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta1(i,j,k)*w(1,3,i,j,k)*dt+w(1,3,i,j,k);
                        w(2,1,i,j,k)=dt*((hateta(2,1,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(2,1,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(2,1,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(2,1,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(2,1,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(2,1,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(2,1,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(2,1,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(2,1,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(2,1,1,1,i,j,k)+hatetatwo(2,1,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(2,1,1,2,i,j,k)+hatetatwo(2,1,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(2,1,1,3,i,j,k)+hatetatwo(2,1,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(2,1,2,1,i,j,k)+hatetatwo(2,1,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(2,1,2,2,i,j,k)+hatetatwo(2,1,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(2,1,2,3,i,j,k)+hatetatwo(2,1,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(2,1,3,1,i,j,k)+hatetatwo(2,1,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(2,1,3,2,i,j,k)+hatetatwo(2,1,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(2,1,3,3,i,j,k)+hatetatwo(2,1,3,3,i,j,k)))/dz-(hatctwo(2,1,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(2,1,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,1,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(2,1,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(2,1,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,1,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(2,1,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(2,1,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,1,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta2(i,j,k)*w(2,1,i,j,k)*dt+w(2,1,i,j,k);
                        w(2,2,i,j,k)=dt*((hateta(2,2,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(2,2,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(2,2,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(2,2,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(2,2,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(2,2,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(2,2,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(2,2,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(2,2,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(2,2,1,1,i,j,k)+hatetatwo(2,2,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(2,2,1,2,i,j,k)+hatetatwo(2,2,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(2,2,1,3,i,j,k)+hatetatwo(2,2,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(2,2,2,1,i,j,k)+hatetatwo(2,2,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(2,2,2,2,i,j,k)+hatetatwo(2,2,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(2,2,2,3,i,j,k)+hatetatwo(2,2,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(2,2,3,1,i,j,k)+hatetatwo(2,2,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(2,2,3,2,i,j,k)+hatetatwo(2,2,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(2,2,3,3,i,j,k)+hatetatwo(2,2,3,3,i,j,k)))/dz-(hatctwo(2,2,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(2,2,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,2,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(2,2,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(2,2,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,2,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(2,2,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(2,2,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,2,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta2(i,j,k)*w(2,2,i,j,k)*dt+w(2,2,i,j,k);
                        w(2,3,i,j,k)=dt*((hateta(2,3,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(2,3,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(2,3,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(2,3,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(2,3,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(2,3,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(2,3,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(2,3,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(2,3,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(2,3,1,1,i,j,k)+hatetatwo(2,3,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(2,3,1,2,i,j,k)+hatetatwo(2,3,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(2,3,1,3,i,j,k)+hatetatwo(2,3,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(2,3,2,1,i,j,k)+hatetatwo(2,3,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(2,3,2,2,i,j,k)+hatetatwo(2,3,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(2,3,2,3,i,j,k)+hatetatwo(2,3,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(2,3,3,1,i,j,k)+hatetatwo(2,3,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(2,3,3,2,i,j,k)+hatetatwo(2,3,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(2,3,3,3,i,j,k)+hatetatwo(2,3,3,3,i,j,k)))/dz-(hatctwo(2,3,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(2,3,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,3,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(2,3,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(2,3,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,3,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(2,3,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(2,3,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(2,3,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta2(i,j,k)*w(2,3,i,j,k)*dt+w(2,3,i,j,k);
                        w(3,1,i,j,k)=dt*((hateta(3,1,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(3,1,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(3,1,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(3,1,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(3,1,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(3,1,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(3,1,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(3,1,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(3,1,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(3,1,1,1,i,j,k)+hatetatwo(3,1,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(3,1,1,2,i,j,k)+hatetatwo(3,1,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(3,1,1,3,i,j,k)+hatetatwo(3,1,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(3,1,2,1,i,j,k)+hatetatwo(3,1,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(3,1,2,2,i,j,k)+hatetatwo(3,1,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(3,1,2,3,i,j,k)+hatetatwo(3,1,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(3,1,3,1,i,j,k)+hatetatwo(3,1,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(3,1,3,2,i,j,k)+hatetatwo(3,1,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(3,1,3,3,i,j,k)+hatetatwo(3,1,3,3,i,j,k)))/dz-(hatctwo(3,1,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(3,1,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,1,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(3,1,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(3,1,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,1,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(3,1,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(3,1,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,1,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta3(i,j,k)*w(3,1,i,j,k)*dt+w(3,1,i,j,k);
                        w(3,2,i,j,k)=dt*((hateta(3,2,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(3,2,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(3,2,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(3,2,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(3,2,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(3,2,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(3,2,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(3,2,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(3,2,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(3,2,1,1,i,j,k)+hatetatwo(3,2,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(3,2,1,2,i,j,k)+hatetatwo(3,2,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(3,2,1,3,i,j,k)+hatetatwo(3,2,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(3,2,2,1,i,j,k)+hatetatwo(3,2,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(3,2,2,2,i,j,k)+hatetatwo(3,2,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(3,2,2,3,i,j,k)+hatetatwo(3,2,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(3,2,3,1,i,j,k)+hatetatwo(3,2,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(3,2,3,2,i,j,k)+hatetatwo(3,2,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(3,2,3,3,i,j,k)+hatetatwo(3,2,3,3,i,j,k)))/dz-(hatctwo(3,2,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(3,2,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,2,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(3,2,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(3,2,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,2,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(3,2,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(3,2,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,2,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta3(i,j,k)*w(3,2,i,j,k)*dt+w(3,2,i,j,k);
                        w(3,3,i,j,k)=dt*((hateta(3,3,1,1,i,j,k)*(ux(i-1,j,k,1)/2-ux(i-1,j,k,2)/2-ux(i+1,j,k,1)/2+ux(i+1,j,k,2)/2))/(dt*dx)-(hatctwo(3,3,1,2,i,j,k)*(Ux(i,j-1,k)/2-Ux(i,j+1,k)/2))/dy-(hatctwo(3,3,1,3,i,j,k)*(Ux(i,j,k-1)/2-Ux(i,j,k+1)/2))/dz-(hatctwo(3,3,2,1,i,j,k)*(Uy(i-1,j,k)/2-Uy(i+1,j,k)/2))/dx-(hatctwo(3,3,2,2,i,j,k)*(Uy(i,j-1,k)/2-Uy(i,j+1,k)/2))/dy-(hatctwo(3,3,2,3,i,j,k)*(Uy(i,j,k-1)/2-Uy(i,j,k+1)/2))/dz-(hatctwo(3,3,3,1,i,j,k)*(Uz(i-1,j,k)/2-Uz(i+1,j,k)/2))/dx-(hatctwo(3,3,3,2,i,j,k)*(Uz(i,j-1,k)/2-Uz(i,j+1,k)/2))/dy-(hatctwo(3,3,3,3,i,j,k)*(Uz(i,j,k-1)/2-Uz(i,j,k+1)/2))/dz-((ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2)*(hatc(3,3,1,1,i,j,k)+hatetatwo(3,3,1,1,i,j,k)))/dx-((ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2)*(hatc(3,3,1,2,i,j,k)+hatetatwo(3,3,1,2,i,j,k)))/dy-((ux(i,j,k-1,2)/2-ux(i,j,k+1,2)/2)*(hatc(3,3,1,3,i,j,k)+hatetatwo(3,3,1,3,i,j,k)))/dz-((uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2)*(hatc(3,3,2,1,i,j,k)+hatetatwo(3,3,2,1,i,j,k)))/dx-((uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2)*(hatc(3,3,2,2,i,j,k)+hatetatwo(3,3,2,2,i,j,k)))/dy-((uy(i,j,k-1,2)/2-uy(i,j,k+1,2)/2)*(hatc(3,3,2,3,i,j,k)+hatetatwo(3,3,2,3,i,j,k)))/dz-((uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2)*(hatc(3,3,3,1,i,j,k)+hatetatwo(3,3,3,1,i,j,k)))/dx-((uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2)*(hatc(3,3,3,2,i,j,k)+hatetatwo(3,3,3,2,i,j,k)))/dy-((uz(i,j,k-1,2)/2-uz(i,j,k+1,2)/2)*(hatc(3,3,3,3,i,j,k)+hatetatwo(3,3,3,3,i,j,k)))/dz-(hatctwo(3,3,1,1,i,j,k)*(Ux(i-1,j,k)/2-Ux(i+1,j,k)/2))/dx+(hateta(3,3,1,2,i,j,k)*(ux(i,j-1,k,1)/2-ux(i,j-1,k,2)/2-ux(i,j+1,k,1)/2+ux(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,3,1,3,i,j,k)*(ux(i,j,k-1,1)/2-ux(i,j,k-1,2)/2-ux(i,j,k+1,1)/2+ux(i,j,k+1,2)/2))/(dt*dz)+(hateta(3,3,2,1,i,j,k)*(uy(i-1,j,k,1)/2-uy(i-1,j,k,2)/2-uy(i+1,j,k,1)/2+uy(i+1,j,k,2)/2))/(dt*dx)+(hateta(3,3,2,2,i,j,k)*(uy(i,j-1,k,1)/2-uy(i,j-1,k,2)/2-uy(i,j+1,k,1)/2+uy(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,3,2,3,i,j,k)*(uy(i,j,k-1,1)/2-uy(i,j,k-1,2)/2-uy(i,j,k+1,1)/2+uy(i,j,k+1,2)/2))/(dt*dz)+(hateta(3,3,3,1,i,j,k)*(uz(i-1,j,k,1)/2-uz(i-1,j,k,2)/2-uz(i+1,j,k,1)/2+uz(i+1,j,k,2)/2))/(dt*dx)+(hateta(3,3,3,2,i,j,k)*(uz(i,j-1,k,1)/2-uz(i,j-1,k,2)/2-uz(i,j+1,k,1)/2+uz(i,j+1,k,2)/2))/(dt*dy)+(hateta(3,3,3,3,i,j,k)*(uz(i,j,k-1,1)/2-uz(i,j,k-1,2)/2-uz(i,j,k+1,1)/2+uz(i,j,k+1,2)/2))/(dt*dz))...
                            -beta3(i,j,k)*w(3,3,i,j,k)*dt+w(3,3,i,j,k);
                    end
                end
            end
            %% compute u
            for i=2:nx-1
                for j=2:ny-1
                    for k=3:nz-1
                        ux(i,j,k,3)=((w(1,1,i+1,j,k)-w(1,1,i-1,j,k))/2/dx-Eta(6,6,i,j,k)*((ux(i,j-1,k,1)-2*ux(i,j,k,1)+ux(i,j+1,k,1))/(dt*dy^2)-(ux(i,j-1,k,2)-2*ux(i,j,k,2)+ux(i,j+1,k,2))/(dt*dy^2))-Eta(5,5,i,j,k)*((ux(i,j,k-1,1)-2*ux(i,j,k,1)+ux(i,j,k+1,1))/(dt*dz^2)-(ux(i,j,k-1,2)-2*ux(i,j,k,2)+ux(i,j,k+1,2))/(dt*dz^2))-Eta(1,6,i,j,k)*((uy(i-1,j,k,1)-2*uy(i,j,k,1)+uy(i+1,j,k,1))/(dt*dx^2)-(uy(i-1,j,k,2)-2*uy(i,j,k,2)+uy(i+1,j,k,2))/(dt*dx^2))-Eta(2,6,i,j,k)*((uy(i,j-1,k,1)-2*uy(i,j,k,1)+uy(i,j+1,k,1))/(dt*dy^2)-(uy(i,j-1,k,2)-2*uy(i,j,k,2)+uy(i,j+1,k,2))/(dt*dy^2))-Eta(4,5,i,j,k)*((uy(i,j,k-1,1)-2*uy(i,j,k,1)+uy(i,j,k+1,1))/(dt*dz^2)-(uy(i,j,k-1,2)-2*uy(i,j,k,2)+uy(i,j,k+1,2))/(dt*dz^2))-Eta(1,5,i,j,k)*((uz(i-1,j,k,1)-2*uz(i,j,k,1)+uz(i+1,j,k,1))/(dt*dx^2)-(uz(i-1,j,k,2)-2*uz(i,j,k,2)+uz(i+1,j,k,2))/(dt*dx^2))-Eta(4,6,i,j,k)*((uz(i,j-1,k,1)-2*uz(i,j,k,1)+uz(i,j+1,k,1))/(dt*dy^2)-(uz(i,j-1,k,2)-2*uz(i,j,k,2)+uz(i,j+1,k,2))/(dt*dy^2))-Eta(3,5,i,j,k)*((uz(i,j,k-1,1)-2*uz(i,j,k,1)+uz(i,j,k+1,1))/(dt*dz^2)-(uz(i,j,k-1,2)-2*uz(i,j,k,2)+uz(i,j,k+1,2))/(dt*dz^2))-Eta(1,1,i,j,k)*((ux(i-1,j,k,1)-2*ux(i,j,k,1)+ux(i+1,j,k,1))/(dt*dx^2)-(ux(i-1,j,k,2)-2*ux(i,j,k,2)+ux(i+1,j,k,2))/(dt*dx^2))+(w(1,2,i,j+1,k)-w(1,2,i,j-1,k))/2/dy+(w(1,3,i,j+1,k)-w(1,3,i,j-1,k))/2/dz-rho(i,j,k)*(Ux(i,j,k)*c(i,j,k)+b(i,j,k)*ux(i,j,k,2)+(ux(i,j,k,1)-2*ux(i,j,k,2))/dt^2-(a(i,j,k)*ux(i,j,k,2))/dt)-2*Eta(1,6,i,j,k)*((ux(i-1,j-1,k,1)/4-ux(i-1,j+1,k,1)/4-ux(i+1,j-1,k,1)/4+ux(i+1,j+1,k,1)/4)/(dt*dx*dy)-(ux(i-1,j-1,k,2)/4-ux(i-1,j+1,k,2)/4-ux(i+1,j-1,k,2)/4+ux(i+1,j+1,k,2)/4)/(dt*dx*dy))-2*Eta(1,5,i,j,k)*((ux(i-1,j,k-1,1)/4-ux(i-1,j,k+1,1)/4-ux(i+1,j,k-1,1)/4+ux(i+1,j,k+1,1)/4)/(dt*dx*dz)-(ux(i-1,j,k-1,2)/4-ux(i-1,j,k+1,2)/4-ux(i+1,j,k-1,2)/4+ux(i+1,j,k+1,2)/4)/(dt*dx*dz))-2*Eta(5,6,i,j,k)*((ux(i,j-1,k-1,1)/4-ux(i,j-1,k+1,1)/4-ux(i,j+1,k-1,1)/4+ux(i,j+1,k+1,1)/4)/(dt*dy*dz)-(ux(i,j-1,k-1,2)/4-ux(i,j-1,k+1,2)/4-ux(i,j+1,k-1,2)/4+ux(i,j+1,k+1,2)/4)/(dt*dy*dz))-Eta(1,2,i,j,k)*((uy(i-1,j-1,k,1)/4-uy(i-1,j+1,k,1)/4-uy(i+1,j-1,k,1)/4+uy(i+1,j+1,k,1)/4)/(dt*dx*dy)-(uy(i-1,j-1,k,2)/4-uy(i-1,j+1,k,2)/4-uy(i+1,j-1,k,2)/4+uy(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(6,6,i,j,k)*((uy(i-1,j-1,k,1)/4-uy(i-1,j+1,k,1)/4-uy(i+1,j-1,k,1)/4+uy(i+1,j+1,k,1)/4)/(dt*dx*dy)-(uy(i-1,j-1,k,2)/4-uy(i-1,j+1,k,2)/4-uy(i+1,j-1,k,2)/4+uy(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(1,4,i,j,k)*((uy(i-1,j,k-1,1)/4-uy(i-1,j,k+1,1)/4-uy(i+1,j,k-1,1)/4+uy(i+1,j,k+1,1)/4)/(dt*dx*dz)-(uy(i-1,j,k-1,2)/4-uy(i-1,j,k+1,2)/4-uy(i+1,j,k-1,2)/4+uy(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(5,6,i,j,k)*((uy(i-1,j,k-1,1)/4-uy(i-1,j,k+1,1)/4-uy(i+1,j,k-1,1)/4+uy(i+1,j,k+1,1)/4)/(dt*dx*dz)-(uy(i-1,j,k-1,2)/4-uy(i-1,j,k+1,2)/4-uy(i+1,j,k-1,2)/4+uy(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(2,5,i,j,k)*((uy(i,j-1,k-1,1)/4-uy(i,j-1,k+1,1)/4-uy(i,j+1,k-1,1)/4+uy(i,j+1,k+1,1)/4)/(dt*dy*dz)-(uy(i,j-1,k-1,2)/4-uy(i,j-1,k+1,2)/4-uy(i,j+1,k-1,2)/4+uy(i,j+1,k+1,2)/4)/(dt*dy*dz))-Eta(4,6,i,j,k)*((uy(i,j-1,k-1,1)/4-uy(i,j-1,k+1,1)/4-uy(i,j+1,k-1,1)/4+uy(i,j+1,k+1,1)/4)/(dt*dy*dz)-(uy(i,j-1,k-1,2)/4-uy(i,j-1,k+1,2)/4-uy(i,j+1,k-1,2)/4+uy(i,j+1,k+1,2)/4)/(dt*dy*dz))-Eta(1,4,i,j,k)*((uz(i-1,j-1,k,1)/4-uz(i-1,j+1,k,1)/4-uz(i+1,j-1,k,1)/4+uz(i+1,j+1,k,1)/4)/(dt*dx*dy)-(uz(i-1,j-1,k,2)/4-uz(i-1,j+1,k,2)/4-uz(i+1,j-1,k,2)/4+uz(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(5,6,i,j,k)*((uz(i-1,j-1,k,1)/4-uz(i-1,j+1,k,1)/4-uz(i+1,j-1,k,1)/4+uz(i+1,j+1,k,1)/4)/(dt*dx*dy)-(uz(i-1,j-1,k,2)/4-uz(i-1,j+1,k,2)/4-uz(i+1,j-1,k,2)/4+uz(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(1,3,i,j,k)*((uz(i-1,j,k-1,1)/4-uz(i-1,j,k+1,1)/4-uz(i+1,j,k-1,1)/4+uz(i+1,j,k+1,1)/4)/(dt*dx*dz)-(uz(i-1,j,k-1,2)/4-uz(i-1,j,k+1,2)/4-uz(i+1,j,k-1,2)/4+uz(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(5,5,i,j,k)*((uz(i-1,j,k-1,1)/4-uz(i-1,j,k+1,1)/4-uz(i+1,j,k-1,1)/4+uz(i+1,j,k+1,1)/4)/(dt*dx*dz)-(uz(i-1,j,k-1,2)/4-uz(i-1,j,k+1,2)/4-uz(i+1,j,k-1,2)/4+uz(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(3,6,i,j,k)*((uz(i,j-1,k-1,1)/4-uz(i,j-1,k+1,1)/4-uz(i,j+1,k-1,1)/4+uz(i,j+1,k+1,1)/4)/(dt*dy*dz)-(uz(i,j-1,k-1,2)/4-uz(i,j-1,k+1,2)/4-uz(i,j+1,k-1,2)/4+uz(i,j+1,k+1,2)/4)/(dt*dy*dz))-Eta(4,5,i,j,k)*((uz(i,j-1,k-1,1)/4-uz(i,j-1,k+1,1)/4-uz(i,j+1,k-1,1)/4+uz(i,j+1,k+1,1)/4)/(dt*dy*dz)-(uz(i,j-1,k-1,2)/4-uz(i,j-1,k+1,2)/4-uz(i,j+1,k-1,2)/4+uz(i,j+1,k+1,2)/4)/(dt*dy*dz))+(C(1,1,i,j,k)*(ux(i-1,j,k,2)-2*ux(i,j,k,2)+ux(i+1,j,k,2)))/dx^2+(C(6,6,i,j,k)*(ux(i,j-1,k,2)-2*ux(i,j,k,2)+ux(i,j+1,k,2)))/dy^2+(C(5,5,i,j,k)*(ux(i,j,k-1,2)-2*ux(i,j,k,2)+ux(i,j,k+1,2)))/dz^2+(C(1,6,i,j,k)*(uy(i-1,j,k,2)-2*uy(i,j,k,2)+uy(i+1,j,k,2)))/dx^2+(C(2,6,i,j,k)*(uy(i,j-1,k,2)-2*uy(i,j,k,2)+uy(i,j+1,k,2)))/dy^2+(C(4,5,i,j,k)*(uy(i,j,k-1,2)-2*uy(i,j,k,2)+uy(i,j,k+1,2)))/dz^2+(C(1,5,i,j,k)*(uz(i-1,j,k,2)-2*uz(i,j,k,2)+uz(i+1,j,k,2)))/dx^2+(C(4,6,i,j,k)*(uz(i,j-1,k,2)-2*uz(i,j,k,2)+uz(i,j+1,k,2)))/dy^2+(C(3,5,i,j,k)*(uz(i,j,k-1,2)-2*uz(i,j,k,2)+uz(i,j,k+1,2)))/dz^2+(2*C(1,6,i,j,k)*(ux(i-1,j-1,k,2)/4-ux(i-1,j+1,k,2)/4-ux(i+1,j-1,k,2)/4+ux(i+1,j+1,k,2)/4))/(dx*dy)+(2*C(1,5,i,j,k)*(ux(i-1,j,k-1,2)/4-ux(i-1,j,k+1,2)/4-ux(i+1,j,k-1,2)/4+ux(i+1,j,k+1,2)/4))/(dx*dz)+(2*C(5,6,i,j,k)*(ux(i,j-1,k-1,2)/4-ux(i,j-1,k+1,2)/4-ux(i,j+1,k-1,2)/4+ux(i,j+1,k+1,2)/4))/(dy*dz)+(C(1,2,i,j,k)*(uy(i-1,j-1,k,2)/4-uy(i-1,j+1,k,2)/4-uy(i+1,j-1,k,2)/4+uy(i+1,j+1,k,2)/4))/(dx*dy)+(C(6,6,i,j,k)*(uy(i-1,j-1,k,2)/4-uy(i-1,j+1,k,2)/4-uy(i+1,j-1,k,2)/4+uy(i+1,j+1,k,2)/4))/(dx*dy)+(C(1,4,i,j,k)*(uy(i-1,j,k-1,2)/4-uy(i-1,j,k+1,2)/4-uy(i+1,j,k-1,2)/4+uy(i+1,j,k+1,2)/4))/(dx*dz)+(C(5,6,i,j,k)*(uy(i-1,j,k-1,2)/4-uy(i-1,j,k+1,2)/4-uy(i+1,j,k-1,2)/4+uy(i+1,j,k+1,2)/4))/(dx*dz)+(C(2,5,i,j,k)*(uy(i,j-1,k-1,2)/4-uy(i,j-1,k+1,2)/4-uy(i,j+1,k-1,2)/4+uy(i,j+1,k+1,2)/4))/(dy*dz)+(C(4,6,i,j,k)*(uy(i,j-1,k-1,2)/4-uy(i,j-1,k+1,2)/4-uy(i,j+1,k-1,2)/4+uy(i,j+1,k+1,2)/4))/(dy*dz)+(C(1,4,i,j,k)*(uz(i-1,j-1,k,2)/4-uz(i-1,j+1,k,2)/4-uz(i+1,j-1,k,2)/4+uz(i+1,j+1,k,2)/4))/(dx*dy)+(C(5,6,i,j,k)*(uz(i-1,j-1,k,2)/4-uz(i-1,j+1,k,2)/4-uz(i+1,j-1,k,2)/4+uz(i+1,j+1,k,2)/4))/(dx*dy)+(C(1,3,i,j,k)*(uz(i-1,j,k-1,2)/4-uz(i-1,j,k+1,2)/4-uz(i+1,j,k-1,2)/4+uz(i+1,j,k+1,2)/4))/(dx*dz)+(C(5,5,i,j,k)*(uz(i-1,j,k-1,2)/4-uz(i-1,j,k+1,2)/4-uz(i+1,j,k-1,2)/4+uz(i+1,j,k+1,2)/4))/(dx*dz)+(C(3,6,i,j,k)*(uz(i,j-1,k-1,2)/4-uz(i,j-1,k+1,2)/4-uz(i,j+1,k-1,2)/4+uz(i,j+1,k+1,2)/4))/(dy*dz)+(C(4,5,i,j,k)*(uz(i,j-1,k-1,2)/4-uz(i,j-1,k+1,2)/4-uz(i,j+1,k-1,2)/4+uz(i,j+1,k+1,2)/4))/(dy*dz))/(rho(i,j,k)*(a(i,j,k)/dt+1/dt^2));
                        
                        uy(i,j,k,3)=((w(2,1,i+1,j,k)-w(2,1,i-1,j,k))/2/dx-Eta(2,6,i,j,k)*((ux(i,j-1,k,1)-2*ux(i,j,k,1)+ux(i,j+1,k,1))/(dt*dy^2)-(ux(i,j-1,k,2)-2*ux(i,j,k,2)+ux(i,j+1,k,2))/(dt*dy^2))-Eta(4,5,i,j,k)*((ux(i,j,k-1,1)-2*ux(i,j,k,1)+ux(i,j,k+1,1))/(dt*dz^2)-(ux(i,j,k-1,2)-2*ux(i,j,k,2)+ux(i,j,k+1,2))/(dt*dz^2))-Eta(6,6,i,j,k)*((uy(i-1,j,k,1)-2*uy(i,j,k,1)+uy(i+1,j,k,1))/(dt*dx^2)-(uy(i-1,j,k,2)-2*uy(i,j,k,2)+uy(i+1,j,k,2))/(dt*dx^2))-Eta(2,2,i,j,k)*((uy(i,j-1,k,1)-2*uy(i,j,k,1)+uy(i,j+1,k,1))/(dt*dy^2)-(uy(i,j-1,k,2)-2*uy(i,j,k,2)+uy(i,j+1,k,2))/(dt*dy^2))-Eta(4,4,i,j,k)*((uy(i,j,k-1,1)-2*uy(i,j,k,1)+uy(i,j,k+1,1))/(dt*dz^2)-(uy(i,j,k-1,2)-2*uy(i,j,k,2)+uy(i,j,k+1,2))/(dt*dz^2))-Eta(5,6,i,j,k)*((uz(i-1,j,k,1)-2*uz(i,j,k,1)+uz(i+1,j,k,1))/(dt*dx^2)-(uz(i-1,j,k,2)-2*uz(i,j,k,2)+uz(i+1,j,k,2))/(dt*dx^2))-Eta(2,4,i,j,k)*((uz(i,j-1,k,1)-2*uz(i,j,k,1)+uz(i,j+1,k,1))/(dt*dy^2)-(uz(i,j-1,k,2)-2*uz(i,j,k,2)+uz(i,j+1,k,2))/(dt*dy^2))-Eta(3,4,i,j,k)*((uz(i,j,k-1,1)-2*uz(i,j,k,1)+uz(i,j,k+1,1))/(dt*dz^2)-(uz(i,j,k-1,2)-2*uz(i,j,k,2)+uz(i,j,k+1,2))/(dt*dz^2))-Eta(1,6,i,j,k)*((ux(i-1,j,k,1)-2*ux(i,j,k,1)+ux(i+1,j,k,1))/(dt*dx^2)-(ux(i-1,j,k,2)-2*ux(i,j,k,2)+ux(i+1,j,k,2))/(dt*dx^2))+(w(2,2,i,j+1,k)-w(2,2,i,j-1,k))/2/dy+(w(2,3,i,j+1,k)-w(2,3,i,j-1,k))/2/dz-rho(i,j,k)*(Uy(i,j,k)*c(i,j,k)+b(i,j,k)*uy(i,j,k,2)+(uy(i,j,k,1)-2*uy(i,j,k,2))/dt^2-(a(i,j,k)*uy(i,j,k,2))/dt)-Eta(1,2,i,j,k)*((ux(i-1,j-1,k,1)/4-ux(i-1,j+1,k,1)/4-ux(i+1,j-1,k,1)/4+ux(i+1,j+1,k,1)/4)/(dt*dx*dy)-(ux(i-1,j-1,k,2)/4-ux(i-1,j+1,k,2)/4-ux(i+1,j-1,k,2)/4+ux(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(6,6,i,j,k)*((ux(i-1,j-1,k,1)/4-ux(i-1,j+1,k,1)/4-ux(i+1,j-1,k,1)/4+ux(i+1,j+1,k,1)/4)/(dt*dx*dy)-(ux(i-1,j-1,k,2)/4-ux(i-1,j+1,k,2)/4-ux(i+1,j-1,k,2)/4+ux(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(1,4,i,j,k)*((ux(i-1,j,k-1,1)/4-ux(i-1,j,k+1,1)/4-ux(i+1,j,k-1,1)/4+ux(i+1,j,k+1,1)/4)/(dt*dx*dz)-(ux(i-1,j,k-1,2)/4-ux(i-1,j,k+1,2)/4-ux(i+1,j,k-1,2)/4+ux(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(5,6,i,j,k)*((ux(i-1,j,k-1,1)/4-ux(i-1,j,k+1,1)/4-ux(i+1,j,k-1,1)/4+ux(i+1,j,k+1,1)/4)/(dt*dx*dz)-(ux(i-1,j,k-1,2)/4-ux(i-1,j,k+1,2)/4-ux(i+1,j,k-1,2)/4+ux(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(2,5,i,j,k)*((ux(i,j-1,k-1,1)/4-ux(i,j-1,k+1,1)/4-ux(i,j+1,k-1,1)/4+ux(i,j+1,k+1,1)/4)/(dt*dy*dz)-(ux(i,j-1,k-1,2)/4-ux(i,j-1,k+1,2)/4-ux(i,j+1,k-1,2)/4+ux(i,j+1,k+1,2)/4)/(dt*dy*dz))-Eta(4,6,i,j,k)*((ux(i,j-1,k-1,1)/4-ux(i,j-1,k+1,1)/4-ux(i,j+1,k-1,1)/4+ux(i,j+1,k+1,1)/4)/(dt*dy*dz)-(ux(i,j-1,k-1,2)/4-ux(i,j-1,k+1,2)/4-ux(i,j+1,k-1,2)/4+ux(i,j+1,k+1,2)/4)/(dt*dy*dz))-2*Eta(2,6,i,j,k)*((uy(i-1,j-1,k,1)/4-uy(i-1,j+1,k,1)/4-uy(i+1,j-1,k,1)/4+uy(i+1,j+1,k,1)/4)/(dt*dx*dy)-(uy(i-1,j-1,k,2)/4-uy(i-1,j+1,k,2)/4-uy(i+1,j-1,k,2)/4+uy(i+1,j+1,k,2)/4)/(dt*dx*dy))-2*Eta(4,6,i,j,k)*((uy(i-1,j,k-1,1)/4-uy(i-1,j,k+1,1)/4-uy(i+1,j,k-1,1)/4+uy(i+1,j,k+1,1)/4)/(dt*dx*dz)-(uy(i-1,j,k-1,2)/4-uy(i-1,j,k+1,2)/4-uy(i+1,j,k-1,2)/4+uy(i+1,j,k+1,2)/4)/(dt*dx*dz))-2*Eta(2,4,i,j,k)*((uy(i,j-1,k-1,1)/4-uy(i,j-1,k+1,1)/4-uy(i,j+1,k-1,1)/4+uy(i,j+1,k+1,1)/4)/(dt*dy*dz)-(uy(i,j-1,k-1,2)/4-uy(i,j-1,k+1,2)/4-uy(i,j+1,k-1,2)/4+uy(i,j+1,k+1,2)/4)/(dt*dy*dz))-Eta(2,5,i,j,k)*((uz(i-1,j-1,k,1)/4-uz(i-1,j+1,k,1)/4-uz(i+1,j-1,k,1)/4+uz(i+1,j+1,k,1)/4)/(dt*dx*dy)-(uz(i-1,j-1,k,2)/4-uz(i-1,j+1,k,2)/4-uz(i+1,j-1,k,2)/4+uz(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(4,6,i,j,k)*((uz(i-1,j-1,k,1)/4-uz(i-1,j+1,k,1)/4-uz(i+1,j-1,k,1)/4+uz(i+1,j+1,k,1)/4)/(dt*dx*dy)-(uz(i-1,j-1,k,2)/4-uz(i-1,j+1,k,2)/4-uz(i+1,j-1,k,2)/4+uz(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(3,6,i,j,k)*((uz(i-1,j,k-1,1)/4-uz(i-1,j,k+1,1)/4-uz(i+1,j,k-1,1)/4+uz(i+1,j,k+1,1)/4)/(dt*dx*dz)-(uz(i-1,j,k-1,2)/4-uz(i-1,j,k+1,2)/4-uz(i+1,j,k-1,2)/4+uz(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(4,5,i,j,k)*((uz(i-1,j,k-1,1)/4-uz(i-1,j,k+1,1)/4-uz(i+1,j,k-1,1)/4+uz(i+1,j,k+1,1)/4)/(dt*dx*dz)-(uz(i-1,j,k-1,2)/4-uz(i-1,j,k+1,2)/4-uz(i+1,j,k-1,2)/4+uz(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(2,3,i,j,k)*((uz(i,j-1,k-1,1)/4-uz(i,j-1,k+1,1)/4-uz(i,j+1,k-1,1)/4+uz(i,j+1,k+1,1)/4)/(dt*dy*dz)-(uz(i,j-1,k-1,2)/4-uz(i,j-1,k+1,2)/4-uz(i,j+1,k-1,2)/4+uz(i,j+1,k+1,2)/4)/(dt*dy*dz))-Eta(4,4,i,j,k)*((uz(i,j-1,k-1,1)/4-uz(i,j-1,k+1,1)/4-uz(i,j+1,k-1,1)/4+uz(i,j+1,k+1,1)/4)/(dt*dy*dz)-(uz(i,j-1,k-1,2)/4-uz(i,j-1,k+1,2)/4-uz(i,j+1,k-1,2)/4+uz(i,j+1,k+1,2)/4)/(dt*dy*dz))+(C(1,6,i,j,k)*(ux(i-1,j,k,2)-2*ux(i,j,k,2)+ux(i+1,j,k,2)))/dx^2+(C(2,6,i,j,k)*(ux(i,j-1,k,2)-2*ux(i,j,k,2)+ux(i,j+1,k,2)))/dy^2+(C(4,5,i,j,k)*(ux(i,j,k-1,2)-2*ux(i,j,k,2)+ux(i,j,k+1,2)))/dz^2+(C(6,6,i,j,k)*(uy(i-1,j,k,2)-2*uy(i,j,k,2)+uy(i+1,j,k,2)))/dx^2+(C(2,2,i,j,k)*(uy(i,j-1,k,2)-2*uy(i,j,k,2)+uy(i,j+1,k,2)))/dy^2+(C(4,4,i,j,k)*(uy(i,j,k-1,2)-2*uy(i,j,k,2)+uy(i,j,k+1,2)))/dz^2+(C(5,6,i,j,k)*(uz(i-1,j,k,2)-2*uz(i,j,k,2)+uz(i+1,j,k,2)))/dx^2+(C(2,4,i,j,k)*(uz(i,j-1,k,2)-2*uz(i,j,k,2)+uz(i,j+1,k,2)))/dy^2+(C(3,4,i,j,k)*(uz(i,j,k-1,2)-2*uz(i,j,k,2)+uz(i,j,k+1,2)))/dz^2+(C(1,2,i,j,k)*(ux(i-1,j-1,k,2)/4-ux(i-1,j+1,k,2)/4-ux(i+1,j-1,k,2)/4+ux(i+1,j+1,k,2)/4))/(dx*dy)+(C(6,6,i,j,k)*(ux(i-1,j-1,k,2)/4-ux(i-1,j+1,k,2)/4-ux(i+1,j-1,k,2)/4+ux(i+1,j+1,k,2)/4))/(dx*dy)+(C(1,4,i,j,k)*(ux(i-1,j,k-1,2)/4-ux(i-1,j,k+1,2)/4-ux(i+1,j,k-1,2)/4+ux(i+1,j,k+1,2)/4))/(dx*dz)+(C(5,6,i,j,k)*(ux(i-1,j,k-1,2)/4-ux(i-1,j,k+1,2)/4-ux(i+1,j,k-1,2)/4+ux(i+1,j,k+1,2)/4))/(dx*dz)+(C(2,5,i,j,k)*(ux(i,j-1,k-1,2)/4-ux(i,j-1,k+1,2)/4-ux(i,j+1,k-1,2)/4+ux(i,j+1,k+1,2)/4))/(dy*dz)+(C(4,6,i,j,k)*(ux(i,j-1,k-1,2)/4-ux(i,j-1,k+1,2)/4-ux(i,j+1,k-1,2)/4+ux(i,j+1,k+1,2)/4))/(dy*dz)+(2*C(2,6,i,j,k)*(uy(i-1,j-1,k,2)/4-uy(i-1,j+1,k,2)/4-uy(i+1,j-1,k,2)/4+uy(i+1,j+1,k,2)/4))/(dx*dy)+(2*C(4,6,i,j,k)*(uy(i-1,j,k-1,2)/4-uy(i-1,j,k+1,2)/4-uy(i+1,j,k-1,2)/4+uy(i+1,j,k+1,2)/4))/(dx*dz)+(2*C(2,4,i,j,k)*(uy(i,j-1,k-1,2)/4-uy(i,j-1,k+1,2)/4-uy(i,j+1,k-1,2)/4+uy(i,j+1,k+1,2)/4))/(dy*dz)+(C(2,5,i,j,k)*(uz(i-1,j-1,k,2)/4-uz(i-1,j+1,k,2)/4-uz(i+1,j-1,k,2)/4+uz(i+1,j+1,k,2)/4))/(dx*dy)+(C(4,6,i,j,k)*(uz(i-1,j-1,k,2)/4-uz(i-1,j+1,k,2)/4-uz(i+1,j-1,k,2)/4+uz(i+1,j+1,k,2)/4))/(dx*dy)+(C(3,6,i,j,k)*(uz(i-1,j,k-1,2)/4-uz(i-1,j,k+1,2)/4-uz(i+1,j,k-1,2)/4+uz(i+1,j,k+1,2)/4))/(dx*dz)+(C(4,5,i,j,k)*(uz(i-1,j,k-1,2)/4-uz(i-1,j,k+1,2)/4-uz(i+1,j,k-1,2)/4+uz(i+1,j,k+1,2)/4))/(dx*dz)+(C(2,3,i,j,k)*(uz(i,j-1,k-1,2)/4-uz(i,j-1,k+1,2)/4-uz(i,j+1,k-1,2)/4+uz(i,j+1,k+1,2)/4))/(dy*dz)+(C(4,4,i,j,k)*(uz(i,j-1,k-1,2)/4-uz(i,j-1,k+1,2)/4-uz(i,j+1,k-1,2)/4+uz(i,j+1,k+1,2)/4))/(dy*dz))/(rho(i,j,k)*(a(i,j,k)/dt+1/dt^2));
                        
                        uz(i,j,k,3)=((w(3,1,i+1,j,k)-w(3,1,i-1,j,k))/2/dx-Eta(4,6,i,j,k)*((ux(i,j-1,k,1)-2*ux(i,j,k,1)+ux(i,j+1,k,1))/(dt*dy^2)-(ux(i,j-1,k,2)-2*ux(i,j,k,2)+ux(i,j+1,k,2))/(dt*dy^2))-Eta(3,5,i,j,k)*((ux(i,j,k-1,1)-2*ux(i,j,k,1)+ux(i,j,k+1,1))/(dt*dz^2)-(ux(i,j,k-1,2)-2*ux(i,j,k,2)+ux(i,j,k+1,2))/(dt*dz^2))-Eta(5,6,i,j,k)*((uy(i-1,j,k,1)-2*uy(i,j,k,1)+uy(i+1,j,k,1))/(dt*dx^2)-(uy(i-1,j,k,2)-2*uy(i,j,k,2)+uy(i+1,j,k,2))/(dt*dx^2))-Eta(2,4,i,j,k)*((uy(i,j-1,k,1)-2*uy(i,j,k,1)+uy(i,j+1,k,1))/(dt*dy^2)-(uy(i,j-1,k,2)-2*uy(i,j,k,2)+uy(i,j+1,k,2))/(dt*dy^2))-Eta(3,4,i,j,k)*((uy(i,j,k-1,1)-2*uy(i,j,k,1)+uy(i,j,k+1,1))/(dt*dz^2)-(uy(i,j,k-1,2)-2*uy(i,j,k,2)+uy(i,j,k+1,2))/(dt*dz^2))-Eta(5,5,i,j,k)*((uz(i-1,j,k,1)-2*uz(i,j,k,1)+uz(i+1,j,k,1))/(dt*dx^2)-(uz(i-1,j,k,2)-2*uz(i,j,k,2)+uz(i+1,j,k,2))/(dt*dx^2))-Eta(4,4,i,j,k)*((uz(i,j-1,k,1)-2*uz(i,j,k,1)+uz(i,j+1,k,1))/(dt*dy^2)-(uz(i,j-1,k,2)-2*uz(i,j,k,2)+uz(i,j+1,k,2))/(dt*dy^2))-Eta(3,3,i,j,k)*((uz(i,j,k-1,1)-2*uz(i,j,k,1)+uz(i,j,k+1,1))/(dt*dz^2)-(uz(i,j,k-1,2)-2*uz(i,j,k,2)+uz(i,j,k+1,2))/(dt*dz^2))-Eta(1,5,i,j,k)*((ux(i-1,j,k,1)-2*ux(i,j,k,1)+ux(i+1,j,k,1))/(dt*dx^2)-(ux(i-1,j,k,2)-2*ux(i,j,k,2)+ux(i+1,j,k,2))/(dt*dx^2))+(w(3,2,i,j+1,k)-w(3,2,i,j-1,k))/2/dy+(w(3,3,i,j+1,k)-w(3,3,i,j-1,k))/2/dz-rho(i,j,k)*(Uz(i,j,k)*c(i,j,k)+b(i,j,k)*uz(i,j,k,2)+(uz(i,j,k,1)-2*uz(i,j,k,2))/dt^2-(a(i,j,k)*uz(i,j,k,2))/dt)-Eta(1,4,i,j,k)*((ux(i-1,j-1,k,1)/4-ux(i-1,j+1,k,1)/4-ux(i+1,j-1,k,1)/4+ux(i+1,j+1,k,1)/4)/(dt*dx*dy)-(ux(i-1,j-1,k,2)/4-ux(i-1,j+1,k,2)/4-ux(i+1,j-1,k,2)/4+ux(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(5,6,i,j,k)*((ux(i-1,j-1,k,1)/4-ux(i-1,j+1,k,1)/4-ux(i+1,j-1,k,1)/4+ux(i+1,j+1,k,1)/4)/(dt*dx*dy)-(ux(i-1,j-1,k,2)/4-ux(i-1,j+1,k,2)/4-ux(i+1,j-1,k,2)/4+ux(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(1,3,i,j,k)*((ux(i-1,j,k-1,1)/4-ux(i-1,j,k+1,1)/4-ux(i+1,j,k-1,1)/4+ux(i+1,j,k+1,1)/4)/(dt*dx*dz)-(ux(i-1,j,k-1,2)/4-ux(i-1,j,k+1,2)/4-ux(i+1,j,k-1,2)/4+ux(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(5,5,i,j,k)*((ux(i-1,j,k-1,1)/4-ux(i-1,j,k+1,1)/4-ux(i+1,j,k-1,1)/4+ux(i+1,j,k+1,1)/4)/(dt*dx*dz)-(ux(i-1,j,k-1,2)/4-ux(i-1,j,k+1,2)/4-ux(i+1,j,k-1,2)/4+ux(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(3,6,i,j,k)*((ux(i,j-1,k-1,1)/4-ux(i,j-1,k+1,1)/4-ux(i,j+1,k-1,1)/4+ux(i,j+1,k+1,1)/4)/(dt*dy*dz)-(ux(i,j-1,k-1,2)/4-ux(i,j-1,k+1,2)/4-ux(i,j+1,k-1,2)/4+ux(i,j+1,k+1,2)/4)/(dt*dy*dz))-Eta(4,5,i,j,k)*((ux(i,j-1,k-1,1)/4-ux(i,j-1,k+1,1)/4-ux(i,j+1,k-1,1)/4+ux(i,j+1,k+1,1)/4)/(dt*dy*dz)-(ux(i,j-1,k-1,2)/4-ux(i,j-1,k+1,2)/4-ux(i,j+1,k-1,2)/4+ux(i,j+1,k+1,2)/4)/(dt*dy*dz))-Eta(2,5,i,j,k)*((uy(i-1,j-1,k,1)/4-uy(i-1,j+1,k,1)/4-uy(i+1,j-1,k,1)/4+uy(i+1,j+1,k,1)/4)/(dt*dx*dy)-(uy(i-1,j-1,k,2)/4-uy(i-1,j+1,k,2)/4-uy(i+1,j-1,k,2)/4+uy(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(4,6,i,j,k)*((uy(i-1,j-1,k,1)/4-uy(i-1,j+1,k,1)/4-uy(i+1,j-1,k,1)/4+uy(i+1,j+1,k,1)/4)/(dt*dx*dy)-(uy(i-1,j-1,k,2)/4-uy(i-1,j+1,k,2)/4-uy(i+1,j-1,k,2)/4+uy(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(3,6,i,j,k)*((uy(i-1,j,k-1,1)/4-uy(i-1,j,k+1,1)/4-uy(i+1,j,k-1,1)/4+uy(i+1,j,k+1,1)/4)/(dt*dx*dz)-(uy(i-1,j,k-1,2)/4-uy(i-1,j,k+1,2)/4-uy(i+1,j,k-1,2)/4+uy(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(4,5,i,j,k)*((uy(i-1,j,k-1,1)/4-uy(i-1,j,k+1,1)/4-uy(i+1,j,k-1,1)/4+uy(i+1,j,k+1,1)/4)/(dt*dx*dz)-(uy(i-1,j,k-1,2)/4-uy(i-1,j,k+1,2)/4-uy(i+1,j,k-1,2)/4+uy(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(2,3,i,j,k)*((uy(i,j-1,k-1,1)/4-uy(i,j-1,k+1,1)/4-uy(i,j+1,k-1,1)/4+uy(i,j+1,k+1,1)/4)/(dt*dy*dz)-(uy(i,j-1,k-1,2)/4-uy(i,j-1,k+1,2)/4-uy(i,j+1,k-1,2)/4+uy(i,j+1,k+1,2)/4)/(dt*dy*dz))-Eta(4,4,i,j,k)*((uy(i,j-1,k-1,1)/4-uy(i,j-1,k+1,1)/4-uy(i,j+1,k-1,1)/4+uy(i,j+1,k+1,1)/4)/(dt*dy*dz)-(uy(i,j-1,k-1,2)/4-uy(i,j-1,k+1,2)/4-uy(i,j+1,k-1,2)/4+uy(i,j+1,k+1,2)/4)/(dt*dy*dz))-2*Eta(4,5,i,j,k)*((uz(i-1,j-1,k,1)/4-uz(i-1,j+1,k,1)/4-uz(i+1,j-1,k,1)/4+uz(i+1,j+1,k,1)/4)/(dt*dx*dy)-(uz(i-1,j-1,k,2)/4-uz(i-1,j+1,k,2)/4-uz(i+1,j-1,k,2)/4+uz(i+1,j+1,k,2)/4)/(dt*dx*dy))-2*Eta(3,5,i,j,k)*((uz(i-1,j,k-1,1)/4-uz(i-1,j,k+1,1)/4-uz(i+1,j,k-1,1)/4+uz(i+1,j,k+1,1)/4)/(dt*dx*dz)-(uz(i-1,j,k-1,2)/4-uz(i-1,j,k+1,2)/4-uz(i+1,j,k-1,2)/4+uz(i+1,j,k+1,2)/4)/(dt*dx*dz))-2*Eta(3,4,i,j,k)*((uz(i,j-1,k-1,1)/4-uz(i,j-1,k+1,1)/4-uz(i,j+1,k-1,1)/4+uz(i,j+1,k+1,1)/4)/(dt*dy*dz)-(uz(i,j-1,k-1,2)/4-uz(i,j-1,k+1,2)/4-uz(i,j+1,k-1,2)/4+uz(i,j+1,k+1,2)/4)/(dt*dy*dz))+(C(1,5,i,j,k)*(ux(i-1,j,k,2)-2*ux(i,j,k,2)+ux(i+1,j,k,2)))/dx^2+(C(4,6,i,j,k)*(ux(i,j-1,k,2)-2*ux(i,j,k,2)+ux(i,j+1,k,2)))/dy^2+(C(3,5,i,j,k)*(ux(i,j,k-1,2)-2*ux(i,j,k,2)+ux(i,j,k+1,2)))/dz^2+(C(5,6,i,j,k)*(uy(i-1,j,k,2)-2*uy(i,j,k,2)+uy(i+1,j,k,2)))/dx^2+(C(2,4,i,j,k)*(uy(i,j-1,k,2)-2*uy(i,j,k,2)+uy(i,j+1,k,2)))/dy^2+(C(3,4,i,j,k)*(uy(i,j,k-1,2)-2*uy(i,j,k,2)+uy(i,j,k+1,2)))/dz^2+(C(5,5,i,j,k)*(uz(i-1,j,k,2)-2*uz(i,j,k,2)+uz(i+1,j,k,2)))/dx^2+(C(4,4,i,j,k)*(uz(i,j-1,k,2)-2*uz(i,j,k,2)+uz(i,j+1,k,2)))/dy^2+(C(3,3,i,j,k)*(uz(i,j,k-1,2)-2*uz(i,j,k,2)+uz(i,j,k+1,2)))/dz^2+(C(1,4,i,j,k)*(ux(i-1,j-1,k,2)/4-ux(i-1,j+1,k,2)/4-ux(i+1,j-1,k,2)/4+ux(i+1,j+1,k,2)/4))/(dx*dy)+(C(5,6,i,j,k)*(ux(i-1,j-1,k,2)/4-ux(i-1,j+1,k,2)/4-ux(i+1,j-1,k,2)/4+ux(i+1,j+1,k,2)/4))/(dx*dy)+(C(1,3,i,j,k)*(ux(i-1,j,k-1,2)/4-ux(i-1,j,k+1,2)/4-ux(i+1,j,k-1,2)/4+ux(i+1,j,k+1,2)/4))/(dx*dz)+(C(5,5,i,j,k)*(ux(i-1,j,k-1,2)/4-ux(i-1,j,k+1,2)/4-ux(i+1,j,k-1,2)/4+ux(i+1,j,k+1,2)/4))/(dx*dz)+(C(3,6,i,j,k)*(ux(i,j-1,k-1,2)/4-ux(i,j-1,k+1,2)/4-ux(i,j+1,k-1,2)/4+ux(i,j+1,k+1,2)/4))/(dy*dz)+(C(4,5,i,j,k)*(ux(i,j-1,k-1,2)/4-ux(i,j-1,k+1,2)/4-ux(i,j+1,k-1,2)/4+ux(i,j+1,k+1,2)/4))/(dy*dz)+(C(2,5,i,j,k)*(uy(i-1,j-1,k,2)/4-uy(i-1,j+1,k,2)/4-uy(i+1,j-1,k,2)/4+uy(i+1,j+1,k,2)/4))/(dx*dy)+(C(4,6,i,j,k)*(uy(i-1,j-1,k,2)/4-uy(i-1,j+1,k,2)/4-uy(i+1,j-1,k,2)/4+uy(i+1,j+1,k,2)/4))/(dx*dy)+(C(3,6,i,j,k)*(uy(i-1,j,k-1,2)/4-uy(i-1,j,k+1,2)/4-uy(i+1,j,k-1,2)/4+uy(i+1,j,k+1,2)/4))/(dx*dz)+(C(4,5,i,j,k)*(uy(i-1,j,k-1,2)/4-uy(i-1,j,k+1,2)/4-uy(i+1,j,k-1,2)/4+uy(i+1,j,k+1,2)/4))/(dx*dz)+(C(2,3,i,j,k)*(uy(i,j-1,k-1,2)/4-uy(i,j-1,k+1,2)/4-uy(i,j+1,k-1,2)/4+uy(i,j+1,k+1,2)/4))/(dy*dz)+(C(4,4,i,j,k)*(uy(i,j-1,k-1,2)/4-uy(i,j-1,k+1,2)/4-uy(i,j+1,k-1,2)/4+uy(i,j+1,k+1,2)/4))/(dy*dz)+(2*C(4,5,i,j,k)*(uz(i-1,j-1,k,2)/4-uz(i-1,j+1,k,2)/4-uz(i+1,j-1,k,2)/4+uz(i+1,j+1,k,2)/4))/(dx*dy)+(2*C(3,5,i,j,k)*(uz(i-1,j,k-1,2)/4-uz(i-1,j,k+1,2)/4-uz(i+1,j,k-1,2)/4+uz(i+1,j,k+1,2)/4))/(dx*dz)+(2*C(3,4,i,j,k)*(uz(i,j-1,k-1,2)/4-uz(i,j-1,k+1,2)/4-uz(i,j+1,k-1,2)/4+uz(i,j+1,k+1,2)/4))/(dy*dz))/(rho(i,j,k)*(a(i,j,k)/dt+1/dt^2));
                        
                    end
                end
            end
            %% free surface
            k=1;
            for i=2:nx-1
                for j=2:ny-1
                    Id=id(nx,ny,nz,1,i,j,k,1,i,j,k);
                    % first eq
                    B(Id(1)  )=-((Eta(1,5,i,j,k)*(ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2))/(dt*dx)+(Eta(5,6,i,j,k)*(ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2))/(dt*dy)+(Eta(5,6,i,j,k)*(uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2))/(dt*dx)+(Eta(2,5,i,j,k)*(uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2))/(dt*dy)+(Eta(5,5,i,j,k)*(uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2))/(dt*dx)+(Eta(4,5,i,j,k)*(uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2))/(dt*dy)+(Eta(5,5,i,j,k)*(ux(i,j,k,2)-ux(i,j,k+1,2)))/(dt*dz)+(Eta(4,5,i,j,k)*(uy(i,j,k,2)-uy(i,j,k+1,2)))/(dt*dz)+(Eta(3,5,i,j,k)*(uz(i,j,k,2)-uz(i,j,k+1,2)))/(dt*dz));
                    
                    % second eq
                    B(Id(1)+1)=-((Eta(1,4,i,j,k)*(ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2))/(dt*dx)+(Eta(4,6,i,j,k)*(ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2))/(dt*dy)+(Eta(4,6,i,j,k)*(uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2))/(dt*dx)+(Eta(2,4,i,j,k)*(uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2))/(dt*dy)+(Eta(4,5,i,j,k)*(uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2))/(dt*dx)+(Eta(4,4,i,j,k)*(uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2))/(dt*dy)+(Eta(4,5,i,j,k)*(ux(i,j,k,2)-ux(i,j,k+1,2)))/(dt*dz)+(Eta(4,4,i,j,k)*(uy(i,j,k,2)-uy(i,j,k+1,2)))/(dt*dz)+(Eta(3,4,i,j,k)*(uz(i,j,k,2)-uz(i,j,k+1,2)))/(dt*dz));
                    
                    % third eq
                    B(Id(1)+2)=-((Eta(1,3,i,j,k)*(ux(i-1,j,k,2)/2-ux(i+1,j,k,2)/2))/(dt*dx)+(Eta(3,6,i,j,k)*(ux(i,j-1,k,2)/2-ux(i,j+1,k,2)/2))/(dt*dy)+(Eta(3,6,i,j,k)*(uy(i-1,j,k,2)/2-uy(i+1,j,k,2)/2))/(dt*dx)+(Eta(2,3,i,j,k)*(uy(i,j-1,k,2)/2-uy(i,j+1,k,2)/2))/(dt*dy)+(Eta(3,5,i,j,k)*(uz(i-1,j,k,2)/2-uz(i+1,j,k,2)/2))/(dt*dx)+(Eta(3,4,i,j,k)*(uz(i,j-1,k,2)/2-uz(i,j+1,k,2)/2))/(dt*dy)+(Eta(3,5,i,j,k)*(ux(i,j,k,2)-ux(i,j,k+1,2)))/(dt*dz)+(Eta(3,4,i,j,k)*(uy(i,j,k,2)-uy(i,j,k+1,2)))/(dt*dz)+(Eta(3,3,i,j,k)*(uz(i,j,k,2)-uz(i,j,k+1,2)))/(dt*dz));
                    
                end
            end
            %% second layer in the z direction
            k=2;
            for i=2:nx-1
                for j=2:ny-1
                    
                    Id=id(nx,ny,nz,1,i,j,k,1,i,j,k);
                    
                    B(Id(1)  )=((w(1,1,i+1,j,k)-w(1,1,i-1,j,k))/2/dx-Eta(6,6,i,j,k)*((ux(i,j-1,k,1)-2*ux(i,j,k,1)+ux(i,j+1,k,1))/(dt*dy^2)-(ux(i,j-1,k,2)-2*ux(i,j,k,2)+ux(i,j+1,k,2))/(dt*dy^2))-Eta(5,5,i,j,k)*((ux(i,j,k-1,1)-2*ux(i,j,k,1)+ux(i,j,k+1,1))/(dt*dz^2)-(ux(i,j,k-1,2)-2*ux(i,j,k,2)+ux(i,j,k+1,2))/(dt*dz^2))-Eta(1,6,i,j,k)*((uy(i-1,j,k,1)-2*uy(i,j,k,1)+uy(i+1,j,k,1))/(dt*dx^2)-(uy(i-1,j,k,2)-2*uy(i,j,k,2)+uy(i+1,j,k,2))/(dt*dx^2))-Eta(2,6,i,j,k)*((uy(i,j-1,k,1)-2*uy(i,j,k,1)+uy(i,j+1,k,1))/(dt*dy^2)-(uy(i,j-1,k,2)-2*uy(i,j,k,2)+uy(i,j+1,k,2))/(dt*dy^2))-Eta(4,5,i,j,k)*((uy(i,j,k-1,1)-2*uy(i,j,k,1)+uy(i,j,k+1,1))/(dt*dz^2)-(uy(i,j,k-1,2)-2*uy(i,j,k,2)+uy(i,j,k+1,2))/(dt*dz^2))-Eta(1,5,i,j,k)*((uz(i-1,j,k,1)-2*uz(i,j,k,1)+uz(i+1,j,k,1))/(dt*dx^2)-(uz(i-1,j,k,2)-2*uz(i,j,k,2)+uz(i+1,j,k,2))/(dt*dx^2))-Eta(4,6,i,j,k)*((uz(i,j-1,k,1)-2*uz(i,j,k,1)+uz(i,j+1,k,1))/(dt*dy^2)-(uz(i,j-1,k,2)-2*uz(i,j,k,2)+uz(i,j+1,k,2))/(dt*dy^2))-Eta(3,5,i,j,k)*((uz(i,j,k-1,1)-2*uz(i,j,k,1)+uz(i,j,k+1,1))/(dt*dz^2)-(uz(i,j,k-1,2)-2*uz(i,j,k,2)+uz(i,j,k+1,2))/(dt*dz^2))-Eta(1,1,i,j,k)*((ux(i-1,j,k,1)-2*ux(i,j,k,1)+ux(i+1,j,k,1))/(dt*dx^2)-(ux(i-1,j,k,2)-2*ux(i,j,k,2)+ux(i+1,j,k,2))/(dt*dx^2))+(w(1,2,i,j+1,k)-w(1,2,i,j-1,k))/2/dy+(w(1,3,i,j+1,k)-w(1,3,i,j-1,k))/2/dz-rho(i,j,k)*(Ux(i,j,k)*c(i,j,k)+b(i,j,k)*ux(i,j,k,2)+(ux(i,j,k,1)-2*ux(i,j,k,2))/dt^2-(a(i,j,k)*ux(i,j,k,2))/dt)-2*Eta(1,6,i,j,k)*((ux(i-1,j-1,k,1)/4-ux(i-1,j+1,k,1)/4-ux(i+1,j-1,k,1)/4+ux(i+1,j+1,k,1)/4)/(dt*dx*dy)-(ux(i-1,j-1,k,2)/4-ux(i-1,j+1,k,2)/4-ux(i+1,j-1,k,2)/4+ux(i+1,j+1,k,2)/4)/(dt*dx*dy))-2*Eta(1,5,i,j,k)*((ux(i-1,j,k-1,1)/4-ux(i-1,j,k+1,1)/4-ux(i+1,j,k-1,1)/4+ux(i+1,j,k+1,1)/4)/(dt*dx*dz)-(ux(i-1,j,k-1,2)/4-ux(i-1,j,k+1,2)/4-ux(i+1,j,k-1,2)/4+ux(i+1,j,k+1,2)/4)/(dt*dx*dz))-2*Eta(5,6,i,j,k)*((ux(i,j-1,k-1,1)/4-ux(i,j-1,k+1,1)/4-ux(i,j+1,k-1,1)/4+ux(i,j+1,k+1,1)/4)/(dt*dy*dz)-(ux(i,j-1,k-1,2)/4-ux(i,j-1,k+1,2)/4-ux(i,j+1,k-1,2)/4+ux(i,j+1,k+1,2)/4)/(dt*dy*dz))-Eta(1,2,i,j,k)*((uy(i-1,j-1,k,1)/4-uy(i-1,j+1,k,1)/4-uy(i+1,j-1,k,1)/4+uy(i+1,j+1,k,1)/4)/(dt*dx*dy)-(uy(i-1,j-1,k,2)/4-uy(i-1,j+1,k,2)/4-uy(i+1,j-1,k,2)/4+uy(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(6,6,i,j,k)*((uy(i-1,j-1,k,1)/4-uy(i-1,j+1,k,1)/4-uy(i+1,j-1,k,1)/4+uy(i+1,j+1,k,1)/4)/(dt*dx*dy)-(uy(i-1,j-1,k,2)/4-uy(i-1,j+1,k,2)/4-uy(i+1,j-1,k,2)/4+uy(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(1,4,i,j,k)*((uy(i-1,j,k-1,1)/4-uy(i-1,j,k+1,1)/4-uy(i+1,j,k-1,1)/4+uy(i+1,j,k+1,1)/4)/(dt*dx*dz)-(uy(i-1,j,k-1,2)/4-uy(i-1,j,k+1,2)/4-uy(i+1,j,k-1,2)/4+uy(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(5,6,i,j,k)*((uy(i-1,j,k-1,1)/4-uy(i-1,j,k+1,1)/4-uy(i+1,j,k-1,1)/4+uy(i+1,j,k+1,1)/4)/(dt*dx*dz)-(uy(i-1,j,k-1,2)/4-uy(i-1,j,k+1,2)/4-uy(i+1,j,k-1,2)/4+uy(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(2,5,i,j,k)*((uy(i,j-1,k-1,1)/4-uy(i,j-1,k+1,1)/4-uy(i,j+1,k-1,1)/4+uy(i,j+1,k+1,1)/4)/(dt*dy*dz)-(uy(i,j-1,k-1,2)/4-uy(i,j-1,k+1,2)/4-uy(i,j+1,k-1,2)/4+uy(i,j+1,k+1,2)/4)/(dt*dy*dz))-Eta(4,6,i,j,k)*((uy(i,j-1,k-1,1)/4-uy(i,j-1,k+1,1)/4-uy(i,j+1,k-1,1)/4+uy(i,j+1,k+1,1)/4)/(dt*dy*dz)-(uy(i,j-1,k-1,2)/4-uy(i,j-1,k+1,2)/4-uy(i,j+1,k-1,2)/4+uy(i,j+1,k+1,2)/4)/(dt*dy*dz))-Eta(1,4,i,j,k)*((uz(i-1,j-1,k,1)/4-uz(i-1,j+1,k,1)/4-uz(i+1,j-1,k,1)/4+uz(i+1,j+1,k,1)/4)/(dt*dx*dy)-(uz(i-1,j-1,k,2)/4-uz(i-1,j+1,k,2)/4-uz(i+1,j-1,k,2)/4+uz(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(5,6,i,j,k)*((uz(i-1,j-1,k,1)/4-uz(i-1,j+1,k,1)/4-uz(i+1,j-1,k,1)/4+uz(i+1,j+1,k,1)/4)/(dt*dx*dy)-(uz(i-1,j-1,k,2)/4-uz(i-1,j+1,k,2)/4-uz(i+1,j-1,k,2)/4+uz(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(1,3,i,j,k)*((uz(i-1,j,k-1,1)/4-uz(i-1,j,k+1,1)/4-uz(i+1,j,k-1,1)/4+uz(i+1,j,k+1,1)/4)/(dt*dx*dz)-(uz(i-1,j,k-1,2)/4-uz(i-1,j,k+1,2)/4-uz(i+1,j,k-1,2)/4+uz(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(5,5,i,j,k)*((uz(i-1,j,k-1,1)/4-uz(i-1,j,k+1,1)/4-uz(i+1,j,k-1,1)/4+uz(i+1,j,k+1,1)/4)/(dt*dx*dz)-(uz(i-1,j,k-1,2)/4-uz(i-1,j,k+1,2)/4-uz(i+1,j,k-1,2)/4+uz(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(3,6,i,j,k)*((uz(i,j-1,k-1,1)/4-uz(i,j-1,k+1,1)/4-uz(i,j+1,k-1,1)/4+uz(i,j+1,k+1,1)/4)/(dt*dy*dz)-(uz(i,j-1,k-1,2)/4-uz(i,j-1,k+1,2)/4-uz(i,j+1,k-1,2)/4+uz(i,j+1,k+1,2)/4)/(dt*dy*dz))-Eta(4,5,i,j,k)*((uz(i,j-1,k-1,1)/4-uz(i,j-1,k+1,1)/4-uz(i,j+1,k-1,1)/4+uz(i,j+1,k+1,1)/4)/(dt*dy*dz)-(uz(i,j-1,k-1,2)/4-uz(i,j-1,k+1,2)/4-uz(i,j+1,k-1,2)/4+uz(i,j+1,k+1,2)/4)/(dt*dy*dz))+(C(1,1,i,j,k)*(ux(i-1,j,k,2)-2*ux(i,j,k,2)+ux(i+1,j,k,2)))/dx^2+(C(6,6,i,j,k)*(ux(i,j-1,k,2)-2*ux(i,j,k,2)+ux(i,j+1,k,2)))/dy^2+(C(5,5,i,j,k)*(ux(i,j,k-1,2)-2*ux(i,j,k,2)+ux(i,j,k+1,2)))/dz^2+(C(1,6,i,j,k)*(uy(i-1,j,k,2)-2*uy(i,j,k,2)+uy(i+1,j,k,2)))/dx^2+(C(2,6,i,j,k)*(uy(i,j-1,k,2)-2*uy(i,j,k,2)+uy(i,j+1,k,2)))/dy^2+(C(4,5,i,j,k)*(uy(i,j,k-1,2)-2*uy(i,j,k,2)+uy(i,j,k+1,2)))/dz^2+(C(1,5,i,j,k)*(uz(i-1,j,k,2)-2*uz(i,j,k,2)+uz(i+1,j,k,2)))/dx^2+(C(4,6,i,j,k)*(uz(i,j-1,k,2)-2*uz(i,j,k,2)+uz(i,j+1,k,2)))/dy^2+(C(3,5,i,j,k)*(uz(i,j,k-1,2)-2*uz(i,j,k,2)+uz(i,j,k+1,2)))/dz^2+(2*C(1,6,i,j,k)*(ux(i-1,j-1,k,2)/4-ux(i-1,j+1,k,2)/4-ux(i+1,j-1,k,2)/4+ux(i+1,j+1,k,2)/4))/(dx*dy)+(2*C(1,5,i,j,k)*(ux(i-1,j,k-1,2)/4-ux(i-1,j,k+1,2)/4-ux(i+1,j,k-1,2)/4+ux(i+1,j,k+1,2)/4))/(dx*dz)+(2*C(5,6,i,j,k)*(ux(i,j-1,k-1,2)/4-ux(i,j-1,k+1,2)/4-ux(i,j+1,k-1,2)/4+ux(i,j+1,k+1,2)/4))/(dy*dz)+(C(1,2,i,j,k)*(uy(i-1,j-1,k,2)/4-uy(i-1,j+1,k,2)/4-uy(i+1,j-1,k,2)/4+uy(i+1,j+1,k,2)/4))/(dx*dy)+(C(6,6,i,j,k)*(uy(i-1,j-1,k,2)/4-uy(i-1,j+1,k,2)/4-uy(i+1,j-1,k,2)/4+uy(i+1,j+1,k,2)/4))/(dx*dy)+(C(1,4,i,j,k)*(uy(i-1,j,k-1,2)/4-uy(i-1,j,k+1,2)/4-uy(i+1,j,k-1,2)/4+uy(i+1,j,k+1,2)/4))/(dx*dz)+(C(5,6,i,j,k)*(uy(i-1,j,k-1,2)/4-uy(i-1,j,k+1,2)/4-uy(i+1,j,k-1,2)/4+uy(i+1,j,k+1,2)/4))/(dx*dz)+(C(2,5,i,j,k)*(uy(i,j-1,k-1,2)/4-uy(i,j-1,k+1,2)/4-uy(i,j+1,k-1,2)/4+uy(i,j+1,k+1,2)/4))/(dy*dz)+(C(4,6,i,j,k)*(uy(i,j-1,k-1,2)/4-uy(i,j-1,k+1,2)/4-uy(i,j+1,k-1,2)/4+uy(i,j+1,k+1,2)/4))/(dy*dz)+(C(1,4,i,j,k)*(uz(i-1,j-1,k,2)/4-uz(i-1,j+1,k,2)/4-uz(i+1,j-1,k,2)/4+uz(i+1,j+1,k,2)/4))/(dx*dy)+(C(5,6,i,j,k)*(uz(i-1,j-1,k,2)/4-uz(i-1,j+1,k,2)/4-uz(i+1,j-1,k,2)/4+uz(i+1,j+1,k,2)/4))/(dx*dy)+(C(1,3,i,j,k)*(uz(i-1,j,k-1,2)/4-uz(i-1,j,k+1,2)/4-uz(i+1,j,k-1,2)/4+uz(i+1,j,k+1,2)/4))/(dx*dz)+(C(5,5,i,j,k)*(uz(i-1,j,k-1,2)/4-uz(i-1,j,k+1,2)/4-uz(i+1,j,k-1,2)/4+uz(i+1,j,k+1,2)/4))/(dx*dz)+(C(3,6,i,j,k)*(uz(i,j-1,k-1,2)/4-uz(i,j-1,k+1,2)/4-uz(i,j+1,k-1,2)/4+uz(i,j+1,k+1,2)/4))/(dy*dz)+(C(4,5,i,j,k)*(uz(i,j-1,k-1,2)/4-uz(i,j-1,k+1,2)/4-uz(i,j+1,k-1,2)/4+uz(i,j+1,k+1,2)/4))/(dy*dz))/(rho(i,j,k)*(a(i,j,k)/dt+1/dt^2));
                    
                    B(Id(1)+1)=((w(2,1,i+1,j,k)-w(2,1,i-1,j,k))/2/dx-Eta(2,6,i,j,k)*((ux(i,j-1,k,1)-2*ux(i,j,k,1)+ux(i,j+1,k,1))/(dt*dy^2)-(ux(i,j-1,k,2)-2*ux(i,j,k,2)+ux(i,j+1,k,2))/(dt*dy^2))-Eta(4,5,i,j,k)*((ux(i,j,k-1,1)-2*ux(i,j,k,1)+ux(i,j,k+1,1))/(dt*dz^2)-(ux(i,j,k-1,2)-2*ux(i,j,k,2)+ux(i,j,k+1,2))/(dt*dz^2))-Eta(6,6,i,j,k)*((uy(i-1,j,k,1)-2*uy(i,j,k,1)+uy(i+1,j,k,1))/(dt*dx^2)-(uy(i-1,j,k,2)-2*uy(i,j,k,2)+uy(i+1,j,k,2))/(dt*dx^2))-Eta(2,2,i,j,k)*((uy(i,j-1,k,1)-2*uy(i,j,k,1)+uy(i,j+1,k,1))/(dt*dy^2)-(uy(i,j-1,k,2)-2*uy(i,j,k,2)+uy(i,j+1,k,2))/(dt*dy^2))-Eta(4,4,i,j,k)*((uy(i,j,k-1,1)-2*uy(i,j,k,1)+uy(i,j,k+1,1))/(dt*dz^2)-(uy(i,j,k-1,2)-2*uy(i,j,k,2)+uy(i,j,k+1,2))/(dt*dz^2))-Eta(5,6,i,j,k)*((uz(i-1,j,k,1)-2*uz(i,j,k,1)+uz(i+1,j,k,1))/(dt*dx^2)-(uz(i-1,j,k,2)-2*uz(i,j,k,2)+uz(i+1,j,k,2))/(dt*dx^2))-Eta(2,4,i,j,k)*((uz(i,j-1,k,1)-2*uz(i,j,k,1)+uz(i,j+1,k,1))/(dt*dy^2)-(uz(i,j-1,k,2)-2*uz(i,j,k,2)+uz(i,j+1,k,2))/(dt*dy^2))-Eta(3,4,i,j,k)*((uz(i,j,k-1,1)-2*uz(i,j,k,1)+uz(i,j,k+1,1))/(dt*dz^2)-(uz(i,j,k-1,2)-2*uz(i,j,k,2)+uz(i,j,k+1,2))/(dt*dz^2))-Eta(1,6,i,j,k)*((ux(i-1,j,k,1)-2*ux(i,j,k,1)+ux(i+1,j,k,1))/(dt*dx^2)-(ux(i-1,j,k,2)-2*ux(i,j,k,2)+ux(i+1,j,k,2))/(dt*dx^2))+(w(2,2,i,j+1,k)-w(2,2,i,j-1,k))/2/dy+(w(2,3,i,j+1,k)-w(2,3,i,j-1,k))/2/dz-rho(i,j,k)*(Uy(i,j,k)*c(i,j,k)+b(i,j,k)*uy(i,j,k,2)+(uy(i,j,k,1)-2*uy(i,j,k,2))/dt^2-(a(i,j,k)*uy(i,j,k,2))/dt)-Eta(1,2,i,j,k)*((ux(i-1,j-1,k,1)/4-ux(i-1,j+1,k,1)/4-ux(i+1,j-1,k,1)/4+ux(i+1,j+1,k,1)/4)/(dt*dx*dy)-(ux(i-1,j-1,k,2)/4-ux(i-1,j+1,k,2)/4-ux(i+1,j-1,k,2)/4+ux(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(6,6,i,j,k)*((ux(i-1,j-1,k,1)/4-ux(i-1,j+1,k,1)/4-ux(i+1,j-1,k,1)/4+ux(i+1,j+1,k,1)/4)/(dt*dx*dy)-(ux(i-1,j-1,k,2)/4-ux(i-1,j+1,k,2)/4-ux(i+1,j-1,k,2)/4+ux(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(1,4,i,j,k)*((ux(i-1,j,k-1,1)/4-ux(i-1,j,k+1,1)/4-ux(i+1,j,k-1,1)/4+ux(i+1,j,k+1,1)/4)/(dt*dx*dz)-(ux(i-1,j,k-1,2)/4-ux(i-1,j,k+1,2)/4-ux(i+1,j,k-1,2)/4+ux(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(5,6,i,j,k)*((ux(i-1,j,k-1,1)/4-ux(i-1,j,k+1,1)/4-ux(i+1,j,k-1,1)/4+ux(i+1,j,k+1,1)/4)/(dt*dx*dz)-(ux(i-1,j,k-1,2)/4-ux(i-1,j,k+1,2)/4-ux(i+1,j,k-1,2)/4+ux(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(2,5,i,j,k)*((ux(i,j-1,k-1,1)/4-ux(i,j-1,k+1,1)/4-ux(i,j+1,k-1,1)/4+ux(i,j+1,k+1,1)/4)/(dt*dy*dz)-(ux(i,j-1,k-1,2)/4-ux(i,j-1,k+1,2)/4-ux(i,j+1,k-1,2)/4+ux(i,j+1,k+1,2)/4)/(dt*dy*dz))-Eta(4,6,i,j,k)*((ux(i,j-1,k-1,1)/4-ux(i,j-1,k+1,1)/4-ux(i,j+1,k-1,1)/4+ux(i,j+1,k+1,1)/4)/(dt*dy*dz)-(ux(i,j-1,k-1,2)/4-ux(i,j-1,k+1,2)/4-ux(i,j+1,k-1,2)/4+ux(i,j+1,k+1,2)/4)/(dt*dy*dz))-2*Eta(2,6,i,j,k)*((uy(i-1,j-1,k,1)/4-uy(i-1,j+1,k,1)/4-uy(i+1,j-1,k,1)/4+uy(i+1,j+1,k,1)/4)/(dt*dx*dy)-(uy(i-1,j-1,k,2)/4-uy(i-1,j+1,k,2)/4-uy(i+1,j-1,k,2)/4+uy(i+1,j+1,k,2)/4)/(dt*dx*dy))-2*Eta(4,6,i,j,k)*((uy(i-1,j,k-1,1)/4-uy(i-1,j,k+1,1)/4-uy(i+1,j,k-1,1)/4+uy(i+1,j,k+1,1)/4)/(dt*dx*dz)-(uy(i-1,j,k-1,2)/4-uy(i-1,j,k+1,2)/4-uy(i+1,j,k-1,2)/4+uy(i+1,j,k+1,2)/4)/(dt*dx*dz))-2*Eta(2,4,i,j,k)*((uy(i,j-1,k-1,1)/4-uy(i,j-1,k+1,1)/4-uy(i,j+1,k-1,1)/4+uy(i,j+1,k+1,1)/4)/(dt*dy*dz)-(uy(i,j-1,k-1,2)/4-uy(i,j-1,k+1,2)/4-uy(i,j+1,k-1,2)/4+uy(i,j+1,k+1,2)/4)/(dt*dy*dz))-Eta(2,5,i,j,k)*((uz(i-1,j-1,k,1)/4-uz(i-1,j+1,k,1)/4-uz(i+1,j-1,k,1)/4+uz(i+1,j+1,k,1)/4)/(dt*dx*dy)-(uz(i-1,j-1,k,2)/4-uz(i-1,j+1,k,2)/4-uz(i+1,j-1,k,2)/4+uz(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(4,6,i,j,k)*((uz(i-1,j-1,k,1)/4-uz(i-1,j+1,k,1)/4-uz(i+1,j-1,k,1)/4+uz(i+1,j+1,k,1)/4)/(dt*dx*dy)-(uz(i-1,j-1,k,2)/4-uz(i-1,j+1,k,2)/4-uz(i+1,j-1,k,2)/4+uz(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(3,6,i,j,k)*((uz(i-1,j,k-1,1)/4-uz(i-1,j,k+1,1)/4-uz(i+1,j,k-1,1)/4+uz(i+1,j,k+1,1)/4)/(dt*dx*dz)-(uz(i-1,j,k-1,2)/4-uz(i-1,j,k+1,2)/4-uz(i+1,j,k-1,2)/4+uz(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(4,5,i,j,k)*((uz(i-1,j,k-1,1)/4-uz(i-1,j,k+1,1)/4-uz(i+1,j,k-1,1)/4+uz(i+1,j,k+1,1)/4)/(dt*dx*dz)-(uz(i-1,j,k-1,2)/4-uz(i-1,j,k+1,2)/4-uz(i+1,j,k-1,2)/4+uz(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(2,3,i,j,k)*((uz(i,j-1,k-1,1)/4-uz(i,j-1,k+1,1)/4-uz(i,j+1,k-1,1)/4+uz(i,j+1,k+1,1)/4)/(dt*dy*dz)-(uz(i,j-1,k-1,2)/4-uz(i,j-1,k+1,2)/4-uz(i,j+1,k-1,2)/4+uz(i,j+1,k+1,2)/4)/(dt*dy*dz))-Eta(4,4,i,j,k)*((uz(i,j-1,k-1,1)/4-uz(i,j-1,k+1,1)/4-uz(i,j+1,k-1,1)/4+uz(i,j+1,k+1,1)/4)/(dt*dy*dz)-(uz(i,j-1,k-1,2)/4-uz(i,j-1,k+1,2)/4-uz(i,j+1,k-1,2)/4+uz(i,j+1,k+1,2)/4)/(dt*dy*dz))+(C(1,6,i,j,k)*(ux(i-1,j,k,2)-2*ux(i,j,k,2)+ux(i+1,j,k,2)))/dx^2+(C(2,6,i,j,k)*(ux(i,j-1,k,2)-2*ux(i,j,k,2)+ux(i,j+1,k,2)))/dy^2+(C(4,5,i,j,k)*(ux(i,j,k-1,2)-2*ux(i,j,k,2)+ux(i,j,k+1,2)))/dz^2+(C(6,6,i,j,k)*(uy(i-1,j,k,2)-2*uy(i,j,k,2)+uy(i+1,j,k,2)))/dx^2+(C(2,2,i,j,k)*(uy(i,j-1,k,2)-2*uy(i,j,k,2)+uy(i,j+1,k,2)))/dy^2+(C(4,4,i,j,k)*(uy(i,j,k-1,2)-2*uy(i,j,k,2)+uy(i,j,k+1,2)))/dz^2+(C(5,6,i,j,k)*(uz(i-1,j,k,2)-2*uz(i,j,k,2)+uz(i+1,j,k,2)))/dx^2+(C(2,4,i,j,k)*(uz(i,j-1,k,2)-2*uz(i,j,k,2)+uz(i,j+1,k,2)))/dy^2+(C(3,4,i,j,k)*(uz(i,j,k-1,2)-2*uz(i,j,k,2)+uz(i,j,k+1,2)))/dz^2+(C(1,2,i,j,k)*(ux(i-1,j-1,k,2)/4-ux(i-1,j+1,k,2)/4-ux(i+1,j-1,k,2)/4+ux(i+1,j+1,k,2)/4))/(dx*dy)+(C(6,6,i,j,k)*(ux(i-1,j-1,k,2)/4-ux(i-1,j+1,k,2)/4-ux(i+1,j-1,k,2)/4+ux(i+1,j+1,k,2)/4))/(dx*dy)+(C(1,4,i,j,k)*(ux(i-1,j,k-1,2)/4-ux(i-1,j,k+1,2)/4-ux(i+1,j,k-1,2)/4+ux(i+1,j,k+1,2)/4))/(dx*dz)+(C(5,6,i,j,k)*(ux(i-1,j,k-1,2)/4-ux(i-1,j,k+1,2)/4-ux(i+1,j,k-1,2)/4+ux(i+1,j,k+1,2)/4))/(dx*dz)+(C(2,5,i,j,k)*(ux(i,j-1,k-1,2)/4-ux(i,j-1,k+1,2)/4-ux(i,j+1,k-1,2)/4+ux(i,j+1,k+1,2)/4))/(dy*dz)+(C(4,6,i,j,k)*(ux(i,j-1,k-1,2)/4-ux(i,j-1,k+1,2)/4-ux(i,j+1,k-1,2)/4+ux(i,j+1,k+1,2)/4))/(dy*dz)+(2*C(2,6,i,j,k)*(uy(i-1,j-1,k,2)/4-uy(i-1,j+1,k,2)/4-uy(i+1,j-1,k,2)/4+uy(i+1,j+1,k,2)/4))/(dx*dy)+(2*C(4,6,i,j,k)*(uy(i-1,j,k-1,2)/4-uy(i-1,j,k+1,2)/4-uy(i+1,j,k-1,2)/4+uy(i+1,j,k+1,2)/4))/(dx*dz)+(2*C(2,4,i,j,k)*(uy(i,j-1,k-1,2)/4-uy(i,j-1,k+1,2)/4-uy(i,j+1,k-1,2)/4+uy(i,j+1,k+1,2)/4))/(dy*dz)+(C(2,5,i,j,k)*(uz(i-1,j-1,k,2)/4-uz(i-1,j+1,k,2)/4-uz(i+1,j-1,k,2)/4+uz(i+1,j+1,k,2)/4))/(dx*dy)+(C(4,6,i,j,k)*(uz(i-1,j-1,k,2)/4-uz(i-1,j+1,k,2)/4-uz(i+1,j-1,k,2)/4+uz(i+1,j+1,k,2)/4))/(dx*dy)+(C(3,6,i,j,k)*(uz(i-1,j,k-1,2)/4-uz(i-1,j,k+1,2)/4-uz(i+1,j,k-1,2)/4+uz(i+1,j,k+1,2)/4))/(dx*dz)+(C(4,5,i,j,k)*(uz(i-1,j,k-1,2)/4-uz(i-1,j,k+1,2)/4-uz(i+1,j,k-1,2)/4+uz(i+1,j,k+1,2)/4))/(dx*dz)+(C(2,3,i,j,k)*(uz(i,j-1,k-1,2)/4-uz(i,j-1,k+1,2)/4-uz(i,j+1,k-1,2)/4+uz(i,j+1,k+1,2)/4))/(dy*dz)+(C(4,4,i,j,k)*(uz(i,j-1,k-1,2)/4-uz(i,j-1,k+1,2)/4-uz(i,j+1,k-1,2)/4+uz(i,j+1,k+1,2)/4))/(dy*dz))/(rho(i,j,k)*(a(i,j,k)/dt+1/dt^2));
                    
                    B(Id(1)+2)=((w(3,1,i+1,j,k)-w(3,1,i-1,j,k))/2/dx-Eta(4,6,i,j,k)*((ux(i,j-1,k,1)-2*ux(i,j,k,1)+ux(i,j+1,k,1))/(dt*dy^2)-(ux(i,j-1,k,2)-2*ux(i,j,k,2)+ux(i,j+1,k,2))/(dt*dy^2))-Eta(3,5,i,j,k)*((ux(i,j,k-1,1)-2*ux(i,j,k,1)+ux(i,j,k+1,1))/(dt*dz^2)-(ux(i,j,k-1,2)-2*ux(i,j,k,2)+ux(i,j,k+1,2))/(dt*dz^2))-Eta(5,6,i,j,k)*((uy(i-1,j,k,1)-2*uy(i,j,k,1)+uy(i+1,j,k,1))/(dt*dx^2)-(uy(i-1,j,k,2)-2*uy(i,j,k,2)+uy(i+1,j,k,2))/(dt*dx^2))-Eta(2,4,i,j,k)*((uy(i,j-1,k,1)-2*uy(i,j,k,1)+uy(i,j+1,k,1))/(dt*dy^2)-(uy(i,j-1,k,2)-2*uy(i,j,k,2)+uy(i,j+1,k,2))/(dt*dy^2))-Eta(3,4,i,j,k)*((uy(i,j,k-1,1)-2*uy(i,j,k,1)+uy(i,j,k+1,1))/(dt*dz^2)-(uy(i,j,k-1,2)-2*uy(i,j,k,2)+uy(i,j,k+1,2))/(dt*dz^2))-Eta(5,5,i,j,k)*((uz(i-1,j,k,1)-2*uz(i,j,k,1)+uz(i+1,j,k,1))/(dt*dx^2)-(uz(i-1,j,k,2)-2*uz(i,j,k,2)+uz(i+1,j,k,2))/(dt*dx^2))-Eta(4,4,i,j,k)*((uz(i,j-1,k,1)-2*uz(i,j,k,1)+uz(i,j+1,k,1))/(dt*dy^2)-(uz(i,j-1,k,2)-2*uz(i,j,k,2)+uz(i,j+1,k,2))/(dt*dy^2))-Eta(3,3,i,j,k)*((uz(i,j,k-1,1)-2*uz(i,j,k,1)+uz(i,j,k+1,1))/(dt*dz^2)-(uz(i,j,k-1,2)-2*uz(i,j,k,2)+uz(i,j,k+1,2))/(dt*dz^2))-Eta(1,5,i,j,k)*((ux(i-1,j,k,1)-2*ux(i,j,k,1)+ux(i+1,j,k,1))/(dt*dx^2)-(ux(i-1,j,k,2)-2*ux(i,j,k,2)+ux(i+1,j,k,2))/(dt*dx^2))+(w(3,2,i,j+1,k)-w(3,2,i,j-1,k))/2/dy+(w(3,3,i,j+1,k)-w(3,3,i,j-1,k))/2/dz-rho(i,j,k)*(Uz(i,j,k)*c(i,j,k)+b(i,j,k)*uz(i,j,k,2)+(uz(i,j,k,1)-2*uz(i,j,k,2))/dt^2-(a(i,j,k)*uz(i,j,k,2))/dt)-Eta(1,4,i,j,k)*((ux(i-1,j-1,k,1)/4-ux(i-1,j+1,k,1)/4-ux(i+1,j-1,k,1)/4+ux(i+1,j+1,k,1)/4)/(dt*dx*dy)-(ux(i-1,j-1,k,2)/4-ux(i-1,j+1,k,2)/4-ux(i+1,j-1,k,2)/4+ux(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(5,6,i,j,k)*((ux(i-1,j-1,k,1)/4-ux(i-1,j+1,k,1)/4-ux(i+1,j-1,k,1)/4+ux(i+1,j+1,k,1)/4)/(dt*dx*dy)-(ux(i-1,j-1,k,2)/4-ux(i-1,j+1,k,2)/4-ux(i+1,j-1,k,2)/4+ux(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(1,3,i,j,k)*((ux(i-1,j,k-1,1)/4-ux(i-1,j,k+1,1)/4-ux(i+1,j,k-1,1)/4+ux(i+1,j,k+1,1)/4)/(dt*dx*dz)-(ux(i-1,j,k-1,2)/4-ux(i-1,j,k+1,2)/4-ux(i+1,j,k-1,2)/4+ux(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(5,5,i,j,k)*((ux(i-1,j,k-1,1)/4-ux(i-1,j,k+1,1)/4-ux(i+1,j,k-1,1)/4+ux(i+1,j,k+1,1)/4)/(dt*dx*dz)-(ux(i-1,j,k-1,2)/4-ux(i-1,j,k+1,2)/4-ux(i+1,j,k-1,2)/4+ux(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(3,6,i,j,k)*((ux(i,j-1,k-1,1)/4-ux(i,j-1,k+1,1)/4-ux(i,j+1,k-1,1)/4+ux(i,j+1,k+1,1)/4)/(dt*dy*dz)-(ux(i,j-1,k-1,2)/4-ux(i,j-1,k+1,2)/4-ux(i,j+1,k-1,2)/4+ux(i,j+1,k+1,2)/4)/(dt*dy*dz))-Eta(4,5,i,j,k)*((ux(i,j-1,k-1,1)/4-ux(i,j-1,k+1,1)/4-ux(i,j+1,k-1,1)/4+ux(i,j+1,k+1,1)/4)/(dt*dy*dz)-(ux(i,j-1,k-1,2)/4-ux(i,j-1,k+1,2)/4-ux(i,j+1,k-1,2)/4+ux(i,j+1,k+1,2)/4)/(dt*dy*dz))-Eta(2,5,i,j,k)*((uy(i-1,j-1,k,1)/4-uy(i-1,j+1,k,1)/4-uy(i+1,j-1,k,1)/4+uy(i+1,j+1,k,1)/4)/(dt*dx*dy)-(uy(i-1,j-1,k,2)/4-uy(i-1,j+1,k,2)/4-uy(i+1,j-1,k,2)/4+uy(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(4,6,i,j,k)*((uy(i-1,j-1,k,1)/4-uy(i-1,j+1,k,1)/4-uy(i+1,j-1,k,1)/4+uy(i+1,j+1,k,1)/4)/(dt*dx*dy)-(uy(i-1,j-1,k,2)/4-uy(i-1,j+1,k,2)/4-uy(i+1,j-1,k,2)/4+uy(i+1,j+1,k,2)/4)/(dt*dx*dy))-Eta(3,6,i,j,k)*((uy(i-1,j,k-1,1)/4-uy(i-1,j,k+1,1)/4-uy(i+1,j,k-1,1)/4+uy(i+1,j,k+1,1)/4)/(dt*dx*dz)-(uy(i-1,j,k-1,2)/4-uy(i-1,j,k+1,2)/4-uy(i+1,j,k-1,2)/4+uy(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(4,5,i,j,k)*((uy(i-1,j,k-1,1)/4-uy(i-1,j,k+1,1)/4-uy(i+1,j,k-1,1)/4+uy(i+1,j,k+1,1)/4)/(dt*dx*dz)-(uy(i-1,j,k-1,2)/4-uy(i-1,j,k+1,2)/4-uy(i+1,j,k-1,2)/4+uy(i+1,j,k+1,2)/4)/(dt*dx*dz))-Eta(2,3,i,j,k)*((uy(i,j-1,k-1,1)/4-uy(i,j-1,k+1,1)/4-uy(i,j+1,k-1,1)/4+uy(i,j+1,k+1,1)/4)/(dt*dy*dz)-(uy(i,j-1,k-1,2)/4-uy(i,j-1,k+1,2)/4-uy(i,j+1,k-1,2)/4+uy(i,j+1,k+1,2)/4)/(dt*dy*dz))-Eta(4,4,i,j,k)*((uy(i,j-1,k-1,1)/4-uy(i,j-1,k+1,1)/4-uy(i,j+1,k-1,1)/4+uy(i,j+1,k+1,1)/4)/(dt*dy*dz)-(uy(i,j-1,k-1,2)/4-uy(i,j-1,k+1,2)/4-uy(i,j+1,k-1,2)/4+uy(i,j+1,k+1,2)/4)/(dt*dy*dz))-2*Eta(4,5,i,j,k)*((uz(i-1,j-1,k,1)/4-uz(i-1,j+1,k,1)/4-uz(i+1,j-1,k,1)/4+uz(i+1,j+1,k,1)/4)/(dt*dx*dy)-(uz(i-1,j-1,k,2)/4-uz(i-1,j+1,k,2)/4-uz(i+1,j-1,k,2)/4+uz(i+1,j+1,k,2)/4)/(dt*dx*dy))-2*Eta(3,5,i,j,k)*((uz(i-1,j,k-1,1)/4-uz(i-1,j,k+1,1)/4-uz(i+1,j,k-1,1)/4+uz(i+1,j,k+1,1)/4)/(dt*dx*dz)-(uz(i-1,j,k-1,2)/4-uz(i-1,j,k+1,2)/4-uz(i+1,j,k-1,2)/4+uz(i+1,j,k+1,2)/4)/(dt*dx*dz))-2*Eta(3,4,i,j,k)*((uz(i,j-1,k-1,1)/4-uz(i,j-1,k+1,1)/4-uz(i,j+1,k-1,1)/4+uz(i,j+1,k+1,1)/4)/(dt*dy*dz)-(uz(i,j-1,k-1,2)/4-uz(i,j-1,k+1,2)/4-uz(i,j+1,k-1,2)/4+uz(i,j+1,k+1,2)/4)/(dt*dy*dz))+(C(1,5,i,j,k)*(ux(i-1,j,k,2)-2*ux(i,j,k,2)+ux(i+1,j,k,2)))/dx^2+(C(4,6,i,j,k)*(ux(i,j-1,k,2)-2*ux(i,j,k,2)+ux(i,j+1,k,2)))/dy^2+(C(3,5,i,j,k)*(ux(i,j,k-1,2)-2*ux(i,j,k,2)+ux(i,j,k+1,2)))/dz^2+(C(5,6,i,j,k)*(uy(i-1,j,k,2)-2*uy(i,j,k,2)+uy(i+1,j,k,2)))/dx^2+(C(2,4,i,j,k)*(uy(i,j-1,k,2)-2*uy(i,j,k,2)+uy(i,j+1,k,2)))/dy^2+(C(3,4,i,j,k)*(uy(i,j,k-1,2)-2*uy(i,j,k,2)+uy(i,j,k+1,2)))/dz^2+(C(5,5,i,j,k)*(uz(i-1,j,k,2)-2*uz(i,j,k,2)+uz(i+1,j,k,2)))/dx^2+(C(4,4,i,j,k)*(uz(i,j-1,k,2)-2*uz(i,j,k,2)+uz(i,j+1,k,2)))/dy^2+(C(3,3,i,j,k)*(uz(i,j,k-1,2)-2*uz(i,j,k,2)+uz(i,j,k+1,2)))/dz^2+(C(1,4,i,j,k)*(ux(i-1,j-1,k,2)/4-ux(i-1,j+1,k,2)/4-ux(i+1,j-1,k,2)/4+ux(i+1,j+1,k,2)/4))/(dx*dy)+(C(5,6,i,j,k)*(ux(i-1,j-1,k,2)/4-ux(i-1,j+1,k,2)/4-ux(i+1,j-1,k,2)/4+ux(i+1,j+1,k,2)/4))/(dx*dy)+(C(1,3,i,j,k)*(ux(i-1,j,k-1,2)/4-ux(i-1,j,k+1,2)/4-ux(i+1,j,k-1,2)/4+ux(i+1,j,k+1,2)/4))/(dx*dz)+(C(5,5,i,j,k)*(ux(i-1,j,k-1,2)/4-ux(i-1,j,k+1,2)/4-ux(i+1,j,k-1,2)/4+ux(i+1,j,k+1,2)/4))/(dx*dz)+(C(3,6,i,j,k)*(ux(i,j-1,k-1,2)/4-ux(i,j-1,k+1,2)/4-ux(i,j+1,k-1,2)/4+ux(i,j+1,k+1,2)/4))/(dy*dz)+(C(4,5,i,j,k)*(ux(i,j-1,k-1,2)/4-ux(i,j-1,k+1,2)/4-ux(i,j+1,k-1,2)/4+ux(i,j+1,k+1,2)/4))/(dy*dz)+(C(2,5,i,j,k)*(uy(i-1,j-1,k,2)/4-uy(i-1,j+1,k,2)/4-uy(i+1,j-1,k,2)/4+uy(i+1,j+1,k,2)/4))/(dx*dy)+(C(4,6,i,j,k)*(uy(i-1,j-1,k,2)/4-uy(i-1,j+1,k,2)/4-uy(i+1,j-1,k,2)/4+uy(i+1,j+1,k,2)/4))/(dx*dy)+(C(3,6,i,j,k)*(uy(i-1,j,k-1,2)/4-uy(i-1,j,k+1,2)/4-uy(i+1,j,k-1,2)/4+uy(i+1,j,k+1,2)/4))/(dx*dz)+(C(4,5,i,j,k)*(uy(i-1,j,k-1,2)/4-uy(i-1,j,k+1,2)/4-uy(i+1,j,k-1,2)/4+uy(i+1,j,k+1,2)/4))/(dx*dz)+(C(2,3,i,j,k)*(uy(i,j-1,k-1,2)/4-uy(i,j-1,k+1,2)/4-uy(i,j+1,k-1,2)/4+uy(i,j+1,k+1,2)/4))/(dy*dz)+(C(4,4,i,j,k)*(uy(i,j-1,k-1,2)/4-uy(i,j-1,k+1,2)/4-uy(i,j+1,k-1,2)/4+uy(i,j+1,k+1,2)/4))/(dy*dz)+(2*C(4,5,i,j,k)*(uz(i-1,j-1,k,2)/4-uz(i-1,j+1,k,2)/4-uz(i+1,j-1,k,2)/4+uz(i+1,j+1,k,2)/4))/(dx*dy)+(2*C(3,5,i,j,k)*(uz(i-1,j,k-1,2)/4-uz(i-1,j,k+1,2)/4-uz(i+1,j,k-1,2)/4+uz(i+1,j,k+1,2)/4))/(dx*dz)+(2*C(3,4,i,j,k)*(uz(i,j-1,k-1,2)/4-uz(i,j-1,k+1,2)/4-uz(i,j+1,k-1,2)/4+uz(i,j+1,k+1,2)/4))/(dy*dz))/(rho(i,j,k)*(a(i,j,k)/dt+1/dt^2));
                    
                end
            end
            %%
            Sx=zeros(nx,ny,nz);
            Sy=Sx;
            Sz=Sx;
            
            for m=1:Ns
                Sx(sx(m),sy(m),sz(m))=srcx(l,m);
                Sy(sx(m),sy(m),sz(m))=srcy(l,m);
                Sz(sx(m),sy(m),sz(m))=srcz(l,m);
                
                for k=sz(m)-1:sz(m)+1
                    if k<=2
                        for i=sx(m)-1:sx(m)+1
                            for j=sy(m)-1:sy(m)+1
                                Id=id(nx,ny,nz,1,i,j,k,1,i,j,k);
                                B(Id(2)  )=B(Id(2)  )+dt^2/rho(i,j,k)*((Sz(i,j+1,k)-Sz(i,j-1,k))/2/dy-(Sy(i,j,k+1)-Sy(i,j,k-1))/2/dz);
                                B(Id(2)+1)=B(Id(2)+1)+dt^2/rho(i,j,k)*((Sx(i,j,k+1)-Sx(i,j,k-1))/2/dz-(Sz(i+1,j,k)-Sz(i-1,j,k))/2/dx);
                                B(Id(2)+2)=B(Id(2)+2)+dt^2/rho(i,j,k)*((Sy(i+1,j,k)-Sy(i-1,j,k))/2/dx-(Sx(i,j+1,k)-Sx(i,j-1,k))/2/dy);
                            end
                        end
                    else
                        for i=sx(m)-1:sx(m)+1
                            for j=sy(m)-1:sy(m)+1
                                ux(i,j,k,3)=ux(i,j,k,3)+dt^2/rho(i,j,k)*((Sz(i,j+1,k)-Sz(i,j-1,k))/2/dy-(Sy(i,j,k+1)-Sy(i,j,k-1))/2/dz);
                                uy(i,j,k,3)=uy(i,j,k,3)+dt^2/rho(i,j,k)*((Sx(i,j,k+1)-Sx(i,j,k-1))/2/dz-(Sz(i+1,j,k)-Sz(i-1,j,k))/2/dx);
                                uz(i,j,k,3)=uz(i,j,k,3)+dt^2/rho(i,j,k)*((Sy(i+1,j,k)-Sy(i-1,j,k))/2/dx-(Sx(i,j+1,k)-Sx(i,j-1,k))/2/dy);
                            end
                        end
                    end
                end
            end
            %% solve u
            % u2=AA\B;
            u2=gmres(AA,B,[],tol,[],[],[],u2);
            ux(:,:,1:2,l+1)=reshape(u2(1:3:nx*ny*3*2),[nx,ny,2]);
            uy(:,:,1:2,l+1)=reshape(u2(2:3:nx*ny*3*2),[nx,ny,2]);
            uz(:,:,1:2,l+1)=reshape(u2(3:3:nx*ny*3*2),[nx,ny,2]);
            %% save part of huge wavefield
            for lr=1:Nr
                Rx(l+1,lr)=ux(rx(lr),ry(lr),rz(lr),3);
                Ry(l+1,lr)=uy(rx(lr),ry(lr),rz(lr),3);
                Rz(l+1,lr)=uz(rx(lr),ry(lr),rz(lr),3);
            end
            
            if ismember(l+1,rt)
                Rl=find(rt==l+1);
                Rux(:,:,:,Rl)=ux(:,:,:,3);
                Ruy(:,:,:,Rl)=uy(:,:,:,3);
                Ruz(:,:,:,Rl)=uz(:,:,:,3);
            end
            %% plot
            figure(9)
            %set(gcf,'Visible','on');
            %set(gcf,'position',[0,0,1500,600]);
            pcolor3(ux(:,:,:,3));
            colorbar;
            set(gca,'zdir','reverse');
            xlabel(['x*' num2str(dx) '[m]']);
            ylabel(['y*' num2str(dx) '[m]']);
            zlabel(['z*' num2str(dx) '[m]']);
            title(['t=' num2str(dt*l) 's']);
            
            for i=1:size(sx,2)
                hold on;
                ax2=plot3(sx(i),sy(i),sz(i),'o','color','red');
            end
            legend([ax2],'source','Location',[0.5,0.03,0.005,0.005],'orientation','horizontal');
            print(gcf,['.\pic\' num2str(l) '.png'],'-dpng','-r100');
            hold off;
            shg;
            %% timing
            fprintf('\ntime step=%d/%d',l+1,nt);
            fprintf('\n    epalsed time=%.2fs',toc);
            d=clock;
            fprintf('\n    current time=%d %d %d %d %d %.0d  ',d(1),d(2),d(3),d(4),d(5),d(6));
        end
end
%%